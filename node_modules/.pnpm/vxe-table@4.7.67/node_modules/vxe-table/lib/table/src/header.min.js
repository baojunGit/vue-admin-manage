"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("./util"),_dom=require("../../ui/src/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const renderType="header";var _default=exports.default=(0,_vue.defineComponent)({name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup(W){const k=(0,_vue.inject)("$xeTable",{}),{xID:u,props:d,reactData:H,internalData:I}=k,{refElem:M,refTableBody:z,refLeftContainer:S,refRightContainer:$,refCellResizeBar:D}=k.getRefMaps(),c=k.getComputeMaps()["computeColumnOpts"],f=(0,_vue.ref)([]),O=(0,_vue.ref)(),p=(0,_vue.ref)(),v=(0,_vue.ref)(),m=(0,_vue.ref)(),h=(0,_vue.ref)(),U=(0,_vue.ref)(),t=()=>{var e=H["isGroup"];f.value=e?(0,_util.convertHeaderColumnToRows)(W.tableGroupColumn):[]},q=(e,t)=>{const r=t["column"],a=W["fixedType"];var l=z.value;const o=S.value,n=$.value,i=D.value,s=e["clientX"];var u=O.value,d=e.target;const c=t.cell=d.parentNode;let f=0;const p=l.$el;l=(0,_dom.getOffsetPos)(d,u),u=d.clientWidth,d=Math.floor(u/2);const v=(0,_util.getColReMinWidth)(t)-d;let m=l.left-c.clientWidth+u+v,h=l.left+d;const x=document.onmousemove,_=document.onmouseup,g="left"===a,b="right"===a,C=M.value;let y=0;if(g||b){var w=g?"nextElementSibling":"previousElementSibling";let e=c[w];for(;e&&!(0,_dom.hasClass)(e,"fixed--hidden");)(0,_dom.hasClass)(e,"col--group")||(y+=e.offsetWidth),e=e[w];b&&n&&(h=n.offsetLeft+y)}function T(e){e.stopPropagation(),e.preventDefault(),e=e.clientX-s;let l=h+e;e=a?0:p.scrollLeft,g?l=Math.min(l,(n?n.offsetLeft:p.clientWidth)-y-v):b?(m=(o?o.clientWidth:0)+y+v,l=Math.min(l,h+c.clientWidth-v)):m=Math.max(p.scrollLeft,m),f=Math.max(l,m),i.style.left=f-e+"px"}H._isResize=!0,(0,_dom.addClass)(C,"drag--resize"),i.style.display="block",document.onmousemove=T,document.onmouseup=function(e){document.onmousemove=x,document.onmouseup=_;const l=r.renderWidth+(b?h-f:f-h);r.resizeWidth=l,i.style.display="none",H._isResize=!1,I._lastResizeTime=Date.now(),k.analyColumnWidth(),k.recalculate(!0).then(()=>{k.saveCustomStore("update:visible"),k.updateCellAreas(),k.dispatchEvent("resizable-change",Object.assign(Object.assign({},t),{resizeWidth:l}),e),setTimeout(()=>k.recalculate(!0),300)}),(0,_dom.removeClass)(C,"drag--resize")},T(e),k.closeMenu&&k.closeMenu()};(0,_vue.watch)(()=>W.tableColumn,t),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var e=W["fixedType"],l=k["internalData"],l=l["elemStore"],e=`${e||"main"}-header-`;l[e+"wrapper"]=O,l[e+"table"]=p,l[e+"colgroup"]=v,l[e+"list"]=m,l[e+"xSpace"]=h,l[e+"repair"]=U,t()})}),(0,_vue.onUnmounted)(()=>{var e=W["fixedType"],l=k["internalData"],l=l["elemStore"],e=`${e||"main"}-header-`;l[e+"wrapper"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null,l[e+"repair"]=null});return()=>{const{fixedType:x,fixedColumn:e,tableColumn:l}=W,{resizable:_,border:g,columnKey:b,headerRowClassName:t,headerCellClassName:C,headerRowStyle:r,headerCellStyle:y,showHeaderOverflow:w,headerAlign:T,align:M,mouseConfig:z}=d,{isGroup:a,currentColumn:S,scrollXLoad:$,overflowX:D,scrollbarWidth:o}=H;var n=I["visibleColumn"];const R=c.value;let i=f.value,s=l;return a?s=n:(x&&($||w)&&(s=e),i=[s]),(0,_vue.h)("div",{ref:O,class:["vxe-table--header-wrapper",x?`fixed-${x}--wrapper`:"body--wrapper"],xid:u},[x?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:h,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:p,class:"vxe-table--header",xid:u,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:v},s.map((e,l)=>(0,_vue.h)("col",{name:e.id,key:l})).concat(o?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("thead",{ref:m},i.map((m,h)=>(0,_vue.h)("tr",{class:["vxe-header--row",t?_xeUtils.default.isFunction(t)?t({$table:k,$rowIndex:h,fixed:x,type:renderType}):t:""],style:r?_xeUtils.default.isFunction(r)?r({$table:k,$rowIndex:h,fixed:x,type:renderType}):r:null},m.map((e,l)=>{var{type:t,showHeaderOverflow:r,headerAlign:a,align:o,headerClassName:n}=e,i=e.children&&e.children.length,s=x?e.fixed!==x&&!i:!!e.fixed&&D,r=_xeUtils.default.eqNull(r)?w:r,a=a||o||T||M;let u="ellipsis"===r;o="title"===r,r=!0===r||"tooltip"===r;let d=o||r||u;var c=e.filters&&e.filters.some(e=>e.checked),f=k.getColumnIndex(e),p=k.getVTColumnIndex(e);const v={$table:k,$grid:k.xegrid,$rowIndex:h,column:e,columnIndex:f,$columnIndex:l,_columnIndex:p,fixed:x,type:renderType,isHidden:s,hasFilter:c};f={onClick:e=>k.triggerHeaderCellClickEvent(e,v),onDblclick:e=>k.triggerHeaderCellDblclickEvent(e,v)};return $&&!d&&(u=d=!0),z&&(f.onMousedown=e=>k.triggerHeaderCellMousedownEvent(e,v)),(0,_vue.h)("th",Object.assign(Object.assign({class:["vxe-header--column",e.id,{["col--"+a]:a,["col--"+t]:t,"col--last":l===m.length-1,"col--fixed":e.fixed,"col--group":i,"col--ellipsis":d,"fixed--hidden":s,"is--sortable":e.sortable,"col--filter":!!e.filters,"is--filter-active":c,"col--current":S===e},n?_xeUtils.default.isFunction(n)?n(v):n:"",C?_xeUtils.default.isFunction(C)?C(v):C:""],colid:e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null,style:y?_xeUtils.default.isFunction(y)?y(v):y:null},f),{key:b||R.useKey||i?e.id:l}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":o,"c--tooltip":r,"c--ellipsis":u}]},e.renderHeader(v)),s||i||!(_xeUtils.default.isBoolean(e.resizable)?e.resizable:R.resizable||_)?null:(0,_vue.h)("div",{class:["vxe-resizable",{"is--line":!g||"none"===g}],onMousedown:e=>q(e,v)})])}).concat(o?[(0,_vue.h)("th",{class:"vxe-header--gutter col--gutter"})]:[]))))]),(0,_vue.h)("div",{ref:U,class:"vxe-table--header-border-line"})])}}});