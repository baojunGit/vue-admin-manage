"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_log=require("../../ui/src/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const{getConfig,getIcon,getI18n,renderer,commands,createEvent,useFns}=_ui.VxeUI;var _default=exports.default=(0,_vue.defineComponent)({name:"VxeToolbar",props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:()=>getConfig().toolbar.buttons},tools:{type:Array,default:()=>getConfig().toolbar.tools},perfect:{type:Boolean,default:()=>getConfig().toolbar.perfect},size:{type:String,default:()=>getConfig().toolbar.size||getConfig().size},className:[String,Function]},emits:["button-click","tool-click"],setup(c,e){const{slots:v,emit:r}=e;var o=_xeUtils.default.uniqueId();const d=_ui.VxeUI.getComponent("VxeButton"),s=useFns.useSize(c)["computeSize"],i=(0,_vue.reactive)({isRefresh:!1,columns:[]}),u=(0,_vue.ref)(),t={refElem:u},m={xID:o,props:c,context:e,reactData:i,getRefMaps:()=>t};const g=(0,_vue.inject)("$xeGrid",null),p=(0,_vue.ref)(),n=(0,_vue.ref)(0),_=(0,_vue.computed)(()=>Object.assign({},getConfig().toolbar.refresh,c.refresh)),b=(0,_vue.computed)(()=>Object.assign({},getConfig().toolbar.import,c.import)),f=(0,_vue.computed)(()=>Object.assign({},getConfig().toolbar.export,c.export)),O=(0,_vue.computed)(()=>Object.assign({},getConfig().toolbar.print,c.print)),h=(0,_vue.computed)(()=>Object.assign({},getConfig().toolbar.zoom,c.zoom)),x=(0,_vue.computed)(()=>Object.assign({},getConfig().toolbar.custom,c.custom)),a=(0,_vue.computed)(()=>{var e=p.value;if((n.value||e)&&e)return e=e.getComputeMaps()["computeCustomOpts"],e.value;return{trigger:""}}),C=(0,_vue.computed)(()=>{return a.value.trigger}),l=()=>{if(p.value)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},T=({$event:e})=>{var o=p.value;o&&(o.triggerCustomEvent?o.triggerCustomEvent(e):(0,_log.errLog)("vxe.error.reqModule",["VxeTableCustomModule"]))},y=({$event:e})=>{var o=p.value;o?o.customOpenEvent(e):(0,_log.errLog)("vxe.error.reqModule",["VxeTableCustomModule"])},E=({$event:e})=>{const o=p.value;if(o){const t=o.reactData["customStore"];t.activeBtn=!1,setTimeout(()=>{t.activeBtn||t.activeWrapper||o.customCloseEvent(e)},350)}},L=({$event:e})=>{var o=i["isRefresh"],t=_.value;if(!o){o=t.queryMethod||t.query;if(o){i.isRefresh=!0;try{Promise.resolve(o({})).catch(e=>e).then(()=>{i.isRefresh=!1})}catch(e){i.isRefresh=!1}}else g&&(i.isRefresh=!0,g.triggerToolbarCommitEvent({code:t.code||"reload"},e).catch(e=>e).then(()=>{i.isRefresh=!1}))}},N=({$event:e})=>{g&&g.triggerZoomEvent(e)},I=(e,o)=>{var t,r=p.value,n=o["code"];n&&(g?g.triggerToolbarBtnEvent(o,e):(t=commands.get(n),o={code:n,button:o,$table:r,$grid:g,$event:e},t&&((r=t.tableCommandMethod||t.commandMethod)?r(o):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[n])),m.dispatchEvent("button-click",o,e)))},R=(e,o)=>{var t,r=p.value,n=o["code"];n&&(g?g.triggerToolbarTolEvent(o,e):(t=commands.get(n),o={code:n,tool:o,$table:r,$grid:g,$event:e},t&&((r=t.tableCommandMethod||t.commandMethod)?r(o):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[n])),m.dispatchEvent("tool-click",o,e)))},$=()=>{var e;l()&&(e=p.value)&&e.openImport()},k=()=>{var e;l()&&(e=p.value)&&e.openExport()},B=()=>{var e;l()&&(e=p.value)&&e.openPrint()},M=(e,t)=>{e=e.dropdowns;return e?e.map((o,e)=>!1!==o.visible&&d?(0,_vue.h)(d,{key:e,disabled:o.disabled,loading:o.loading,type:o.type,mode:o.mode,icon:o.icon,circle:o.circle,round:o.round,status:o.status,content:o.name,onClick:({$event:e})=>(t?I:R)(e,o)}):(0,_vue.createCommentVNode)()):[]};Object.assign(m,{dispatchEvent(e,o,t){r(e,createEvent(t,{$toolbar:m},o))},syncUpdate(e){var o=e["collectColumn"];p.value=e.$table,i.columns=o,n.value++}}),(0,_vue.nextTick)(()=>{var e=c["refresh"],o=_.value,o=o.queryMethod||o.query,e=(!e||g||o||(0,_log.warnLog)("vxe.error.notFunc",["queryMethod"]),x.value);"development"===process.env.NODE_ENV&&(e.isFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.isFooter","table.custom-config.showFooter"]),e.showFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.showFooter","table.custom-config.showFooter"]),e.immediate&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.immediate","table.custom-config.immediate"]),e.trigger)&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.trigger","table.custom-config.trigger"])});return m.renderVN=()=>{var{perfect:e,loading:o,refresh:t,zoom:r,custom:n,className:a}=c,l=s.value;return(0,_vue.h)("div",{ref:u,class:["vxe-toolbar",a?_xeUtils.default.isFunction(a)?a({$toolbar:m}):a:"",{["size--"+l]:l,"is--perfect":e,"is--loading":o}]},[(0,_vue.h)("div",{class:"vxe-buttons--wrapper"},(()=>{var e=c["buttons"];const l=p.value;var o=v.buttons;if(o)return(0,_vn.getSlotVNs)(o({$grid:g,$table:l}));const s=[];return e&&e.forEach(o=>{var e,t,r,{dropdowns:n,buttonRender:a}=o;!1!==o.visible&&(e=a?renderer.get(a.name):null,a&&e&&e.renderToolbarButton?(t=e.toolbarButtonClassName,r={$grid:g,$table:l,button:o},s.push((0,_vue.h)("span",{class:["vxe-button--item",t?_xeUtils.default.isFunction(t)?t(r):t:""]},(0,_vn.getSlotVNs)(e.renderToolbarButton(a,r))))):d&&s.push((0,_vue.h)(d,{disabled:o.disabled,loading:o.loading,type:o.type,mode:o.mode,icon:o.icon,circle:o.circle,round:o.round,status:o.status,content:o.name,permissionCode:o.permissionCode,destroyOnClose:o.destroyOnClose,placement:o.placement,transfer:o.transfer,onClick:({$event:e})=>I(e,o)},n&&n.length?{dropdowns:()=>M(o,!0)}:{})))}),s})()),(0,_vue.h)("div",{class:"vxe-tools--wrapper"},(()=>{var e=c["tools"];const i=p.value;var o=v.tools;if(o)return(0,_vn.getSlotVNs)(o({$grid:g,$table:i}));const u=[];return e&&e.forEach((o,e)=>{var t,r,n,a,{dropdowns:l,toolRender:s}=o;!1!==o.visible&&(t=s?s.name:null,r=s?renderer.get(t):null,s&&r&&r.renderToolbarTool?(n=r.toolbarToolClassName,a={$grid:g,$table:i,tool:o},u.push((0,_vue.h)("span",{key:t,class:["vxe-tool--item",n?_xeUtils.default.isFunction(n)?n(a):n:""]},(0,_vn.getSlotVNs)(r.renderToolbarTool(s,a))))):d&&u.push((0,_vue.h)(d,{key:e,disabled:o.disabled,loading:o.loading,type:o.type,mode:o.mode,icon:o.icon,circle:o.circle,round:o.round,status:o.status,content:o.name,destroyOnClose:o.destroyOnClose,placement:o.placement,transfer:o.transfer,onClick:({$event:e})=>R(e,o)},l&&l.length?{dropdowns:()=>M(o,!1)}:{})))}),u})()),(0,_vue.h)("div",{class:"vxe-tools--operate"},[c.import&&(a=b.value,d)?(0,_vue.h)(d,{key:"import",circle:!0,icon:a.icon||getIcon().TOOLBAR_TOOLS_IMPORT,title:getI18n("vxe.toolbar.import"),onClick:$}):(0,_vue.createCommentVNode)(),c.export&&(l=f.value,d)?(0,_vue.h)(d,{key:"export",circle:!0,icon:l.icon||getIcon().TOOLBAR_TOOLS_EXPORT,title:getI18n("vxe.toolbar.export"),onClick:k}):(0,_vue.createCommentVNode)(),c.print&&(e=O.value,d)?(0,_vue.h)(d,{key:"print",circle:!0,icon:e.icon||getIcon().TOOLBAR_TOOLS_PRINT,title:getI18n("vxe.toolbar.print"),onClick:B}):(0,_vue.createCommentVNode)(),t&&(o=_.value,d)?(0,_vue.h)(d,{key:"refresh",circle:!0,icon:i.isRefresh?o.iconLoading||getIcon().TOOLBAR_TOOLS_REFRESH_LOADING:o.icon||getIcon().TOOLBAR_TOOLS_REFRESH,title:getI18n("vxe.toolbar.refresh"),onClick:L}):(0,_vue.createCommentVNode)(),r&&g&&(a=h.value,g)&&d?(0,_vue.h)(d,{key:"zoom",circle:!0,icon:g.isMaximized()?a.iconOut||getIcon().TOOLBAR_TOOLS_MINIMIZE:a.iconIn||getIcon().TOOLBAR_TOOLS_FULLSCREEN,title:getI18n("vxe.toolbar.zoom"+(g.isMaximized()?"Out":"In")),onClick:N}):(0,_vue.createCommentVNode)(),n&&(l=x.value,e=C.value,t={},"manual"!==e&&("hover"===e?(t.onMouseenter=y,t.onMouseleave=E):t.onClick=T),d)?(0,_vue.h)(d,Object.assign({key:"custom",circle:!0,icon:l.icon||getIcon().TOOLBAR_TOOLS_CUSTOM,title:getI18n("vxe.toolbar.custom"),className:"vxe-toolbar-custom-target"},t)):(0,_vue.createCommentVNode)()])])},"development"===process.env.NODE_ENV&&(0,_vue.nextTick)(()=>{!(c.refresh||c.import||c.export||c.print||c.zoom)||d||(0,_log.errLog)("vxe.error.reqComp",["vxe-button"])}),m},render(){return this.renderVN()}});