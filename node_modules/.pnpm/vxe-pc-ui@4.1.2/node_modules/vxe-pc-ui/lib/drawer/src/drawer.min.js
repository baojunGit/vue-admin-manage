"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.allActiveDrawers=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_utils=require("../../ui/src/utils"),_vn=require("../../ui/src/vn"),_button=_interopRequireDefault(require("../../button/src/button")),_index=_interopRequireDefault(require("../../loading/index"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const allActiveDrawers=exports.allActiveDrawers=[];var _default=exports.default=(0,_vue.defineComponent)({name:"VxeDrawer",props:{modelValue:Boolean,id:String,title:String,loading:{type:Boolean,default:null},className:String,position:{type:[String,Object],default:()=>(0,_ui.getConfig)().drawer.position},lockView:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.lockView},lockScroll:Boolean,mask:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.mask},maskClosable:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.maskClosable},escClosable:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.escClosable},showHeader:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.showHeader},showFooter:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.showFooter},showClose:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.showClose},content:[Number,String],showCancelButton:{type:Boolean,default:null},cancelButtonText:{type:String,default:()=>(0,_ui.getConfig)().drawer.cancelButtonText},showConfirmButton:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.showConfirmButton},confirmButtonText:{type:String,default:()=>(0,_ui.getConfig)().drawer.confirmButtonText},destroyOnClose:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.destroyOnClose},showTitleOverflow:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.showTitleOverflow},width:[Number,String],height:[Number,String],zIndex:Number,transfer:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.transfer},padding:{type:Boolean,default:()=>(0,_ui.getConfig)().drawer.padding},size:{type:String,default:()=>(0,_ui.getConfig)().drawer.size||(0,_ui.getConfig)().size},beforeHideMethod:{type:Function,default:()=>(0,_ui.getConfig)().drawer.beforeHideMethod},slots:Object},emits:["update:modelValue","show","hide","before-hide","close","confirm","cancel"],setup(_,e){const{slots:f,emit:i}=e;var t=_xeUtils.default.uniqueId();const w=(0,_ui.useSize)(_)["computeSize"],g=(0,_vue.ref)(),h=(0,_vue.ref)(),a=(0,_vue.ref)(),l=(0,_vue.ref)(),p=(0,_vue.reactive)({initialized:!1,visible:!1,contentVisible:!1,drawerZIndex:0,firstOpen:!0}),r={refElem:g},o={},x={xID:t,props:_,context:e,reactData:p,getRefMaps:()=>r,getComputeMaps:()=>o},n=()=>{return h.value},s=()=>{var{width:e,height:t}=_,r=n();return r.style.width=""+(e?isNaN(e)?e:e+"px":""),r.style.height=""+(t?isNaN(t)?t:t+"px":""),(0,_vue.nextTick)()},u=()=>{var e=_["zIndex"],t=p["drawerZIndex"];e?p.drawerZIndex=e:t<(0,_utils.getLastZIndex)()&&(p.drawerZIndex=(0,_utils.nextZIndex)())},d=()=>(0,_vue.nextTick)().then(()=>{}),v=e=>{var t=_["beforeHideMethod"],r=p["visible"];const o={type:e};return r&&Promise.resolve(t?t(o):null).then(e=>{_xeUtils.default.isError(e)||(p.contentVisible=!1,_xeUtils.default.remove(allActiveDrawers,e=>e===x),y.dispatchEvent("before-hide",o,null),setTimeout(()=>{p.visible=!1,i("update:modelValue",!1),y.dispatchEvent("hide",o,null)},200))}).catch(e=>e),(0,_vue.nextTick)()},c=e=>{var t="close";y.dispatchEvent(t,{type:t},e),v(t)},m=e=>{var t="confirm";y.dispatchEvent(t,{type:t},e),v(t)},b=e=>{var t="cancel";y.dispatchEvent(t,{type:t},e),v(t)},C=()=>{const r=_["showFooter"];var{initialized:e,visible:t}=p;return e||(p.initialized=!0),t||(s(),p.visible=!0,p.contentVisible=!1,u(),allActiveDrawers.push(x),setTimeout(()=>{p.contentVisible=!0,(0,_vue.nextTick)(()=>{r&&(e=a.value,t=l.value,e=e||t)&&e.focus();var e,t={type:""};i("update:modelValue",!0),y.dispatchEvent("show",t,null)})},10),(0,_vue.nextTick)(()=>{var e=p["firstOpen"];e&&d().then(()=>{setTimeout(()=>d(),20)}),e&&(p.firstOpen=!1)})),(0,_vue.nextTick)()},y={dispatchEvent(e,t,r){i(e,(0,_ui.createEvent)(r,{$drawer:x},t))},open:C,close(){return v("close")},getBox:n},V=e=>{var t=g.value;_.maskClosable&&e.target===t&&v("mask")},k=e=>{if(_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.ESCAPE)){const t=_xeUtils.default.max(allActiveDrawers,e=>e.reactData.drawerZIndex);t&&setTimeout(()=>{t===x&&t.props.escClosable&&v("exit")},10)}},N=()=>{const t=p["drawerZIndex"];allActiveDrawers.some(e=>e.reactData.visible&&e.reactData.drawerZIndex>t)&&u()};Object.assign(x,y,{});const B=()=>{var{slots:e={},showClose:t,title:r}=_,o=f.title||e.title,e=f.corner||e.corner;return[(0,_vue.h)("div",{class:"vxe-drawer--header-title"},o?(0,_vn.getSlotVNs)(o({$drawer:x})):r?(0,_utils.getFuncText)(r):(0,_ui.getI18n)("vxe.alert.title")),(0,_vue.h)("div",{class:"vxe-drawer--header-right"},[e?(0,_vue.h)("div",{class:"vxe-drawer--corner-wrapper"},(0,_vn.getSlotVNs)(e({$drawer:x}))):(0,_vue.createCommentVNode)(),t?(0,_vue.h)("div",{class:["vxe-drawer--close-btn","trigger--btn"],title:(0,_ui.getI18n)("vxe.drawer.close"),onClick:c},[(0,_vue.h)("i",{class:(0,_ui.getIcon)().DRAWER_CLOSE})]):(0,_vue.createCommentVNode)()])]},S=()=>{var{slots:e={},showCancelButton:t,showConfirmButton:r}=_,o=f.leftfoot||e.leftfoot,e=f.rightfoot||e.rightfoot,i=[];return t&&i.push((0,_vue.h)(_button.default,{key:1,ref:l,content:_.cancelButtonText||(0,_ui.getI18n)("vxe.button.cancel"),onClick:b})),r&&i.push((0,_vue.h)(_button.default,{key:2,ref:a,status:"primary",content:_.confirmButtonText||(0,_ui.getI18n)("vxe.button.confirm"),onClick:m})),(0,_vue.h)("div",{class:"vxe-drawer--footer-wrapper"},[(0,_vue.h)("div",{class:"vxe-drawer--footer-left"},o?(0,_vn.getSlotVNs)(o({$drawer:x})):[]),(0,_vue.h)("div",{class:"vxe-drawer--footer-right"},e?(0,_vn.getSlotVNs)(e({$drawer:x})):i)])};return x.renderVN=()=>{var{slots:e={},className:t,position:r,loading:o,lockScroll:i,padding:a,lockView:l,mask:n,destroyOnClose:s}=_,{initialized:u,contentVisible:d,visible:v}=p,e=f.aside||e.aside,c=w.value;return(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!_.transfer||!u},[(0,_vue.h)("div",{ref:g,class:["vxe-drawer--wrapper","pos--"+r,t||"",{["size--"+c]:c,"is--padding":a,"lock--scroll":i,"lock--view":l,"is--mask":n,"is--visible":d,"is--active":v,"is--loading":o}],style:{zIndex:p.drawerZIndex},onClick:V},[(0,_vue.h)("div",{ref:h,class:"vxe-drawer--box",onMousedown:N},[e?(0,_vue.h)("div",{class:"vxe-drawer--aside"},(0,_vn.getSlotVNs)(e({$drawer:x}))):(0,_vue.createCommentVNode)(),(0,_vue.h)("div",{class:"vxe-drawer--container"},!p.initialized||s&&!p.visible?[]:[(()=>{var{slots:e={},showTitleOverflow:t}=_,e=f.header||e.header;return _.showHeader?(0,_vue.h)("div",{class:["vxe-drawer--header",{"is--ellipsis":t}]},e?(0,_vn.getSlotVNs)(e({$drawer:x})):B()):(0,_vue.createCommentVNode)()})(),(()=>{var{slots:e={},content:t}=_,r=f.default||e.default,o=f.left||e.left,e=f.right||e.right;return(0,_vue.h)("div",{class:"vxe-drawer--body"},[o?(0,_vue.h)("div",{class:"vxe-drawer--body-left"},(0,_vn.getSlotVNs)(o({$drawer:x}))):(0,_vue.createCommentVNode)(),(0,_vue.h)("div",{class:"vxe-drawer--body-default"},[(0,_vue.h)("div",{class:"vxe-drawer--content"},r?(0,_vn.getSlotVNs)(r({$drawer:x})):(0,_utils.getFuncText)(t))]),e?(0,_vue.h)("div",{class:"vxe-drawer--body-right"},(0,_vn.getSlotVNs)(e({$drawer:x}))):(0,_vue.createCommentVNode)(),(0,_vue.h)(_index.default,{class:"vxe-drawer--loading",modelValue:_.loading})])})(),(()=>{var{slots:e={}}=_,e=f.footer||e.footer;return _.showFooter?(0,_vue.h)("div",{class:"vxe-drawer--footer"},e?(0,_vn.getSlotVNs)(e({$drawer:x})):[S()]):(0,_vue.createCommentVNode)()})()])])])])},(0,_vue.watch)(()=>_.width,s),(0,_vue.watch)(()=>_.height,s),(0,_vue.watch)(()=>_.modelValue,e=>{e?C():v("model")}),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{_.modelValue&&C(),s()}),_.escClosable&&_ui.globalEvents.on(x,"keydown",k)}),(0,_vue.onUnmounted)(()=>{_ui.globalEvents.off(x,"keydown")}),x},render(){return this.renderVN()}});