"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_index=_interopRequireDefault(require("../../loading/index"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeMenu",props:{modelValue:[String,Number],expandAll:Boolean,collapsed:{type:Boolean,default:null},loading:Boolean,options:{type:Array,default:()=>[]}},emits:["update:modelValue","click"],setup(a,e){const l=e["emit"];var i=_xeUtils.default.uniqueId();const t=(0,_vue.inject)("$xeLayoutAside",null),n=(0,_vue.ref)(),s=(0,_vue.ref)(),r=(0,_vue.reactive)({activeName:a.modelValue,menuList:[],itemHeight:1}),u={refElem:n},c=(0,_vue.computed)(()=>{var e=a["collapsed"];return _xeUtils.default.isBoolean(e)?e:!!t&&t.props.collapsed}),o={},d={xID:i,props:a,context:e,reactData:r,getRefMaps:()=>u,getComputeMaps:()=>o},v=()=>{var e=s.value,e=e?e.children:[];e.length&&(r.itemHeight=e[0].offsetHeight)},m=e=>{let i=0;return e.isExpand&&e.childList.forEach(e=>{i+=m(e)+1}),i},p=s=>{const u=r["activeName"];_xeUtils.default.eachTree(r.menuList,(e,i,t,a,l,n)=>{e.itemKey===u?(n.forEach(e=>{e.isActive=!0,s&&(e.isExpand=!0)}),e.isExactActive=!0):(e.isExactActive=!1,e.isActive=!1)},{children:"childList"})},h=()=>{const n=a["expandAll"];r.menuList=_xeUtils.default.mapTree(a.options,(e,i,t,a,l)=>{return Object.assign(Object.assign({},e),{parentKey:l?l.name||a.slice(0,a.length-1).join(","):"",level:a.length,itemKey:e.name||a.join(","),isExactActive:!1,isActive:!1,isExpand:_xeUtils.default.isBoolean(e.expanded)?e.expanded:!!n,hasChild:e.children&&0<e.children.length,childHeight:0})},{children:"children",mapChildren:"childList"})},_=(e,i)=>{var{hasChild:t,isExpand:a}=i;t&&(e.stopPropagation(),e.preventDefault(),i.isExpand=!a,v(),_xeUtils.default.eachTree(r.menuList,e=>{e.hasChild&&e.isExpand?e.childHeight=m(e)*r.itemHeight:e.childHeight=0},{children:"childList"}))},x=(e,i)=>{var{routerLink:t,hasChild:a}=i;t?(r.activeName=i.itemKey,l("update:modelValue",i.itemKey)):a&&_(e,i),l("click",(0,_ui.createEvent)(e,{$menu:d,menu:i}))},f=i=>{var{icon:e,isExpand:t,hasChild:a}=i,l=""+((l=i).title||l.name);return[(0,_vue.h)("span",{class:"vxe-menu--item-link-icon"},e?[(0,_vue.h)("i",{class:e})]:[]),(0,_vue.h)("span",{class:"vxe-menu--item-link-title",title:l},l),a?(0,_vue.h)("span",{class:"vxe-menu--item-link-collapse",onClick(e){_(e,i)}},[(0,_vue.h)("i",{class:t?(0,_ui.getIcon)().MENU_ITEM_EXPAND_OPEN:(0,_ui.getIcon)().MENU_ITEM_EXPAND_CLOSE})]):(0,_vue.createCommentVNode)()]},g=i=>{var{itemKey:e,level:t,hasChild:a,isActive:l,isExactActive:n,isExpand:s,routerLink:u,childList:r}=i,o=c.value;return i.permissionCode&&!_ui.permission.checkVisible(i.permissionCode)?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{key:e,class:["vxe-menu--item-wrapper","vxe-menu--item-level"+t,{"is--exact-active":n,"is--active":l,"is--expand":!o&&s}]},[u?(0,_vue.h)((0,_vue.resolveComponent)("router-link"),{class:"vxe-menu--item-link",to:u,onClick(e){x(e,i)}},{default:()=>f(i)}):(0,_vue.h)("div",{class:"vxe-menu--item-link",onClick(e){x(e,i)}},f(i)),a?(0,_vue.h)("div",{class:"vxe-menu--item-group",style:{}},r.map(e=>g(e))):(0,_vue.createCommentVNode)()])};d.renderVN=()=>{var e=a["loading"],i=r["menuList"],t=c.value;return(0,_vue.h)("div",{ref:n,class:["vxe-menu",{"is--collapsed":t,"is--loading":e}]},[(0,_vue.h)("div",{ref:s,class:"vxe-menu--item-list"},i.map(e=>g(e))),(0,_vue.h)(_index.default,{class:"vxe-list-view--loading",modelValue:e})])};const E=(0,_vue.ref)(0);return(0,_vue.watch)(()=>a.options?a.options.length:-1,()=>{E.value++}),(0,_vue.watch)(()=>a.options,()=>{E.value++}),(0,_vue.watch)(E,()=>{h(),p(!0)}),(0,_vue.watch)(()=>a.modelValue,e=>{r.activeName=e}),(0,_vue.watch)(()=>r.activeName,()=>{p(!0)}),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(v)}),h(),p(!0),d},render(){return this.renderVN()}});