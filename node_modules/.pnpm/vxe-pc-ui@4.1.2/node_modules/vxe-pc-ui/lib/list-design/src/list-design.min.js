"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_dom=require("../../ui/src/dom"),_ui=require("../../ui"),_util=require("../render/util"),_defaultSettingData=require("./default-setting-data"),_layoutPreview=_interopRequireDefault(require("./layout-preview")),_layoutSetting=_interopRequireDefault(require("./layout-setting"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeListDesign",props:{size:{type:String,default:()=>(0,_ui.getConfig)().listDesign.size},height:{type:[String,Number],default:()=>(0,_ui.getConfig)().listDesign.height},config:Object,showPc:{type:Boolean,default:()=>(0,_ui.getConfig)().listDesign.showPc},showMobile:{type:Boolean,default:()=>(0,_ui.getConfig)().listDesign.showMobile},actionCodes:Array,formRender:Object},emits:[],setup(r,e){const{emit:n,slots:i}=e;var t=_xeUtils.default.uniqueId();const s=(0,_vue.ref)(),a=(0,_vue.reactive)({formData:{},searchFormData:{},searchFormItems:[],listTableColumns:[]}),l={refElem:s},o={},u={xID:t,props:r,context:e,reactData:a,getRefMaps:()=>l,getComputeMaps:()=>o},d=[],c=[],f=(_ui.renderer.forEach((e,t)=>{var i,e=e["createListDesignSettingActionButtonConfig"];e&&(i={name:t},("custom"===(t=Object.assign((0,_util.createListDesignActionButton)({code:t}),e(i))).type?c:d).push(t))}),e=>({title:e.title,field:e.field,visible:!e.hidden,width:"",cellRender:{name:e.name,props:e.options}})),g=e=>{const i=[];return e&&(e=e["widgetData"],e)&&e.forEach(e=>{var t=e["name"];t&&("row"===t?e.children.forEach(e=>{e.name&&i.push(f(e))}):"subTable"!==t&&i.push(f(e)))}),i},m=e=>e?e.map(e=>({field:e.field,title:e.title,visible:!!e.visible,width:e.width,cellRender:_xeUtils.default.clone(e.cellRender)})):[],h=e=>{var{formConfig:e,searchItems:t,listColumns:i}=e;return e&&(e=e,a.formData=Object.assign({},D(),e),(0,_vue.nextTick)()),t&&p(t),i&&(a.listTableColumns=_(i)),(0,_vue.nextTick)()},_=e=>m(e),v=()=>a.searchFormItems,p=e=>{var{data:e,items:t}=(e=>{if(e){const t={};return{items:e.map(e=>(t[e.field]=null,{field:e.field,title:e.title,folding:e.folding,itemRender:e.itemRender})),data:t}}return{items:[],data:{}}})(e);return a.searchFormData=e,a.searchFormItems=t,(0,_vue.nextTick)()},C=()=>a.listTableColumns;const D=()=>{var{actionCodes:e,formRender:t}=r;let i=(0,_defaultSettingData.getDefaultSettingFormData)();if(e&&e.length&&(!i.actionButtonList||!i.actionButtonList.length)){const n=[];e.forEach(t=>{var e;_xeUtils.default.isObject(t)&&t.default&&(e=d.find(e=>e.code===t.code))&&n.push((0,_util.createListDesignActionButton)({type:e.type,code:e.code}))}),i.actionButtonList=n}return t&&t.name&&(e=(e=_ui.renderer.get(t.name))?e.createListDesignSettingFormConfig:null,t={name:t.name},i=(e?e(t):{})||{}),i},b=()=>{a.formData=D()},x=()=>(h({searchItems:[],listColumns:[]}),b(),(0,_vue.nextTick)());t={dispatchEvent(e,t,i){n(e,(0,_ui.createEvent)(i,{$listDesign:u},t))},loadFormDesignConfig(e){var t=a["listTableColumns"];const i={};_xeUtils.default.eachTree(t,e=>{i[e.field]=e},{children:"children"});t=g(e);return _xeUtils.default.eachTree(t,e=>{var t=i[e.field];t&&(t.width&&(e.width=t.width),e.visible=t.visible)},{children:"children"}),a.listTableColumns=t,(0,_vue.nextTick)()},reloadFormDesignConfig(e){return a.listTableColumns=g(e),(0,_vue.nextTick)()},getSearchItems:v,setSearchItems:p,getListColumns:C,setListColumns:e=>(a.listTableColumns=_(e),(0,_vue.nextTick)()),getConfig(){return{formConfig:a.formData,searchItems:v(),listColumns:C()}},loadConfig:h,reloadConfig(e){return x(),h(e)},clearConfig:x};Object.assign(u,t,{});return u.renderVN=()=>{var e=r["height"],t=i.header;return(0,_vue.h)("div",{ref:s,class:"vxe-list-design",style:e?{height:(0,_dom.toCssUnit)(e)}:null},[(0,_vue.h)("div",{class:"vxe-list-design--header"},t?t({}):[]),(0,_vue.h)("div",{class:"vxe-list-design--body"},[(0,_vue.h)(_layoutPreview.default),(0,_vue.h)(_layoutSetting.default)])])},(0,_vue.provide)("$xeListDesign",u),(0,_vue.watch)(()=>r.config,e=>{h(e||{})}),b(),r.config&&h(r.config),u},render(){return this.renderVN()}});