"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WidgetSubtableViewComponent=exports.WidgetSubtableEditComponent=void 0;var _vue=require("vue"),_core=require("@vxe-ui/core"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("../src/util"),_vn=require("../../ui/src/vn"),_use=require("../../form-design/src/use"),_formItem=_interopRequireDefault(require("../../form/src/form-item")),_button=_interopRequireDefault(require("../../button/src/button")),_checkbox=_interopRequireDefault(require("../../checkbox/src/checkbox"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const ViewSubItemComponent=(0,_vue.defineComponent)({props:{parentWidget:{type:Object,default:()=>({})},widget:{type:Object,default:()=>({})}},emits:[],setup(n){const a=(0,_vue.inject)("$xeFormDesign",null),u=(0,_vue.inject)("$xeFormView",null);if(!a)return()=>[];const l=a["reactData"],g=e=>{e.stopPropagation();var t=l["widgetObjList"],e=e.currentTarget;const i=Number(e.getAttribute("data-widget-id"));e=_xeUtils.default.findTree(t,e=>e&&e.id===i,{children:"children"});e&&(l.dragWidget=null,l.sortSubWidget=e.item,l.sortSubWidget=e.item)},c=e=>{e.stopPropagation(),l.activeWidget=l.sortSubWidget,l.sortWidget=null};let v=!1;const m=e=>{const t=l["sortSubWidget"];if(t&&e.stopPropagation(),v)e.preventDefault();else{const{widget:o,parentWidget:s}=n;var i,r,d;s&&o&&t&&o.id!==t.id&&(e.preventDefault(),(i=s.children.map(e=>e)).length?-1<(r=_xeUtils.default.findIndexOf(i,e=>e.id===o.id))&&-1<(d=_xeUtils.default.findIndexOf(i,e=>e.id===t.id))&&(i[d]=o,i[r]=t,s.children=i,v=!0,a.dispatchEvent("drag-widget",{widget:t},e),setTimeout(()=>{v=!1},150)):(s.children.push(t),v=!1))}},b=e=>{var t=l["sortSubWidget"];t&&e.preventDefault()},p=e=>{var t=n["widget"];t&&(l.sortSubWidget=t,a.handleClickWidget(e,t))};return()=>{const t=n["widget"];var{dragWidget:e,activeWidget:i,sortSubWidget:r}=l,d=t?t.name:"",o=_core.renderer.get(d)||{},o=o.renderFormDesignWidgetEdit||o.renderFormDesignWidgetView,d=t||{name:d},s=!!a,s={widget:t,readonly:!1,disabled:!1,isEditMode:s,isViewMode:!s,$formDesign:a,$formView:u},i=i&&t&&i.id===t.id;return(0,_vue.h)("div",{class:["vxe-form-design--widget-subtable-view-item",{"is--active":i,"is--sort":r&&t&&r.id===t.id,"is--drag":e&&t&&e.id===t.id}],draggable:!0,"data-widget-id":t.id,onDragstart:g,onDragend:c,onDragenter:m,onDragover:b,onClick:p},[(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-view-item-wrapper"},[(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-view-item-box vxe-form--item-row"},o?(0,_vn.getSlotVNs)(o(d,s)):[]),i?(0,_vue.h)("div",{class:"vxe-form-design--preview-item-operate"},[(0,_vue.h)(_button.default,{icon:(0,_core.getIcon)().FORM_DESIGN_WIDGET_COPY,status:"primary",size:"mini",circle:!0,onClick(e){a.handleCopyWidget(e.$event,t)}}),(0,_vue.h)(_button.default,{icon:(0,_core.getIcon)().FORM_DESIGN_WIDGET_DELETE,status:"danger",size:"mini",circle:!0,onClick(e){a.handleRemoveWidget(e.$event,t)}})]):(0,_vue.createCommentVNode)()])])}}}),WidgetSubtableEditComponent=exports.WidgetSubtableEditComponent=(0,_vue.defineComponent)({props:{renderOpts:{type:Object,default:()=>({})},renderParams:{type:Object,default:()=>({})}},emits:[],setup(s){var e=(0,_vue.inject)("$xeFormDesign",null);if(!e)return()=>[];const n=e["reactData"],a=e=>{const{sortWidget:t,widgetObjList:i}=n;var r,d,o=s["renderParams"],o=o["widget"];e.stopPropagation(),t&&o&&o.id!==t.id&&((0,_util.hasFormDesignLayoutType)(t)?_core.VxeUI.modal&&_core.VxeUI.modal.message({content:(0,_core.getI18n)("vxe.formDesign.widgetProp.subtableProp.errSubDrag"),status:"error",id:"errSubDrag"}):o.name&&!o.children.some(e=>e.id===t.id)&&(e=_xeUtils.default.findTree(i,e=>e.id===t.id,{children:"children"}))&&({item:e,index:r,items:d}=e,n.sortWidget=null,n.sortSubWidget=e,n.activeWidget=e,o.children.push(e),d.splice(r,1)))};return()=>{var e=s["renderParams"];const t=e["widget"],{title:i,children:r,options:d}=t,o=d["showCheckbox"];return(0,_vue.h)(_formItem.default,{title:i,className:"vxe-form-design--widget-subtable-form-item"},{default(){return(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-view"},[(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-view-left"},[o?(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-col"},[(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-head"},[(0,_vue.h)(_checkbox.default)]),(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-body"},[(0,_vue.h)(_checkbox.default)])]):(0,_vue.createCommentVNode)(),(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-col"},[(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-head"},(0,_core.getI18n)("vxe.formDesign.widgetProp.subtableProp.seqTitle")),(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-body"},"1")])]),(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-view-right"},[(0,_vue.h)("div",{class:"vxe-form-design--widget-subtable-view-wrapper"},[(0,_vue.h)(_vue.TransitionGroup,{class:"vxe-form-design--widget-subtable-view-list",tag:"div",name:"vxe-form-design--widget-subtable-view-list"},{default:()=>r.map(e=>(0,_vue.h)(ViewSubItemComponent,{key:e.id,parentWidget:t,widget:e}))}),(0,_vue.h)("div",{key:"empty",class:"vxe-form-design--widget-subtable-view-empty",onDragover:a},"将控件拖拽进来")])])])}})}}}),WidgetSubtableViewComponent=exports.WidgetSubtableViewComponent=(0,_vue.defineComponent)({props:{renderOpts:{type:Object,default:()=>({})},renderParams:{type:Object,default:()=>({})}},emits:[],setup(r){const d=_core.VxeUI.getComponent("VxeGrid"),o=(0,_vue.inject)("$xeFormView",null),s=(0,_use.useWidgetName)(r)["computeKebabCaseName"],n=(0,_vue.computed)(()=>{var e=r["renderParams"],e=e["widget"],{children:e,options:t}=e;const i=[];return t.showCheckbox&&i.push({type:"checkbox",width:60}),i.push({type:"seq",width:60}),e&&e.forEach(e=>{i.push({field:e.field,title:e.title})}),i});return()=>{var e=r["renderParams"];const t=e["widget"];e=s.value;const i=n.value;return(0,_vue.h)(_formItem.default,{class:["vxe-form-design--widget-render-form-item","widget-"+e],title:t.title,field:t.field,span:24,padding:!1},{default(){return d?(0,_vue.h)(d,{border:!0,columnConfig:{resizable:!0},data:o?o.getItemValue(t):null,columns:i}):(0,_vue.createCommentVNode)()}})}}});