"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_dom=require("../..//ui/src/dom"),_log=require("../../ui/src/log"),_xeUtils=_interopRequireDefault(require("xe-utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeTabs",props:{modelValue:[String,Number,Boolean],options:Array,height:[String,Number],destroyOnClose:Boolean,titleWidth:[String,Number],titleAlign:[String,Number],type:String,showClose:Boolean,padding:{type:Boolean,default:()=>(0,_ui.getConfig)().tabs.padding},trigger:String,beforeChangeMethod:Function,beforeCloseMethod:Function},emits:["update:modelValue","change","tab-change-fail","tab-close","tab-close-fail","tab-click","tab-load"],setup(h,e){const{slots:r,emit:i}=e;var t=_xeUtils.default.uniqueId();const a=(0,_vue.inject)("$xeTabs",null),u=(0,_vue.ref)(),m=(0,_vue.ref)(),_=(0,_vue.reactive)({staticTabs:[],activeName:null,initNames:[],lintLeft:0,lintWidth:0,isTabOver:!1,resizeFlag:1}),l={refElem:u},n=e=>{e=e.permissionCode;return!(e&&!_ui.permission.checkVisible(e))},o=(0,_vue.computed)(()=>{var e=h["options"];return(e||[]).filter(n)}),v=(0,_vue.computed)(()=>{var e=_["staticTabs"];return e.filter(n)}),s={},c={xID:t,props:h,context:e,reactData:_,getRefMaps:()=>l,getComputeMaps:()=>s},f=(e,t)=>e&&(_xeUtils.default.isString(e)&&(e=r[e]||null),_xeUtils.default.isFunction(e))?(0,_vn.getSlotVNs)(e(t)):[],d=()=>{(0,_vue.nextTick)(()=>{var e=h["type"];const t=_["activeName"];var a,l=o.value,n=v.value,i=m.value;let s=0,r=0,u=!1;i&&(n=_xeUtils.default.findIndexOf(n.length?n:l,e=>e.name===t),{children:l,scrollWidth:i,clientWidth:a}=i,u=i!==a,-1<n)&&(a=(i=l[n]).clientWidth,e?"card"===e?(s=a+2,r=i.offsetLeft):"border-card"===e&&(s=a+2,r=i.offsetLeft-1):(s=Math.max(4,Math.floor(.6*a)),r=i.offsetLeft+Math.floor((a-s)/2))),_.lintLeft=r,_.lintWidth=s,_.isTabOver=u})},b=(e,t,a)=>{i(e,(0,_ui.createEvent)(a,{$tabs:c},t))},g=(e,t)=>{var a=_["initNames"];return!(!e||a.includes(e)||(b("tab-load",{name:e},t),a.push(e),0))},p=e=>{let a=null;if(e&&e.length){let t=!1;a=h.modelValue,e.forEach(e=>{a===e.name&&(t=!0),e&&e.preload&&g(e.name,null)}),t||(a=e[0].name,g(a,null),i("update:modelValue",a))}_.activeName=a},x=(e,t)=>{var a=h["trigger"],l=h.beforeChangeMethod||(0,_ui.getConfig)().tabs.beforeChangeMethod,n=_["activeName"],t=t["name"];"manual"===a?b("tab-click",{name:t},e):(a=t,_.activeName=t,i("update:modelValue",a),b("tab-click",{name:t},e),g(t,e),t!==n&&(!l||l({$tabs:c,name:t,oldName:n,newName:t})?b("change",{value:a,name:t,oldName:n,newName:t},e):b("tab-change-fail",{value:a,name:t,oldName:n,newName:t},e)))},N=(e,t,a,l)=>{e.stopPropagation();var n=_["activeName"],i=h.beforeCloseMethod||(0,_ui.getConfig)().tabs.beforeCloseMethod,t=t["name"],s=n;let r=s;n===t&&(n=a<l.length-1?l[a+1]:l[a-1],r=n?n.name:null),!i||i({$tabs:c,value:s,name:t,nextName:r})?b("tab-close",{value:s,name:t,nextName:r},e):b("tab-close-fail",{value:s,name:t,nextName:r},e)};let T=null;const C=e=>{var t=m.value;if(t){t=Math.floor(.75*t.clientWidth);{var r=e;let n=t,i=6,s=35;clearTimeout(T);const u=()=>{var e,t,a,l=m.value;0<i&&(i--,l)&&({clientWidth:e,scrollWidth:t,scrollLeft:a}=l,n=Math.floor(n/2),0<r?e+a<t&&(l.scrollLeft+=n,s-=4,T=setTimeout(u,s)):0<a&&(l.scrollLeft-=n,s-=4,T=setTimeout(u,s)),d())};u()}}},w=()=>{C(-1)},V=()=>{C(1)},k=i=>{const s=o.value,r=v.value;return(0,_vue.nextTick)().then(()=>{var e,t,a,l,n=m.value;n&&(-1<(a=_xeUtils.default.findIndexOf(r.length?r:s,e=>e.name===i))&&({scrollLeft:e,clientWidth:t,children:l}=n,l=l[a])&&(0<(l=(a=l.offsetLeft)+l.clientWidth-(e+t))&&(n.scrollLeft+=l),a<e)&&(n.scrollLeft=a),d())})};t=n=>()=>{const t=_["activeName"];var a=o.value,l=v.value,l=l.length?l:a,a=_xeUtils.default.findIndexOf(l,e=>e.name===t);if(-1<a){let e=null;n?a<l.length-1&&(e=l[a+1]):0<a&&(e=l[a-1]),e&&(a=l=e.name,_.activeName=l,i("update:modelValue",a),g(l,null))}return(0,_vue.nextTick)()};const L={dispatchEvent:b,scrollToTab:k,prev:t(!1),next:t(!0),prevTab(){return(0,_log.warnLog)("vxe.error.delFunc",["prevTab","prev"]),L.prev()},nextTab(){return(0,_log.warnLog)("vxe.error.delFunc",["nextTab","next"]),L.next()}};Object.assign(c,L,{});const y=e=>{var{initNames:t,activeName:a}=_,{name:e,slots:l}=e,l=l?l.default:null;return e&&t.includes(e)?(0,_vue.h)("div",{key:e,class:["vxe-tabs-pane--item",{"is--visible":a===e,"has--content":!!l}]},l?f(l,{name:e}):[]):(0,_vue.createCommentVNode)()};(0,_vue.watch)(()=>h.modelValue,e=>{g(e,null),_.activeName=e}),(0,_vue.watch)(()=>_.activeName,e=>{k(e),(0,_vue.nextTick)(()=>{_.resizeFlag++})});const M=(0,_vue.ref)(0),W=((0,_vue.watch)(()=>h.options?h.options.length:-1,()=>{M.value++}),(0,_vue.watch)(()=>h.options,()=>{M.value++}),(0,_vue.watch)(M,()=>{p(h.options),d()}),(0,_vue.ref)(0));return(0,_vue.watch)(()=>_.staticTabs?_.staticTabs.length:-1,()=>{W.value++}),(0,_vue.watch)(()=>_.staticTabs,()=>{W.value++}),(0,_vue.watch)(W,()=>{p(_.staticTabs),d()}),a&&(0,_vue.watch)(()=>a?a.reactData.resizeFlag:null,()=>{_.resizeFlag++}),(0,_vue.watch)(()=>_.resizeFlag,()=>{(0,_vue.nextTick)(d)}),(0,_vue.nextTick)(()=>{_ui.globalEvents.on(c,"resize",d)}),(0,_vue.onMounted)(()=>{d()}),(0,_vue.onUnmounted)(()=>{_ui.globalEvents.off(c,"resize")}),c.renderVN=()=>{var{type:e,height:t,padding:a,trigger:l}=h,n=o.value,i=v.value,s=r.default,i=s?i:n;return(0,_vue.h)("div",{ref:u,class:["vxe-tabs","vxe-tabs--"+(e||"default"),"trigger--"+("manual"===l?"trigger":"default"),{"is--padding":a,"is--height":t}],style:t?{height:(0,_dom.toCssUnit)(t)}:null},[(0,_vue.h)("div",{class:"vxe-tabs-slots"},s?s({}):[]),(u=>{const{type:e,titleWidth:o,titleAlign:v,showClose:c}=h,{activeName:d,lintLeft:t,lintWidth:a,isTabOver:l}=_;var n=r.extra;return(0,_vue.h)("div",{class:"vxe-tabs-header"},[l?(0,_vue.h)("div",{class:"vxe-tabs-header--bar vxe-tabs-header--left-bar",onClick:w},[(0,_vue.h)("span",{class:(0,_ui.getIcon)().TABS_TAB_BUTTON_LEFT})]):(0,_vue.createCommentVNode)(),(0,_vue.h)("div",{class:"vxe-tabs-header--wrapper"},[(0,_vue.h)("div",{ref:m,class:"vxe-tabs-header--item-wrapper"},u.map((t,a)=>{var{title:e,titleWidth:l,titleAlign:n,icon:i,name:s,slots:r}=t,r=r?r.tab:null,l=l||o,n=n||v;return(0,_vue.h)("div",{key:""+s,class:["vxe-tabs-header--item",n?"align--"+n:"",{"is--active":d===s}],style:l?{width:(0,_dom.toCssUnit)(l)}:null,onClick(e){x(e,t)}},[(0,_vue.h)("div",{class:"vxe-tabs-header--item-inner"},[(0,_vue.h)("div",{class:"vxe-tabs-header--item-content"},[i?(0,_vue.h)("span",{class:"vxe-tabs-header--item-icon"},[(0,_vue.h)("i",{class:i})]):(0,_vue.createCommentVNode)(),(0,_vue.h)("span",{class:"vxe-tabs-header--item-name"},r?f(r,{name:s,title:e}):""+e)]),c?(0,_vue.h)("div",{class:"vxe-tabs-header--close-btn",onClick(e){N(e,t,a,u)}},[(0,_vue.h)("i",{class:(0,_ui.getIcon)().TABS_TAB_CLOSE})]):(0,_vue.createCommentVNode)()])])}).concat([(0,_vue.h)("span",{key:"line",class:"vxe-tabs-header--active-line type--"+(e||"default"),style:{left:t+"px",width:a+"px"}})]))]),l?(0,_vue.h)("div",{class:"vxe-tabs-header--bar vxe-tabs-header--right-bar",onClick:V},[(0,_vue.h)("span",{class:(0,_ui.getIcon)().TABS_TAB_BUTTON_RIGHT})]):(0,_vue.createCommentVNode)(),n?(0,_vue.h)("div",{class:"vxe-tabs-header--extra"},(0,_vn.getSlotVNs)(n({}))):(0,_vue.createCommentVNode)()])})(i),(0,_vue.h)("div",{class:"vxe-tabs-pane"},(e=>{var t=h["destroyOnClose"];const a=_["activeName"];var l=e.find(e=>e.name===a);return t?l?[y(l)]:(0,_vue.createCommentVNode)():e.map(y)})(i))])},(0,_vue.provide)("$xeTabs",c),g(h.modelValue,null),p(_.staticTabs.length?_.staticTabs:h.options),c},render(){return this.renderVN()}});