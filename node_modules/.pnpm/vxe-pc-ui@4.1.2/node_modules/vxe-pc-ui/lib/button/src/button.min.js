"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils"),_log=require("../../ui/src/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeButton",props:{type:String,mode:String,className:[String,Function],popupClassName:[String,Function],size:{type:String,default:()=>(0,_ui.getConfig)().button.size||(0,_ui.getConfig)().size},name:[String,Number],routerLink:Object,permissionCode:[String,Number],content:String,placement:String,status:String,title:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,trigger:{type:String,default:()=>(0,_ui.getConfig)().button.trigger},destroyOnClose:{type:Boolean,default:()=>(0,_ui.getConfig)().button.destroyOnClose},transfer:{type:Boolean,default:null}},emits:["click","mouseenter","mouseleave","dropdown-click"],setup(T,e){const{slots:y,emit:i}=e,n=(0,_vue.inject)("$xeModal",null),o=(0,_vue.inject)("$xeTable",null),u=(0,_vue.inject)("$xeForm",null),a=(0,_vue.inject)("$xeButtonGroup",null);var t=_xeUtils.default.uniqueId();const k=(0,_ui.useSize)(T)["computeSize"],N=(0,_ui.usePermission)(T)["computePermissionInfo"],P=(0,_vue.reactive)({inited:!1,visiblePanel:!1,animatVisible:!1,isActivated:!1,panelIndex:0,panelStyle:{},panelPlacement:""}),l={showTime:null},w=(0,_vue.ref)(),C=(0,_vue.ref)(),O=(0,_vue.ref)(),s={refElem:w},E={xID:t,props:T,context:e,reactData:P,internalData:l,getRefMaps:()=>s};let r={};const S=(0,_vue.computed)(()=>{var e=T["transfer"];if(null===e){var t=(0,_ui.getConfig)().button.transfer;if(_xeUtils.default.isBoolean(t))return t;if(o||n||u)return!0}return e}),I=(0,_vue.computed)(()=>{var e=T["disabled"],t=N.value;return e||t.disabled}),M=(0,_vue.computed)(()=>{var e=T["type"];return!!e&&-1<["submit","reset","button"].indexOf(e)}),U=(0,_vue.computed)(()=>{var{type:e,mode:t}=T;return"text"===t||"text"===e||a&&"text"===a.props.mode?"text":"button"}),$=(0,_vue.computed)(()=>{var e=T["status"];return e||(a?a.props.status:"")}),z=(0,_vue.computed)(()=>{var e=T["round"];return e||!!a&&a.props.round}),B=(0,_vue.computed)(()=>{var e=T["circle"];return e||!!a&&a.props.circle}),v=()=>{P.panelIndex<(0,_utils.getLastZIndex)()&&(P.panelIndex=(0,_utils.nextZIndex)())},d=()=>(0,_vue.nextTick)().then(()=>{var i=T["placement"],o=P["panelIndex"],u=C.value,a=O.value,e=S.value;if(a&&u){var l=u.offsetHeight,s=u.offsetWidth,r=a.offsetHeight,a=a.offsetWidth,o={zIndex:o},{top:u,left:v,boundingTop:d,visibleHeight:c,visibleWidth:p}=(0,_dom.getAbsolutePos)(u);let n="bottom";if(e){let e=v+s-a,t=u+l;"top"===i?(n="top",t=u-r):i||(c<d+l+r+5&&(n="top",t=u-r),t<5&&(n="bottom",t=u+l)),e+a+5>p&&(e-=e+a+5-p),e<5&&(e=5),Object.assign(o,{left:e+"px",right:"auto",top:t+"px",minWidth:s+"px"})}else"top"===i?(n="top",o.bottom=l+"px"):i||c<d+l+r&&5<d-l-r&&(n="top",o.bottom=l+"px");return P.panelStyle=o,P.panelPlacement=n,(0,_vue.nextTick)()}}),V=e=>{a?a.handleClick({name:T.name},e):r.dispatchEvent("click",{$event:e},e)},A=e=>{0===e.button&&e.stopPropagation()},W=e=>{var t=e.currentTarget;const n=O.value;var{flag:t,targetElem:i}=(0,_dom.getEventTargetNode)(e,t,"vxe-button");t&&(n&&(n.dataset.active="N"),P.visiblePanel=!1,setTimeout(()=>{n&&"Y"===n.dataset.active||(P.animatVisible=!1)},350),r.dispatchEvent("dropdown-click",{name:i.getAttribute("name"),$event:e},e))},j=()=>{const e=O.value;e&&(e.dataset.active="Y",P.animatVisible=!0,setTimeout(()=>{"Y"===e.dataset.active&&(P.visiblePanel=!0,v(),d(),setTimeout(()=>{P.visiblePanel&&d()},50))},20))},L=e=>{c(),D(e)},R=e=>{p(),F(e)},D=e=>{i("mouseenter",(0,_ui.createEvent)(e,{}))},F=e=>{i("mouseleave",(0,_ui.createEvent)(e,{}))},q=e=>{var t=T["trigger"];"click"===t&&(P.visiblePanel?p:c)(),V(e)},c=()=>{var e=T["trigger"];const t=O.value;return t&&(t.dataset.active="Y",P.inited||(P.inited=!0),l.showTime=setTimeout(()=>{"Y"===t.dataset.active?j():P.animatVisible=!1},"click"===e?50:250)),(0,_vue.nextTick)()},p=()=>{const e=O.value;return clearTimeout(l.showTime),e?(e.dataset.active="N",setTimeout(()=>{"Y"!==e.dataset.active&&(P.visiblePanel=!1,setTimeout(()=>{"Y"!==e.dataset.active&&(P.animatVisible=!1)},350))},100)):(P.animatVisible=!1,P.visiblePanel=!1),(0,_vue.nextTick)()},H=()=>{p()},Y=()=>{var{content:e,icon:t,loading:n}=T,i=[];return n?i.push((0,_vue.h)("i",{class:["vxe-button--loading-icon",(0,_ui.getIcon)().BUTTON_LOADING]})):y.icon?i.push((0,_vue.h)("span",{class:"vxe-button--custom-icon"},y.icon({}))):t&&i.push((0,_vue.h)("i",{class:["vxe-button--icon",t]})),y.default?i.push((0,_vue.h)("span",{class:"vxe-button--content"},y.default({}))):e&&i.push((0,_vue.h)("span",{class:"vxe-button--content"},(0,_utils.getFuncText)(e))),i},m=(r={dispatchEvent(e,t,n){i(e,(0,_ui.createEvent)(n,{$button:E},t))},openPanel:c,closePanel:p,focus(){return C.value.focus(),(0,_vue.nextTick)()},blur(){return C.value.blur(),(0,_vue.nextTick)()}},e=>{var t=O.value;P.visiblePanel&&!(0,_dom.getEventTargetNode)(e,t).flag&&p()}),b=e=>{var t,n=I.value,i=P["visiblePanel"];n||(n=w.value,t=O.value,P.isActivated=(0,_dom.getEventTargetNode)(e,n).flag||(0,_dom.getEventTargetNode)(e,t).flag,i&&!P.isActivated&&p())};Object.assign(E,r);return E.renderVN=()=>{var e,{className:t,popupClassName:n,trigger:i,title:o,routerLink:u,type:a,destroyOnClose:l,name:s,loading:r}=T,{inited:v,visiblePanel:d}=P,c=M.value,p=U.value,m=$.value,b=z.value,_=B.value,g=S.value,f=I.value,x=N.value,h=k.value;return x.visible?y.dropdowns?(x={},e={},"hover"===i&&(x.onMouseenter=L,x.onMouseleave=R,e.onMouseenter=j,e.onMouseleave=H),(0,_vue.h)("div",{ref:w,class:["vxe-button--dropdown",t?_xeUtils.default.isFunction(t)?t({$button:E}):t:"",{["size--"+h]:h,"is--active":d}]},[u?(0,_vue.h)((0,_vue.resolveComponent)("router-link"),Object.assign({ref:C,class:["vxe-button","vxe-button--link","type--"+p,t?_xeUtils.default.isFunction(t)?t({$button:E}):t:"",{["size--"+h]:h,["theme--"+m]:m,"is--round":b,"is--circle":_,"is--disabled":f||r,"is--loading":r}],title:o,name:s,type:c?a:"button",disabled:f||r,to:u,onClick:q},x),{default(){return Y().concat([(0,_vue.h)("i",{class:"vxe-button--dropdown-arrow "+(0,_ui.getIcon)().BUTTON_DROPDOWN})])}}):(0,_vue.h)("button",Object.assign({ref:C,class:["vxe-button","type--"+p,t?_xeUtils.default.isFunction(t)?t({$button:E}):t:"",{["size--"+h]:h,["theme--"+m]:m,"is--round":b,"is--circle":_,"is--disabled":f||r,"is--loading":r}],title:o,name:s,type:c?a:"button",disabled:f||r,onClick:q},x),Y().concat([(0,_vue.h)("i",{class:"vxe-button--dropdown-arrow "+(0,_ui.getIcon)().BUTTON_DROPDOWN})])),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!g||!v},[(0,_vue.h)("div",Object.assign({ref:O,class:["vxe-button--dropdown-panel",n?_xeUtils.default.isFunction(n)?n({$button:E}):n:"",{["size--"+h]:h,"animat--leave":P.animatVisible,"animat--enter":d}],placement:P.panelPlacement,style:P.panelStyle},e),v?[(0,_vue.h)("div",{class:"vxe-button--dropdown-wrapper",onMousedown:A,onClick:W},l&&!d?[]:y.dropdowns({}))]:[])])])):u?(0,_vue.h)((0,_vue.resolveComponent)("router-link"),{ref:C,class:["vxe-button","vxe-button--link","type--"+p,t?_xeUtils.default.isFunction(t)?t({$button:E}):t:"",{["size--"+h]:h,["theme--"+m]:m,"is--round":b,"is--circle":_,"is--disabled":f||r,"is--loading":r}],title:o,name:s,type:c?a:"button",disabled:f||r,to:u,onClick:V,onMouseenter:D,onMouseleave:F},{default(){return Y()}}):(0,_vue.h)("button",{ref:C,class:["vxe-button","type--"+p,t?_xeUtils.default.isFunction(t)?t({$button:E}):t:"",{["size--"+h]:h,["theme--"+m]:m,"is--round":b,"is--circle":_,"is--disabled":f||r,"is--loading":r}],title:o,name:s,type:c?a:"button",disabled:f||r,onClick:V,onMouseenter:D,onMouseleave:F},Y()):(0,_vue.createCommentVNode)()},(0,_vue.onMounted)(()=>{"development"===process.env.NODE_ENV&&"text"===T.type&&(0,_log.warnLog)("vxe.error.delProp",["type=text","mode=text"]),_ui.globalEvents.on(E,"mousewheel",m),_ui.globalEvents.on(E,"mousedown",b)}),(0,_vue.onUnmounted)(()=>{_ui.globalEvents.off(E,"mousewheel"),_ui.globalEvents.off(E,"mousedown")}),E},render(){return this.renderVN()}});