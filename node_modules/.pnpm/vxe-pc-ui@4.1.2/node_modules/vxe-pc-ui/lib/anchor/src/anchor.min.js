"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_anchorLink=_interopRequireDefault(require("./anchor-link"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeAnchor",props:{modelValue:String,options:Array,container:[String,Object,Function],showMarker:{type:Boolean,default:!0}},emits:["update:modelValue","change","click"],setup(n,e){const{slots:u,emit:i}=e;var t=_xeUtils.default.uniqueId();const a=(0,_vue.ref)(),o=(0,_vue.ref)(),l=(0,_vue.reactive)({activeHref:null,staticLinks:[]}),r={refElem:a},c=(0,_vue.computed)(()=>{const t=[];return _xeUtils.default.eachTree(l.staticLinks,e=>{t.push(e.href||"")},{children:"children"}),t}),s={};let v=null;const d={xID:t,props:n,context:e,reactData:l,getRefMaps:()=>r,getComputeMaps:()=>s},f={dispatchEvent(e,t,r){i(e,(0,_ui.createEvent)(r,{$anchor:d},t))}},h=()=>{var e=c.value;if(v){var t=v.querySelectorAll(e.map(e=>""+e).join(","));for(let e=0;e<t.length;e++){var r=t[e];if(0<r.getBoundingClientRect().top){r=r.id;l.activeHref="#"+r;break}}}},_=()=>{v&&v.removeEventListener("scroll",h)},p=()=>{(v=(()=>{var e=n["container"];if(e){if(_xeUtils.default.isElement(e))return e;if(_xeUtils.default.isString(e))return document.querySelector(e);if(_xeUtils.default.isFunction(e))return e({$anchor:d})}return null})())&&v.addEventListener("scroll",h,{passive:!1})},m=(Object.assign(d,f,{handleClickLink(e,t){e.preventDefault();var r=document.getElementById((""+t).replace("#",""));r&&r.scrollIntoView({behavior:"smooth"}),r=t,l.activeHref=r,i("update:modelValue",r),f.dispatchEvent("click",{href:t},e)}}),e=>{const r=[];return e&&e.forEach(e=>{const t=e.children;t&&t.length?r.push((0,_vue.h)(_anchorLink.default,{content:e.content,title:e.title,href:e.href},{sub:()=>m(t)})):r.push((0,_vue.h)(_anchorLink.default,{content:e.content,title:e.title,href:e.href}))}),r});return(0,_vue.watch)(()=>n.modelValue,e=>{l.activeHref=e}),(0,_vue.watch)(()=>l.activeHref,()=>{(0,_vue.nextTick)(()=>{var e=l["activeHref"],t=a.value,r=o.value;t&&r&&e&&(e=t.querySelector(`[href="${e}"]`))&&(e=(0,_dom.getOffsetPos)(e,t)["top"],r.style.top=e+"px")})}),(0,_vue.watch)(()=>n.container,()=>{_(),p()}),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{p()})}),(0,_vue.onBeforeUnmount)(()=>{_()}),d.renderVN=()=>{var{options:e,showMarker:t}=n,r=u.default;return(0,_vue.h)("div",{ref:a,class:["vxe-anchor",{"is--marker":t}]},[(0,_vue.h)("div",{class:"vxe-anchor--list"},r?r({}):m(e)),t?(0,_vue.h)("div",{ref:o,class:"vxe-anchor--marker"}):(0,_vue.createCommentVNode)()])},(0,_vue.provide)("$xeAnchor",d),d},render(){return this.renderVN()}});