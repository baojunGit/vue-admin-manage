"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_log=require("../../ui/src/log"),_select=_interopRequireDefault(require("../../select/src/select")),_input=_interopRequireDefault(require("../../input/src/input"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxePager",props:{size:{type:String,default:()=>(0,_ui.getConfig)().pager.size||(0,_ui.getConfig)().size},layouts:{type:Array,default:()=>(0,_ui.getConfig)().pager.layouts||["PrevJump","PrevPage","Jump","PageCount","NextPage","NextJump","Sizes","Total"]},currentPage:{type:Number,default:1},loading:Boolean,pageSize:{type:Number,default:()=>(0,_ui.getConfig)().pager.pageSize||10},total:{type:Number,default:0},pagerCount:{type:Number,default:()=>(0,_ui.getConfig)().pager.pagerCount||7},pageSizes:{type:Array,default:()=>(0,_ui.getConfig)().pager.pageSizes||[10,15,20,50,100]},align:{type:String,default:()=>(0,_ui.getConfig)().pager.align},border:{type:Boolean,default:()=>(0,_ui.getConfig)().pager.border},background:{type:Boolean,default:()=>(0,_ui.getConfig)().pager.background},perfect:{type:Boolean,default:()=>(0,_ui.getConfig)().pager.perfect},autoHidden:{type:Boolean,default:()=>(0,_ui.getConfig)().pager.autoHidden},transfer:{type:Boolean,default:()=>(0,_ui.getConfig)().pager.transfer},className:[String,Function],pageSizePlacement:{type:String,default:()=>(0,_ui.getConfig)().pager.pageSizePlacement},iconPrevPage:String,iconJumpPrev:String,iconJumpNext:String,iconNextPage:String,iconJumpMore:String,iconHomePage:String,iconEndPage:String},emits:["update:pageSize","update:currentPage","page-change"],setup(s,e){const{slots:i,emit:u}=e;var t=_xeUtils.default.uniqueId();const g=(0,_ui.useSize)(s)["computeSize"],p=(0,_vue.inject)("$xeGrid",null),n=(0,_vue.reactive)({inpCurrPage:s.currentPage}),l=(0,_vue.ref)(),a={refElem:l},o={xID:t,props:s,context:e,getRefMaps:()=>a};let c={};const v=(e,t)=>Math.max(Math.ceil(e/t),1),_=(0,_vue.computed)(()=>v(s.total,s.pageSize)),d=(e,t)=>{u("update:currentPage",t),e&&t!==s.currentPage&&c.dispatchEvent("page-change",{type:"current",pageSize:s.pageSize,currentPage:t},e)},x=(e,t)=>{u("update:currentPage",e),t&&e!==s.currentPage&&c.dispatchEvent("page-change",{type:"current",pageSize:s.pageSize,currentPage:e},t)},r=e=>{var e=e["$event"],t=e.target,a=_xeUtils.default.toInteger(t.value),r=_.value,r=a<=0?1:r<=a?r:a,a=_xeUtils.default.toValueString(r);t.value=a,n.inpCurrPage=a,x(r,e)},P=(0,_vue.computed)(()=>{var e=s["pagerCount"],t=e<_.value?e-2:e,a=[];for(let e=0;e<t;e++)a.push(e);return a}),h=(0,_vue.computed)(()=>Math.floor((s.pagerCount-2)/2)),m=(0,_vue.computed)(()=>s.pageSizes.map(e=>_xeUtils.default.isNumber(e)?{value:e,label:""+(0,_ui.getI18n)("vxe.pager.pagesize",[e])}:Object.assign({value:"",label:""},e))),b=e=>{var t=s["currentPage"];1<t&&x(1,e)},f=e=>{var t=s["currentPage"],a=_.value;t<a&&x(a,e)},E=e=>{var t=s["currentPage"],a=_.value;1<t&&x(Math.min(a,Math.max(t-1,1)),e)},y=e=>{var t=s["currentPage"],a=_.value;t<a&&x(Math.min(a,t+1),e)},C=e=>{var t=P.value;x(Math.max(s.currentPage-t.length,1),e)},S=e=>{var t=_.value,a=P.value;x(Math.min(s.currentPage+a.length,t),e)},k=e=>{var t=e["value"],t=_xeUtils.default.toNumber(t),a=v(s.total,t);let r=s.currentPage;r>a&&(r=a,u("update:currentPage",a)),u("update:pageSize",t),c.dispatchEvent("page-change",{type:"size",pageSize:t,currentPage:r},e.$event)},N=e=>{var t=e["$event"];_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ENTER)?r(e):_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ARROW_UP)?(t.preventDefault(),y(t)):_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ARROW_DOWN)&&(t.preventDefault(),E(t))},z=()=>(0,_vue.h)("button",{class:["vxe-pager--prev-btn",{"is--disabled":s.currentPage<=1}],type:"button",title:(0,_ui.getI18n)("vxe.pager.homePageTitle"),onClick:b},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconHomePage||(0,_ui.getIcon)().PAGER_HOME]})]),J=()=>(0,_vue.h)("button",{class:["vxe-pager--prev-btn",{"is--disabled":s.currentPage<=1}],type:"button",title:(0,_ui.getI18n)("vxe.pager.prevPageTitle"),onClick:E},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconPrevPage||(0,_ui.getIcon)().PAGER_PREV_PAGE]})]),M=e=>(0,_vue.h)(e||"button",{class:["vxe-pager--jump-prev",{"is--fixed":!e,"is--disabled":s.currentPage<=1}],type:"button",title:(0,_ui.getI18n)("vxe.pager.prevJumpTitle"),onClick:C},[e?(0,_vue.h)("i",{class:["vxe-pager--jump-more-icon",s.iconJumpMore||(0,_ui.getIcon)().PAGER_JUMP_MORE]}):null,(0,_vue.h)("i",{class:["vxe-pager--jump-icon",s.iconJumpPrev||(0,_ui.getIcon)().PAGER_JUMP_PREV]})]),I=e=>{var t=_.value;return(0,_vue.h)(e||"button",{class:["vxe-pager--jump-next",{"is--fixed":!e,"is--disabled":s.currentPage>=t}],type:"button",title:(0,_ui.getI18n)("vxe.pager.nextJumpTitle"),onClick:S},[e?(0,_vue.h)("i",{class:["vxe-pager--jump-more-icon",s.iconJumpMore||(0,_ui.getIcon)().PAGER_JUMP_MORE]}):null,(0,_vue.h)("i",{class:["vxe-pager--jump-icon",s.iconJumpNext||(0,_ui.getIcon)().PAGER_JUMP_NEXT]})])},R=()=>{var e=_.value;return(0,_vue.h)("button",{class:["vxe-pager--next-btn",{"is--disabled":s.currentPage>=e}],type:"button",title:(0,_ui.getI18n)("vxe.pager.nextPageTitle"),onClick:y},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconNextPage||(0,_ui.getIcon)().PAGER_NEXT_PAGE]})])},T=()=>{var e=_.value;return(0,_vue.h)("button",{class:["vxe-pager--prev-btn",{"is--disabled":s.currentPage>=e}],type:"button",title:(0,_ui.getI18n)("vxe.pager.endPageTitle"),onClick:f},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconEndPage||(0,_ui.getIcon)().PAGER_END]})])},A=e=>{const{currentPage:r,pagerCount:t}=s,u=[],n=_.value;var a=P.value,i=h.value,g=n>t,p=g&&r>i+1,l=g&&r<n-i;let o=1;return g&&(o=r>=n-i?Math.max(n-a.length+1,1):Math.max(r-i,1)),e&&p&&u.push((0,_vue.h)("button",{class:"vxe-pager--num-btn",type:"button",onClick:e=>d(e,1)},1),M("span")),a.forEach((e,t)=>{const a=o+t;a<=n&&u.push((0,_vue.h)("button",{key:a,class:["vxe-pager--num-btn",{"is--active":r===a}],type:"button",onClick:e=>d(e,a)},a))}),e&&l&&u.push(I("button"),(0,_vue.h)("button",{class:"vxe-pager--num-btn",type:"button",onClick:e=>d(e,n)},n)),(0,_vue.h)("span",{class:"vxe-pager--btn-wrapper"},u)},O=()=>A(!0),U=()=>{var e=m.value;return(0,_vue.h)(_select.default,{class:"vxe-pager--sizes",modelValue:s.pageSize,placement:s.pageSizePlacement,transfer:s.transfer,options:e,onChange:k})},G=e=>{var t=_.value;return(0,_vue.h)("span",{class:"vxe-pager--jump"},[e?(0,_vue.h)("span",{class:"vxe-pager--goto-text"},(0,_ui.getI18n)("vxe.pager.goto")):null,(0,_vue.h)(_input.default,{class:"vxe-pager--goto",modelValue:n.inpCurrPage,placeholder:(0,_ui.getI18n)("vxe.pager.gotoTitle"),align:"center",type:"integer",max:t,min:1,controls:!1,onKeydown:N,onBlur:r,"onUpdate:modelValue"(e){n.inpCurrPage=e}}),e?(0,_vue.h)("span",{class:"vxe-pager--classifier-text"},(0,_ui.getI18n)("vxe.pager.pageClassifier")):null])},V=()=>G(!0),j=()=>{var e=_.value;return(0,_vue.h)("span",{class:"vxe-pager--count"},[(0,_vue.h)("span",{class:"vxe-pager--separator"}),(0,_vue.h)("span",e)])},q=()=>(0,_vue.h)("span",{class:"vxe-pager--total"},(0,_ui.getI18n)("vxe.pager.total",[s.total]));c={dispatchEvent(e,t,a){u(e,(0,_ui.createEvent)(a,{$pager:o},t))},homePage(){return b(),(0,_vue.nextTick)()},endPage(){return f(),(0,_vue.nextTick)()},prevPage(){return E(),(0,_vue.nextTick)()},nextPage(){return y(),(0,_vue.nextTick)()},prevJump(){return C(),(0,_vue.nextTick)()},nextJump(){return S(),(0,_vue.nextTick)()}},t={handlePrevPage:E,handleNextPage:y,handlePrevJump:C,handleNextJump:S},Object.assign(o,c,t),(0,_vue.watch)(()=>s.currentPage,e=>{n.inpCurrPage=e});return o.renderVN=()=>{var{align:e,layouts:t,className:a}=s;const r=[];var u=g.value,n=_.value;return i.left&&r.push((0,_vue.h)("span",{class:"vxe-pager--left-wrapper"},i.left({$grid:p}))),t.forEach(e=>{let t;switch(e){case"Home":t=z;break;case"PrevJump":t=M;break;case"PrevPage":t=J;break;case"Number":t=A;break;case"JumpNumber":t=O;break;case"NextPage":t=R;break;case"NextJump":t=I;break;case"End":t=T;break;case"Sizes":t=U;break;case"FullJump":t=V;break;case"Jump":t=G;break;case"PageCount":t=j;break;case"Total":t=q}t?r.push(t()):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notProp",["layouts -> "+e])}),i.right&&r.push((0,_vue.h)("span",{class:"vxe-pager--right-wrapper"},i.right({$grid:p}))),(0,_vue.h)("div",{ref:l,class:["vxe-pager",a?_xeUtils.default.isFunction(a)?a({$pager:o}):a:"",{["size--"+u]:u,["align--"+e]:e,"is--border":s.border,"is--background":s.background,"is--perfect":s.perfect,"is--hidden":s.autoHidden&&1===n,"is--loading":s.loading}]},[(0,_vue.h)("div",{class:"vxe-pager--wrapper"},r)])},o},render(){return this.renderVN()}});