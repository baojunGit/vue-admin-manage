"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const renderType="footer";function mergeFooterMethod(l,t,o){for(let e=0;e<l.length;e++){var{row:r,col:a,rowspan:n,colspan:s}=l[e];if(-1<a&&-1<r&&n&&s){if(r===t&&a===o)return{rowspan:n,colspan:s};if(r<=t&&t<r+n&&a<=o&&o<a+s)return{rowspan:0,colspan:0}}}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeTableFooter",props:{footerTableData:{type:Array,default:()=>[]},tableColumn:{type:Array,default:()=>[]},fixedColumn:{type:Array,default:()=>[]},fixedType:{type:String,default:null}},setup(i){const A=(0,_vue.inject)("$xetable",{}),{xID:a,props:n,reactData:u,internalData:c}=A,{refTableHeader:d,refTableBody:p,refValidTooltip:f}=A.getRefMaps(),{computeTooltipOpts:s,computeColumnOpts:v}=A.getComputeMaps(),x=(0,_vue.ref)(),m=(0,_vue.ref)(),_=(0,_vue.ref)(),g=(0,_vue.ref)(),y=(0,_vue.ref)(),E=e=>{var l=i["fixedType"],t=u["scrollXLoad"],o=c["lastScrollLeft"],r=f.value,a=d.value,n=p.value,a=a?a.$el:null,s=x.value,n=n.$el,s=s.scrollLeft,o=s!==o;c.lastScrollLeft=s,u.lastScrollTime=Date.now(),a&&(a.scrollLeft=s),n&&(n.scrollLeft=s),t&&o&&A.triggerScrollXEvent(e),o&&r&&r.reactData.visible&&r.updatePlacement(),A.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:n.scrollTop,scrollLeft:s,isX:o,isY:!1},e)};(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var e=i["fixedType"],l=c["elemStore"],e=`${e||"main"}-footer-`;l[e+"wrapper"]=x,l[e+"table"]=m,l[e+"colgroup"]=_,l[e+"list"]=g,l[e+"xSpace"]=y})}),(0,_vue.onUnmounted)(()=>{var e=i["fixedType"],l=c["elemStore"],e=`${e||"main"}-footer-`;l[e+"wrapper"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null});return()=>{let{fixedType:b,fixedColumn:e,tableColumn:h,footerTableData:w}=i;const{footerRowClassName:l,footerCellClassName:T,footerRowStyle:t,footerCellStyle:C,footerAlign:S,footerSpanMethod:I,align:$,columnKey:F,showFooterOverflow:O}=n;var o=c["visibleColumn"];const{scrollXLoad:D,overflowX:L,scrollbarWidth:r,currentColumn:M,mergeFooterList:j}=u,U=s.value,k=v.value;return b&&(h=u.expandColumn||!D&&!O||j.length&&I?o:e),(0,_vue.h)("div",{ref:x,class:["vxe-table--footer-wrapper",b?`fixed-${b}--wrapper`:"body--wrapper"],xid:a,onScroll:E},[b?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:y,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:m,class:"vxe-table--footer",xid:a,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:_},h.map((e,l)=>(0,_vue.h)("col",{name:e.id,key:l})).concat(r?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("tfoot",{ref:g},w.map((_,g)=>{const y=g;var e={$table:A,row:_,_rowIndex:g,$rowIndex:y,fixed:b,type:renderType};return(0,_vue.h)("tr",{class:["vxe-footer--row",l?_xeUtils.default.isFunction(l)?l(e):l:""],style:t?_xeUtils.default.isFunction(t)?t(e):t:null},h.map((l,e)=>{var{type:t,showFooterOverflow:o,footerAlign:r,align:a,footerClassName:n}=l;const s=U.showAll;var i=l.children&&l.children.length,i=b?l.fixed!==b&&!i:l.fixed&&L,o=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?O:o,r=r||a||S||$;let u="ellipsis"===o;const c="title"===o,d=!0===o||"tooltip"===o;let p=c||d||u;var a={colid:l.id},o={},f=A.getColumnIndex(l),v=A.getVTColumnIndex(l),x=v;const m={$table:A,$grid:A.xegrid,row:_,rowIndex:g,_rowIndex:g,$rowIndex:y,column:l,columnIndex:f,$columnIndex:e,_columnIndex:v,itemIndex:x,items:_,fixed:b,type:renderType,data:w};if(D&&!p&&(u=p=!0),(c||d||s)&&(o.onMouseenter=e=>{c?(0,_dom.updateCellTitle)(e.currentTarget,l):(d||s)&&A.triggerFooterTooltipEvent(e,m)}),(d||s)&&(o.onMouseleave=e=>{(d||s)&&A.handleTargetLeaveEvent(e)}),o.onClick=e=>{A.dispatchEvent("footer-cell-click",Object.assign({cell:e.currentTarget},m),e)},o.onDblclick=e=>{A.dispatchEvent("footer-cell-dblclick",Object.assign({cell:e.currentTarget},m),e)},j.length){f=mergeFooterMethod(j,g,v);if(f){var{rowspan:x,colspan:v}=f;if(!x||!v)return null;1<x&&(a.rowspan=x),1<v&&(a.colspan=v)}}else if(I){var{rowspan:f=1,colspan:x=1}=I(m)||{};if(!f||!x)return null;1<f&&(a.rowspan=f),1<x&&(a.colspan=x)}return(0,_vue.h)("td",Object.assign(Object.assign(Object.assign(Object.assign({class:["vxe-footer--column",l.id,{["col--"+r]:r,["col--"+t]:t,"col--last":e===h.length-1,"fixed--hidden":i,"col--ellipsis":p,"col--current":M===l},(0,_dom.getPropClass)(n,m),(0,_dom.getPropClass)(T,m)]},a),{style:C?_xeUtils.default.isFunction(C)?C(m):C:null}),o),{key:F||k.useKey?l.id:e}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":c,"c--tooltip":d,"c--ellipsis":u}]},l.renderFooter(m))])}).concat(r?[(0,_vue.h)("td",{class:"vxe-footer--gutter col--gutter"})]:[]))}))])])}}});