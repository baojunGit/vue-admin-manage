"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeButton",props:{type:String,mode:String,className:[String,Function],popupClassName:[String,Function],size:{type:String,default:()=>_conf.default.button.size||_conf.default.size},name:[String,Number],content:String,placement:String,status:String,title:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,destroyOnClose:Boolean,transfer:{type:Boolean,default:()=>_conf.default.button.transfer}},emits:["click","mouseenter","mouseleave","dropdown-click"],setup(b,e){const{slots:x,emit:o}=e;var t=_xeUtils.default.uniqueId();const h=(0,_size.useSize)(b),g=(0,_vue.reactive)({inited:!1,showPanel:!1,animatVisible:!1,panelIndex:0,panelStyle:{},panelPlacement:""}),n={showTime:null},w=(0,_vue.ref)(),T=(0,_vue.ref)(),y=(0,_vue.ref)(),a={refElem:w},N={xID:t,props:b,context:e,reactData:g,internalData:n,getRefMaps:()=>a},i=(0,_vue.inject)("$xebuttongroup",null);let s={};const P=(0,_vue.computed)(()=>{var e=b["type"];return!!e&&-1<["submit","reset","button"].indexOf(e)}),S=(0,_vue.computed)(()=>{var{type:e,mode:t}=b;return"text"===t||"text"===e||i&&"text"===i.props.mode?"text":"button"}),k=(0,_vue.computed)(()=>{var e=b["status"];return e||(i?i.props.status:"")}),z=(0,_vue.computed)(()=>{var e=b["round"];return e||!!i&&i.props.round}),O=(0,_vue.computed)(()=>{var e=b["circle"];return e||!!i&&i.props.circle}),u=()=>{g.panelIndex<(0,_utils.getLastZIndex)()&&(g.panelIndex=(0,_utils.nextZIndex)())},l=()=>(0,_vue.nextTick)().then(()=>{var{transfer:e,placement:o}=b,a=g["panelIndex"],i=T.value,s=y.value;if(s&&i){var u=i.offsetHeight,l=i.offsetWidth,r=s.offsetHeight,s=s.offsetWidth,a={zIndex:a},{top:i,left:d,boundingTop:v,visibleHeight:c,visibleWidth:p}=(0,_dom.getAbsolutePos)(i);let n="bottom";if(e){let e=d+l-s,t=i+u;"top"===o?(n="top",t=i-r):o||(c<v+u+r+5&&(n="top",t=i-r),t<5&&(n="bottom",t=i+u)),e+s+5>p&&(e-=e+s+5-p),e<5&&(e=5),Object.assign(a,{left:e+"px",right:"auto",top:t+"px",minWidth:l+"px"})}else"top"===o?(n="top",a.bottom=u+"px"):o||c<v+u+r&&5<v-u-r&&(n="top",a.bottom=u+"px");return g.panelStyle=a,g.panelPlacement=n,(0,_vue.nextTick)()}}),q=e=>{i?i.handleClick({name:b.name},e):s.dispatchEvent("click",{$event:e},e)},M=e=>{0===e.button&&e.stopPropagation()},I=e=>{var t=e.currentTarget;const n=y.value;var{flag:t,targetElem:o}=(0,_dom.getEventTargetNode)(e,t,"vxe-button");t&&(n&&(n.dataset.active="N"),g.showPanel=!1,setTimeout(()=>{n&&"Y"===n.dataset.active||(g.animatVisible=!1)},350),s.dispatchEvent("dropdown-click",{name:o.getAttribute("name"),$event:e},e))},V=()=>{const e=y.value;e&&(e.dataset.active="Y",g.animatVisible=!0,setTimeout(()=>{"Y"===e.dataset.active&&(g.showPanel=!0,u(),l(),setTimeout(()=>{g.showPanel&&l()},50))},20))},$=e=>{const t=y.value;t&&(t.dataset.active="Y",g.inited||(g.inited=!0),n.showTime=setTimeout(()=>{"Y"===t.dataset.active?V():g.animatVisible=!1},250)),C(e)},B=e=>{r(),D(e)},C=e=>{o("mouseenter",{$event:e})},D=e=>{o("mouseleave",{$event:e})},r=()=>{const e=y.value;clearTimeout(n.showTime),e?(e.dataset.active="N",setTimeout(()=>{"Y"!==e.dataset.active&&(g.showPanel=!1,setTimeout(()=>{"Y"!==e.dataset.active&&(g.animatVisible=!1)},350))},100)):(g.animatVisible=!1,g.showPanel=!1)},E=()=>{r()},U=()=>{var{content:e,icon:t,loading:n}=b,o=[];return n?o.push((0,_vue.h)("i",{class:["vxe-button--loading-icon",_conf.default.icon.BUTTON_LOADING]})):x.icon?o.push((0,_vue.h)("span",{class:"vxe-button--custom-icon"},x.icon({}))):t&&o.push((0,_vue.h)("i",{class:["vxe-button--icon",t]})),x.default?o.push((0,_vue.h)("span",{class:"vxe-button--content"},x.default({}))):e&&o.push((0,_vue.h)("span",{class:"vxe-button--content"},(0,_utils.getFuncText)(e))),o};s={dispatchEvent(e,t,n){o(e,Object.assign({$button:N,$event:n},t))},focus(){return T.value.focus(),(0,_vue.nextTick)()},blur(){return T.value.blur(),(0,_vue.nextTick)()}},Object.assign(N,s),(0,_vue.onMounted)(()=>{_event.GlobalEvent.on(N,"mousewheel",e=>{var t=y.value;g.showPanel&&!(0,_dom.getEventTargetNode)(e,t).flag&&r()})}),(0,_vue.onUnmounted)(()=>{_event.GlobalEvent.off(N,"mousewheel")});return N.renderVN=()=>{var{className:e,popupClassName:t,transfer:n,title:o,type:a,destroyOnClose:i,name:s,disabled:u,loading:l}=b,{inited:r,showPanel:d}=g,v=P.value,c=S.value,p=k.value,m=z.value,_=O.value,f=h.value;return x.dropdowns?(0,_vue.h)("div",{ref:w,class:["vxe-button--dropdown",e?_xeUtils.default.isFunction(e)?e({$button:N}):e:"",{["size--"+f]:f,"is--active":d}]},[(0,_vue.h)("button",{ref:T,class:["vxe-button","type--"+c,{["size--"+f]:f,["theme--"+p]:p,"is--round":m,"is--circle":_,"is--disabled":u||l,"is--loading":l}],title:o,name:s,type:v?a:"button",disabled:u||l,onMouseenter:$,onMouseleave:B,onClick:q},U().concat([(0,_vue.h)("i",{class:"vxe-button--dropdown-arrow "+_conf.default.icon.BUTTON_DROPDOWN})])),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!n||!r},[(0,_vue.h)("div",{ref:y,class:["vxe-button--dropdown-panel",t?_xeUtils.default.isFunction(t)?t({$button:N}):t:"",{["size--"+f]:f,"animat--leave":g.animatVisible,"animat--enter":d}],placement:g.panelPlacement,style:g.panelStyle},r?[(0,_vue.h)("div",{class:"vxe-button--dropdown-wrapper",onMousedown:M,onClick:I,onMouseenter:V,onMouseleave:E},i&&!d?[]:x.dropdowns({}))]:[])])]):(0,_vue.h)("button",{ref:T,class:["vxe-button","type--"+c,e?_xeUtils.default.isFunction(e)?e({$button:N}):e:"",{["size--"+f]:f,["theme--"+p]:p,"is--round":m,"is--circle":_,"is--disabled":u||l,"is--loading":l}],title:o,name:s,type:v?a:"button",disabled:u||l,onClick:q,onMouseenter:C,onMouseleave:D},U())},N},render(){return this.renderVN()}});