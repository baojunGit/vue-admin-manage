"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_utils=require("../../tools/utils"),_size=require("../../hooks/size");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let autoTxtElem;var _default=exports.default=(0,_vue.defineComponent)({name:"VxeTextarea",props:{modelValue:[String,Number],className:String,immediate:{type:Boolean,default:!0},name:String,readonly:Boolean,disabled:Boolean,placeholder:{type:String,default:()=>_xeUtils.default.eqNull(_conf.default.textarea.placeholder)?_conf.default.i18n("vxe.base.pleaseInput"):_conf.default.textarea.placeholder},maxlength:[String,Number],rows:{type:[String,Number],default:2},cols:{type:[String,Number],default:null},showWordCount:Boolean,countMethod:Function,autosize:[Boolean,Object],form:String,resize:{type:String,default:()=>_conf.default.textarea.resize},size:{type:String,default:()=>_conf.default.textarea.size||_conf.default.size}},emits:["update:modelValue","input","keydown","keyup","click","change","focus","blur"],setup(v,e){const u=e["emit"],a=(0,_vue.inject)("$xeform",null),l=(0,_vue.inject)("$xeformiteminfo",null);var t=_xeUtils.default.uniqueId();const x=(0,_size.useSize)(v),f=(0,_vue.reactive)({inputValue:v.modelValue}),_=(0,_vue.ref)(),g=(0,_vue.ref)(),i={refElem:_,refTextarea:g},o={xID:t,props:v,context:e,reactData:f,getRefMaps:()=>i};let n;const h=(0,_vue.computed)(()=>_xeUtils.default.getSize(f.inputValue)),b=(0,_vue.computed)(()=>{var e=h.value;return v.maxlength&&e>_xeUtils.default.toNumber(v.maxlength)}),r=(0,_vue.computed)(()=>Object.assign({minRows:1,maxRows:10},_conf.default.textarea.autosize,v.autosize)),s=()=>{var e,{size:t,autosize:a}=v,u=f["inputValue"];a&&((autoTxtElem=autoTxtElem||document.createElement("div")).parentNode||document.body.appendChild(autoTxtElem),a=g.value,e=getComputedStyle(a),autoTxtElem.className=["vxe-textarea--autosize",t?"size--"+t:""].join(" "),autoTxtElem.style.width=a.clientWidth+"px",autoTxtElem.style.padding=e.padding,autoTxtElem.innerText=(""+(u||"　")).replace(/\n$/,"\n　"))},d=()=>{v.autosize&&(0,_vue.nextTick)(()=>{var{minRows:e,maxRows:t}=r.value,a=g.value,u=autoTxtElem.clientHeight,l=getComputedStyle(a),i=_xeUtils.default.toNumber(l.lineHeight),l=_xeUtils.default.toNumber(l.paddingTop)+_xeUtils.default.toNumber(l.paddingBottom)+_xeUtils.default.toNumber(l.borderTopWidth)+_xeUtils.default.toNumber(l.borderBottomWidth),u=(u-l)/i,u=u&&/[0-9]/.test(""+u)?u:Math.floor(u)+1;let o=u;u<e?o=e:t<u&&(o=t),a.style.height=o*i+l+"px"})},z=e=>{var t=f.inputValue;o.dispatchEvent(e.type,{value:t},e)},c=(e,t)=>{f.inputValue=e,u("update:modelValue",e),_xeUtils.default.toValueString(v.modelValue)!==e&&(n.dispatchEvent("change",{value:e},t),a)&&l&&a.triggerItemEvent(t,l.itemConfig.field,e)},y=e=>{var t=v["immediate"],a=e.target.value;f.inputValue=a,t&&c(a,e),o.dispatchEvent("input",{value:a},e),d()},V=e=>{var t=v["immediate"];t?z(e):c(f.inputValue,e)},N=e=>{var t=v["immediate"],a=f["inputValue"];t||c(a,e),o.dispatchEvent("blur",{value:a},e)};n={dispatchEvent(e,t,a){u(e,Object.assign({$textarea:o,$event:a},t))},focus(){return g.value.focus(),(0,_vue.nextTick)()},blur(){return g.value.blur(),(0,_vue.nextTick)()}},Object.assign(o,n),(0,_vue.watch)(()=>v.modelValue,e=>{f.inputValue=e,s()}),(0,_vue.nextTick)(()=>{var e=v["autosize"];e&&(s(),d())});return o.renderVN=()=>{var{className:e,resize:t,placeholder:a,disabled:u,maxlength:l,autosize:i,showWordCount:o,countMethod:n,rows:r,cols:s}=v,d=f["inputValue"],c=x.value,m=b.value,p=h.value;return(0,_vue.h)("div",{ref:_,class:["vxe-textarea",e,{["size--"+c]:c,"is--autosize":i,"is--count":o,"is--disabled":u,"def--rows":!_xeUtils.default.eqNull(r),"def--cols":!_xeUtils.default.eqNull(s)}]},[(0,_vue.h)("textarea",{ref:g,class:"vxe-textarea--inner",value:d,name:v.name,placeholder:a?(0,_utils.getFuncText)(a):null,maxlength:l,readonly:v.readonly,disabled:u,rows:r,cols:s,style:t?{resize:t}:null,onInput:y,onChange:V,onKeydown:z,onKeyup:z,onClick:z,onFocus:z,onBlur:N}),o?(0,_vue.h)("span",{class:["vxe-textarea--count",{"is--error":m}]},n?""+n({value:d}):p+(l?"/"+l:"")):null])},o},render(){return this.renderVN()}});