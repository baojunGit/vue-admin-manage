"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_event=require("../../tools/event"),_date=require("./date"),_number=require("./number");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const yearSize=12,monthSize=20,quarterSize=8;var _default=exports.default=(0,_vue.defineComponent)({name:"VxeInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:()=>_conf.default.input.clearable},readonly:Boolean,disabled:Boolean,placeholder:{type:String,default:()=>_xeUtils.default.eqNull(_conf.default.input.placeholder)?_conf.default.i18n("vxe.base.pleaseInput"):_conf.default.input.placeholder},maxlength:[String,Number],autocomplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:()=>_conf.default.input.size||_conf.default.size},multiple:Boolean,showWordCount:Boolean,countMethod:Function,min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],exponential:{type:Boolean,default:()=>_conf.default.input.exponential},controls:{type:Boolean,default:()=>_conf.default.input.controls},digits:{type:[String,Number],default:()=>_conf.default.input.digits},startDate:{type:[String,Number,Date],default:()=>_conf.default.input.startDate},endDate:{type:[String,Number,Date],default:()=>_conf.default.input.endDate},minDate:[String,Number,Date],maxDate:[String,Number,Date],startWeek:Number,startDay:{type:[String,Number],default:()=>_conf.default.input.startDay},labelFormat:{type:String,default:()=>_conf.default.input.labelFormat},valueFormat:{type:String,default:()=>_conf.default.input.valueFormat},editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:()=>_conf.default.input.festivalMethod},disabledMethod:{type:Function,default:()=>_conf.default.input.disabledMethod},selectDay:{type:[String,Number],default:()=>_conf.default.input.selectDay},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:()=>_conf.default.input.transfer}},emits:["update:modelValue","input","change","keydown","keyup","wheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click","date-prev","date-today","date-next"],setup(C,e){const{slots:M,emit:S}=e,D=(0,_vue.inject)("$xeform",null),W=(0,_vue.inject)("$xeformiteminfo",null);var t=_xeUtils.default.uniqueId();const Y=(0,_size.useSize)(C),q=(0,_vue.reactive)({inited:!1,panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:"",isActivated:!1,inputValue:C.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),P=(0,_vue.ref)(),N=(0,_vue.ref)(),V=(0,_vue.ref)(),z=(0,_vue.ref)(),H={refElem:P,refInput:N},u={xID:t,props:C,context:e,reactData:q,getRefMaps:()=>H};let n={};const v=(e,t)=>{var a=C["type"];return"time"===a?(0,_date.toStringTimeDate)(e):_xeUtils.default.toStringDate(e,t)},d=(0,_vue.computed)(()=>{var e=C["type"];return"time"===e||"datetime"===e}),w=(0,_vue.computed)(()=>-1<["number","integer","float"].indexOf(C.type)),L=(0,_vue.computed)(()=>_xeUtils.default.getSize(q.inputValue)),j=(0,_vue.computed)(()=>{var e=L.value;return C.maxlength&&e>_xeUtils.default.toNumber(C.maxlength)}),k=(0,_vue.computed)(()=>{return d.value||-1<["date","week","month","quarter","year"].indexOf(C.type)}),T=(0,_vue.computed)(()=>"password"===C.type),B=(0,_vue.computed)(()=>"search"===C.type),i=(0,_vue.computed)(()=>_xeUtils.default.toInteger(C.digits)||1),G=(0,_vue.computed)(()=>{var e=C["type"],t=i.value,a=C.step;return"integer"===e?_xeUtils.default.toInteger(a)||1:"float"===e?_xeUtils.default.toNumber(a)||1/Math.pow(10,t):_xeUtils.default.toNumber(a)||1}),$=(0,_vue.computed)(()=>{var e=C["type"],t=w.value,a=k.value,l=T.value;return C.clearable&&(l||t||a||"text"===e||"search"===e)}),Q=(0,_vue.computed)(()=>C.startDate?_xeUtils.default.toStringDate(C.startDate):null),Z=(0,_vue.computed)(()=>C.endDate?_xeUtils.default.toStringDate(C.endDate):null),X=(0,_vue.computed)(()=>["date","week","month","quarter","year"].includes(C.type)),K=(0,_vue.computed)(()=>{var{modelValue:e,multiple:t}=C,a=k.value;const l=o.value;return t&&e&&a?_xeUtils.default.toValueString(e).split(",").map(e=>{e=v(e,l);return _xeUtils.default.isValidDate(e)?e:null}):[]}),J=(0,_vue.computed)(()=>{var e=K.value;const t=o.value;return e.map(e=>_xeUtils.default.toDateString(e,t))}),a=(0,_vue.computed)(()=>{var e=K.value;const t=p.value;return e.map(e=>_xeUtils.default.toDateString(e,t)).join(", ")}),o=(0,_vue.computed)(()=>{var e=C["type"];return"time"===e?"HH:mm:ss":C.valueFormat||("datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),A=(0,_vue.computed)(()=>{var e=C["modelValue"],t=k.value,a=o.value;let l=null;return l=e&&t&&(t=v(e,a),_xeUtils.default.isValidDate(t))?t:l}),ee=(0,_vue.computed)(()=>{var e=Q.value,t=q["selectMonth"];return!(!t||!e)&&t<=e}),te=(0,_vue.computed)(()=>{var e=Z.value,t=q["selectMonth"];return!(!t||!e)&&e<=t}),ae=(0,_vue.computed)(()=>{var e=q["datetimePanelValue"];return e?_xeUtils.default.toDateString(e,"HH:mm:ss"):""}),le=(0,_vue.computed)(()=>{var e=A.value,t=d.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),p=(0,_vue.computed)(()=>{return k.value?C.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat."+C.type):null}),s=(0,_vue.computed)(()=>{var{selectMonth:e,currentDate:t}=q,a=[];if(e&&t){var l=t.getFullYear(),t=e.getFullYear(),u=new Date(t-t%yearSize,0,1);for(let e=-4;e<yearSize+4;e++){var n=_xeUtils.default.getWhatYear(u,e,"first"),i=n.getFullYear();a.push({date:n,isCurrent:!0,isPrev:e<0,isNow:l===i,isNext:e>=yearSize,year:i})}}return a}),ue=(0,_vue.computed)(()=>{if(k.value){var{datePanelType:a,selectMonth:l}=q,u=s.value;let e="",t;return l&&(e=l.getFullYear(),t=l.getMonth()+1),"quarter"===a?_conf.default.i18n("vxe.input.date.quarterLabel",[e]):"month"===a?_conf.default.i18n("vxe.input.date.monthLabel",[e]):"year"===a?u.length?u[0].year+" - "+u[u.length-1].year:"":_conf.default.i18n("vxe.input.date.dayLabel",[e,t?_conf.default.i18n("vxe.input.date.m"+t):"-"])}return""}),y=(0,_vue.computed)(()=>{var{startDay:e,startWeek:t}=C;return _xeUtils.default.toNumber(_xeUtils.default.isNumber(e)||_xeUtils.default.isString(e)?e:t)}),ne=(0,_vue.computed)(()=>{var a=[];if(k.value){let t=y.value;a.push(t);for(let e=0;e<6;e++)6<=t?t=0:t++,a.push(t)}return a}),ie=(0,_vue.computed)(()=>{return k.value?ne.value.map(e=>({value:e,label:_conf.default.i18n("vxe.input.date.weeks.w"+e)})):[]}),se=(0,_vue.computed)(()=>{var e;return k.value?(e=ie.value,[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(e)):[]}),re=(0,_vue.computed)(()=>{var e=s.value;return _xeUtils.default.chunk(e,4)}),ve=(0,_vue.computed)(()=>{var{selectMonth:e,currentDate:t}=q,a=[];if(e&&t){var l=t.getFullYear(),u=(0,_date.getDateQuarter)(t),n=_xeUtils.default.getWhatYear(e,0,"first"),i=n.getFullYear();for(let e=-2;e<quarterSize-2;e++){var s=_xeUtils.default.getWhatQuarter(n,e),r=s.getFullYear(),v=(0,_date.getDateQuarter)(s),d=r<i;a.push({date:s,isPrev:d,isCurrent:r===i,isNow:r===l&&v===u,isNext:!d&&i<r,quarter:v})}}return a}),de=(0,_vue.computed)(()=>{var e=ve.value;return _xeUtils.default.chunk(e,2)}),oe=(0,_vue.computed)(()=>{var{selectMonth:t,currentDate:e}=q,a=[];if(t&&e){var l=e.getFullYear(),u=e.getMonth(),n=_xeUtils.default.getWhatYear(t,0,"first").getFullYear();for(let e=-4;e<monthSize-4;e++){var i=_xeUtils.default.getWhatYear(t,0,e),s=i.getFullYear(),r=i.getMonth(),v=s<n;a.push({date:i,isPrev:v,isCurrent:s===n,isNow:s===l&&r===u,isNext:!v&&n<s,month:r})}}return a}),pe=(0,_vue.computed)(()=>{var e=oe.value;return _xeUtils.default.chunk(e,4)}),ce=(0,_vue.computed)(()=>{var{selectMonth:t,currentDate:e}=q,a=[];if(t&&e){var l=le.value,u=ne.value,n=e.getFullYear(),i=e.getMonth(),s=e.getDate(),r=t.getFullYear(),v=t.getMonth(),e=t.getDay(),u=-u.indexOf(e),d=new Date(_xeUtils.default.getWhatDay(t,u).getTime()+l);for(let e=0;e<42;e++){var o=_xeUtils.default.getWhatDay(d,e),p=o.getFullYear(),c=o.getMonth(),_=o.getDate(),f=o<t;a.push({date:o,isPrev:f,isCurrent:p===r&&c===v,isNow:p===n&&c===i&&_===s,isNext:!f&&v!==c,label:_})}}return a}),_e=(0,_vue.computed)(()=>{var e=ce.value;return _xeUtils.default.chunk(e,7)}),fe=(0,_vue.computed)(()=>{var e=_e.value;const a=y.value;return e.map(e=>{var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date,a)}].concat(e)})}),me=(0,_vue.computed)(()=>{var t=[];if(d.value)for(let e=0;e<24;e++)t.push({value:e,label:(""+e).padStart(2,"0")});return t}),he=(0,_vue.computed)(()=>{var t=[];if(d.value)for(let e=0;e<60;e++)t.push({value:e,label:(""+e).padStart(2,"0")});return t}),xe=(0,_vue.computed)(()=>{return he.value}),ye=(0,_vue.computed)(()=>{var{type:e,readonly:t,editable:a,multiple:l}=C;return t||l||!a||"week"===e||"quarter"===e}),ge=(0,_vue.computed)(()=>{var e=C["type"],t=q["showPwd"],a=w.value,l=k.value,u=T.value;return l||a||u&&t||"number"===e?"text":e}),be=(0,_vue.computed)(()=>{var e=C["placeholder"];return e?(0,_utils.getFuncText)(e):""}),Ue=(0,_vue.computed)(()=>{var e=C["maxlength"];return w.value&&!_xeUtils.default.toNumber(e)?16:e}),Ee=(0,_vue.computed)(()=>{var{type:e,immediate:t}=C;return t||!("text"===e||"number"===e||"integer"===e||"float"===e)}),Se=(0,_vue.computed)(()=>{var e=C["type"],t=q["inputValue"];return w.value?"integer"===e?_xeUtils.default.toInteger((0,_number.handleNumber)(t)):_xeUtils.default.toNumber((0,_number.handleNumber)(t)):0}),De=(0,_vue.computed)(()=>{var e=C["min"],t=q["inputValue"],a=w.value,l=Se.value;return!(!t&&0!==t||!a||null===e)&&l<=_xeUtils.default.toNumber(e)}),Pe=(0,_vue.computed)(()=>{var e=C["max"],t=q["inputValue"],a=w.value,l=Se.value;return!(!t&&0!==t||!a||null===e)&&l>=_xeUtils.default.toNumber(e)}),Ne=e=>{var{type:t,exponential:a}=C,l=Ue.value,u=i.value,t="float"===t?(0,_number.toFloatValueFixed)(e,u):_xeUtils.default.toValueString(e);return!a||e!==t&&_xeUtils.default.toValueString(e).toLowerCase()!==_xeUtils.default.toNumber(t).toExponential()?t.slice(0,l):e},r=e=>{var t=q["inputValue"];n.dispatchEvent(e.type,{value:t},e)},c=(e,t)=>{q.inputValue=e,S("update:modelValue",e),n.dispatchEvent("input",{value:e},t),_xeUtils.default.toValueString(C.modelValue)!==e&&(n.dispatchEvent("change",{value:e},t),D)&&W&&D.triggerItemEvent(t,W.itemConfig.field,e)},Ve=(e,t)=>{var a=k.value,l=Ee.value;q.inputValue=e,a||(l?c(e,t):n.dispatchEvent("input",{value:e},t))},we=e=>{var t=e.target.value;Ve(t,e)},ke=e=>{Ee.value||r(e)},Te=e=>{q.isActivated=!0,k.value&&E(e),r(e)},Me=e=>{var t=C["disabled"];t||(t=q["inputValue"],n.dispatchEvent("prefix-click",{value:t},e))};let We;const g=()=>new Promise(e=>{q.visiblePanel=!1,We=window.setTimeout(()=>{q.animatVisible=!1,e()},350)}),Ye=(e,t)=>{var a=C["type"],l=w.value;k.value&&g(),(l||-1<["text","search","password"].indexOf(a))&&focus(),n.dispatchEvent("clear",{value:t},e)},Ce=e=>{var t=C["disabled"];t||((0,_dom.hasClass)(e.currentTarget,"is--clear")?(c("",e),Ye(e,"")):(t=q["inputValue"],n.dispatchEvent("suffix-click",{value:t},e)))},l=e=>{var t=C["type"],a=C["valueFormat"],l=p.value,u=y.value;let n=null,i="";e&&(n=v(e,a)),_xeUtils.default.isValidDate(n)?(i=_xeUtils.default.toDateString(n,l,{firstDay:u}),l&&"week"===t&&_xeUtils.default.getWhatWeek(n,0,u,u).getFullYear()<n.getFullYear()&&-1<(e=l.indexOf("yyyy"))&&(a=Number(i.substring(e,e+4)))&&!isNaN(a)&&(i=i.replace(""+a,""+(a-1)))):n=null,q.datePanelValue=n,q.datePanelLabel=i},qe=()=>{var e=k.value,t=q["inputValue"];e&&(l(t),q.inputValue=C.multiple?a.value:q.datePanelLabel)},Ke=()=>{var e=C["type"],t=q["inputValue"],a=k.value,l=i.value;a?qe():"float"===e&&t&&t!==(a=(0,_number.toFloatValueFixed)(t,l))&&c(a,{type:"init"})},Ae=e=>null===C.max||_xeUtils.default.toNumber(e)<=_xeUtils.default.toNumber(C.max),Fe=e=>null===C.min||_xeUtils.default.toNumber(e)>=_xeUtils.default.toNumber(C.min),Ie=()=>{q.inputValue=C.multiple?a.value:q.datePanelLabel},_=e=>{e=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(e,q.selectMonth)||(q.selectMonth=e)},f=t=>{var{modelValue:e,multiple:a}=C;const l=q["datetimePanelValue"];var u=d.value;const n=o.value;var i=y.value;"week"===C.type?(r=_xeUtils.default.toNumber(C.selectDay),t=_xeUtils.default.getWhatWeek(t,0,r,i)):u&&(t.setHours(l.getHours()),t.setMinutes(l.getMinutes()),t.setSeconds(l.getSeconds()));const s=_xeUtils.default.toDateString(t,n,{firstDay:i});if(_(t),a){var r=J.value;if(u){i=[...K.value];const v=[];a=_xeUtils.default.findIndexOf(i,e=>_xeUtils.default.isDateSame(t,e,"yyyyMMdd"));-1===a?i.push(t):i.splice(a,1),i.forEach(e=>{e&&(e.setHours(l.getHours()),e.setMinutes(l.getMinutes()),e.setSeconds(l.getSeconds()),v.push(e))}),c(v.map(e=>_xeUtils.default.toDateString(e,n)).join(","),{type:"update"})}else r.some(e=>_xeUtils.default.isEqual(e,s))?c(r.filter(e=>!_xeUtils.default.isEqual(e,s)).join(","),{type:"update"}):c(r.concat([s]).join(","),{type:"update"})}else _xeUtils.default.isEqual(e,s)||c(s,{type:"update"})},b=()=>{var{type:a,min:l,max:u,exponential:t}=C,{inputValue:n,datetimePanelValue:i}=q,s=w.value,e=k.value,r=p.value;if(!ye.value)if(s){if(n){let e="integer"===a?_xeUtils.default.toInteger((0,_number.handleNumber)(n)):_xeUtils.default.toNumber((0,_number.handleNumber)(n));Fe(e)?Ae(e)||(e=u):e=l,t&&(s=_xeUtils.default.toValueString(n).toLowerCase())===_xeUtils.default.toNumber(e).toExponential()&&(e=s),c(Ne(e),{type:"check"})}}else if(e)if(n){let t=v(n,r);if(_xeUtils.default.isValidDate(t))if("time"===a)n!==(t=_xeUtils.default.toDateString(t,r))&&c(t,{type:"check"}),q.inputValue=t;else{let e=!1;u=y.value;"datetime"===a?(l=A.value,n===_xeUtils.default.toDateString(l,r)&&n===_xeUtils.default.toDateString(t,r)||(e=!0,i.setHours(t.getHours()),i.setMinutes(t.getMinutes()),i.setSeconds(t.getSeconds()))):e=!0,q.inputValue=_xeUtils.default.toDateString(t,r,{firstDay:u}),e&&f(t)}else Ie()}else c("",{type:"check"})},Re=e=>{var t=q["inputValue"];Ee.value||c(t,e),b(),q.visiblePanel||(q.isActivated=!1),n.dispatchEvent("blur",{value:t},e)},Oe=e=>{var{readonly:t,disabled:a}=C,l=q["showPwd"];a||t||(q.showPwd=!l),n.dispatchEvent("toggle-visible",{visible:q.showPwd},e)},ze=e=>{n.dispatchEvent("search-click",{},e)},He=(e,t)=>{var{min:a,max:l,type:u}=C,n=q["inputValue"],i=G.value,u="integer"===u?_xeUtils.default.toInteger((0,_number.handleNumber)(n)):_xeUtils.default.toNumber((0,_number.handleNumber)(n)),n=e?_xeUtils.default.add(u,i):_xeUtils.default.subtract(u,i);let s;s=Fe(n)?Ae(n)?n:l:a,Ve(Ne(s),t)};let m;const h=e=>{var{readonly:t,disabled:a}=C,l=De.value;clearTimeout(m),a||t||l||He(!1,e),n.dispatchEvent("next-number",{},e)},Le=e=>{m=window.setTimeout(()=>{h(e),Le(e)},60)},x=e=>{var{readonly:t,disabled:a}=C,l=Pe.value;clearTimeout(m),a||t||l||He(!0,e),n.dispatchEvent("prev-number",{},e)},je=e=>{var t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN);(t||a)&&(e.preventDefault(),(t?x:h)(e))},Be=e=>{var t,a,l,u,{exponential:n,controls:i}=C;w.value&&(t=e.ctrlKey,a=e.shiftKey,l=e.altKey,u=e.keyCode,t||a||l||!((0,_event.hasEventKey)(e,_event.EVENT_KEYS.SPACEBAR)||(!n||69!==u)&&65<=u&&u<=90||186<=u&&u<=188||191<=u)||e.preventDefault(),i)&&je(e),r(e)},Ge=e=>{r(e)},U=()=>{clearTimeout(m)},$e=e=>{m=window.setTimeout(()=>{x(e),$e(e)},60)},Qe=e=>{if(U(),0===e.button){const t=(0,_dom.hasClass)(e.currentTarget,"is--prev");(t?x:h)(e),m=window.setTimeout(()=>{(t?$e:Le)(e)},500)}},Ze=e=>{var t;w.value&&C.controls&&q.isActivated&&(0<(t=e.deltaY)?h(e):t<0&&x(e),e.preventDefault()),r(e)},Xe=(e,t)=>{q.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},Je=()=>{var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");q.currentDate=e,Xe(e,0)},et=()=>{let e=q["datePanelType"];e="month"===e||"quarter"===e?"year":"month",q.datePanelType=e},tt=e=>{var t=C["type"],{datePanelType:a,selectMonth:l}=q;ee.value||(q.selectMonth="year"===t?_xeUtils.default.getWhatYear(l,-yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(l,-yearSize,"first"):_xeUtils.default.getWhatYear(l,-1,"first"):"year"===a?_xeUtils.default.getWhatYear(l,-yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(l,-1,"first"):_xeUtils.default.getWhatMonth(l,-1,"first"),n.dispatchEvent("date-prev",{type:t},e))},at=e=>{Je(),C.multiple||(f(q.currentDate),g()),n.dispatchEvent("date-today",{type:C.type},e)},lt=e=>{var t=C["type"],{datePanelType:a,selectMonth:l}=q;te.value||(q.selectMonth="year"===t?_xeUtils.default.getWhatYear(l,yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(l,yearSize,"first"):_xeUtils.default.getWhatYear(l,1,"first"):"year"===a?_xeUtils.default.getWhatYear(l,yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(l,1,"first"):_xeUtils.default.getWhatMonth(l,1,"first"),n.dispatchEvent("date-next",{type:t},e))},F=e=>{var t=C["disabledMethod"],a=q["datePanelType"];return t&&t({type:a,viewType:a,date:e.date,$input:u})},ut=e=>{var{type:t,multiple:a}=C,l=q["datePanelType"];"month"===t?"year"===l?(q.datePanelType="month",_(e)):(f(e),a||g()):"year"===t?(f(e),a||g()):"quarter"===t?"year"===l?(q.datePanelType="quarter",_(e)):(f(e),a||g()):"month"===l?(q.datePanelType="week"===t?t:"day",_(e)):"year"===l?(q.datePanelType="month",_(e)):(f(e),"datetime"===t||a||g())},I=e=>{F(e)||ut(e.date)},nt=t=>{F({date:t})||(ce.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyyMMdd"))||_(t),l(t))},it=t=>{F({date:t})||(s.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyy"))||_(t),l(t))},st=t=>{F({date:t})||(ve.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyyq"))||_(t),l(t))},rt=t=>{F({date:t})||(oe.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyyMM"))||_(t),l(t))},R=e=>{var t;F(e)||(t=q["datePanelType"],("month"===t?rt:"quarter"===t?st:"year"===t?it:nt)(e.date))},vt=e=>{var t;e&&(t=e.offsetHeight,e.parentNode.scrollTop=e.offsetTop-4*t)},dt=e=>{q.datetimePanelValue=new Date(q.datetimePanelValue.getTime()),vt(e.currentTarget)},ot=()=>{var e=C["multiple"];const t=q["datetimePanelValue"];var a=A.value,l=d.value;if(l){const u=o.value;if(e){e=J.value;if(l){l=[...K.value];const n=[];l.forEach(e=>{e&&(e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),n.push(e))}),c(n.map(e=>_xeUtils.default.toDateString(e,u)).join(","),{type:"update"})}else c(e.join(","),{type:"update"})}else f(a||q.currentDate)}g()},pt=()=>(0,_vue.nextTick)().then(()=>{var{transfer:e,placement:l}=C,u=q["panelIndex"],t=N.value,n=V.value;if(t&&n){var i=t.offsetHeight,s=t.offsetWidth,r=n.offsetHeight,n=n.offsetWidth,u={zIndex:u},{boundingTop:v,boundingLeft:d,visibleHeight:o,visibleWidth:p}=(0,_dom.getAbsolutePos)(t);let a="bottom";if(console.log((0,_dom.getAbsolutePos)(t)),e){let e=d,t=v+i;"top"===l?(a="top",t=v-r):l||(t+r+5>o&&(a="top",t=v-r),t<5&&(a="bottom",t=v+i)),e+n+5>p&&(e-=e+n+5-p),e<5&&(e=5),Object.assign(u,{left:e+"px",top:t+"px",minWidth:s+"px"})}else"top"===l?(a="top",u.bottom=i+"px"):l||o<v+i+r&&5<v-i-r&&(a="top",u.bottom=i+"px");return q.panelStyle=u,q.panelPlacement=a,(0,_vue.nextTick)()}}),ct=()=>{var e=C["disabled"],t=q["visiblePanel"],a=k.value;return(e||t?(0,_vue.nextTick):(q.inited||(q.inited=!0),clearTimeout(We),q.isActivated=!0,q.animatVisible=!0,a&&(e=C.type,t=d.value,a=A.value,-1<["year","quarter","month","week"].indexOf(e)?q.datePanelType=e:q.datePanelType="day",q.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(Xe(a,0),l(a)):Je(),t)&&(q.datetimePanelValue=q.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(()=>{var e=z.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),vt)})),setTimeout(()=>{q.visiblePanel=!0},10),q.panelIndex<(0,_utils.getLastZIndex)()&&(q.panelIndex=(0,_utils.nextZIndex)()),pt))()},E=e=>{var t=C["readonly"];t||(e.preventDefault(),ct())},_t=e=>{r(e)},ft=e=>{var t=C["disabled"],{visiblePanel:a,isActivated:l}=q,u=k.value,n=P.value,i=V.value;!t&&l&&(q.isActivated=(0,_dom.getEventTargetNode)(e,n).flag||(0,_dom.getEventTargetNode)(e,i).flag,q.isActivated||(u?a&&(g(),b()):b()))},mt=t=>{var{clearable:a,disabled:l}=C,u=q["visiblePanel"],n=k.value;if(!l){var l=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.TAB),i=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.DELETE),s=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ESCAPE),r=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ENTER),v=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ARROW_LEFT),d=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ARROW_UP),o=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ARROW_RIGHT),p=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ARROW_DOWN),c=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.PAGE_UP),_=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.PAGE_DOWN),v=v||d||o||p;let e=q.isActivated;if(l)e&&b(),e=!1,q.isActivated=e;else if(v){if(n&&e)if(u){var o=t,{isActivated:v,datePanelValue:f,datePanelType:m}=q;if(v){o.preventDefault();var v=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_LEFT),h=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_UP),x=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_RIGHT),o=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_DOWN);if("year"===m){let e=_xeUtils.default.getWhatYear(f||Date.now(),0,"first");v?e=_xeUtils.default.getWhatYear(e,-1):h?e=_xeUtils.default.getWhatYear(e,-4):x?e=_xeUtils.default.getWhatYear(e,1):o&&(e=_xeUtils.default.getWhatYear(e,4)),it(e)}else if("quarter"===m){let e=_xeUtils.default.getWhatQuarter(f||Date.now(),0,"first");v?e=_xeUtils.default.getWhatQuarter(e,-1):h?e=_xeUtils.default.getWhatQuarter(e,-2):x?e=_xeUtils.default.getWhatQuarter(e,1):o&&(e=_xeUtils.default.getWhatQuarter(e,2)),st(e)}else if("month"===m){let e=_xeUtils.default.getWhatMonth(f||Date.now(),0,"first");v?e=_xeUtils.default.getWhatMonth(e,-1):h?e=_xeUtils.default.getWhatMonth(e,-4):x?e=_xeUtils.default.getWhatMonth(e,1):o&&(e=_xeUtils.default.getWhatMonth(e,4)),rt(e)}else{let e=f||_xeUtils.default.getWhatDay(Date.now(),0,"first");m=y.value;v?e=_xeUtils.default.getWhatDay(e,-1):h?e=_xeUtils.default.getWhatWeek(e,-1,m):x?e=_xeUtils.default.getWhatDay(e,1):o&&(e=_xeUtils.default.getWhatWeek(e,1,m)),nt(e)}}}else(d||p)&&E(t)}else r?n&&(u?q.datePanelValue?ut(q.datePanelValue):g():e&&E(t)):(c||_)&&n&&e&&(f=t,v=q.isActivated)&&(v=(0,_event.hasEventKey)(f,_event.EVENT_KEYS.PAGE_UP),f.preventDefault(),(v?tt:lt)(f));l||s?u&&g():i&&a&&e&&Ye(t,null)}},ht=e=>{var t=C["disabled"],a=q["visiblePanel"];t||a&&(t=V.value,((0,_dom.getEventTargetNode)(e,t).flag?pt:(g(),b))())},xt=()=>{var{isActivated:e,visiblePanel:t}=q;t?(g(),b()):e&&b()},O=(e,t)=>{var a,l=C["festivalMethod"];return l?(a=q["datePanelType"],e=(a=(l=l({type:a,viewType:a,date:e.date,$input:u}))?_xeUtils.default.isString(l)?{label:l}:l:{}).extra?_xeUtils.default.isString(a.extra)?{label:a.extra}:a.extra:null,l=[(0,_vue.h)("span",{class:["vxe-input--date-label",{"is-notice":a.notice}]},e&&e.label?[(0,_vue.h)("span",t),(0,_vue.h)("span",{class:["vxe-input--date-label--extra",e.important?"is-important":"",e.className],style:e.style},_xeUtils.default.toValueString(e.label))]:t)],(e=a.label)&&(e=_xeUtils.default.toValueString(e).split(","),l.push((0,_vue.h)("span",{class:["vxe-input--date-festival",a.important?"is-important":"",a.className],style:a.style},[1<e.length?(0,_vue.h)("span",{class:["vxe-input--date-festival--overlap","overlap--"+e.length]},e.map(e=>(0,_vue.h)("span",e.substring(0,3)))):(0,_vue.h)("span",{class:"vxe-input--date-festival--label"},e[0].substring(0,3))]))),l):t},yt=()=>{var e=q["datePanelType"];switch(e){case"week":{const n=C["multiple"],{datePanelType:i,datePanelValue:s}=q,r=A.value;var t=se.value,a=fe.value;const v=K.value,d="yyyyMMdd";return[(0,_vue.h)("table",{class:`vxe-input--date-${i}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",t.map(e=>(0,_vue.h)("th",e.label)))]),(0,_vue.h)("tbody",a.map(e=>{const t=n?e.some(t=>v.some(e=>_xeUtils.default.isDateSame(e,t.date,d))):e.some(e=>_xeUtils.default.isDateSame(r,e.date,d)),a=e.some(e=>_xeUtils.default.isDateSame(s,e.date,d));return(0,_vue.h)("tr",e.map(e=>(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":F(e),"is--selected":t,"is--hover":a},onClick:()=>I(e),onMouseenter:()=>R(e)},O(e,e.label))))}))])];return}case"month":{const o=C["multiple"],{datePanelType:p,datePanelValue:c}=q,_=A.value;t=pe.value;const f=K.value,m="yyyyMM";return[(0,_vue.h)("table",{class:`vxe-input--date-${p}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",t.map(e=>(0,_vue.h)("tr",e.map(t=>(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":F(t),"is--selected":o?f.some(e=>_xeUtils.default.isDateSame(e,t.date,m)):_xeUtils.default.isDateSame(_,t.date,m),"is--hover":_xeUtils.default.isDateSame(c,t.date,m)},onClick:()=>I(t),onMouseenter:()=>R(t)},O(t,_conf.default.i18n("vxe.input.date.months.m"+t.month)))))))])];return}case"quarter":{const h=C["multiple"],{datePanelType:x,datePanelValue:y}=q,g=A.value;a=de.value;const b=K.value,U="yyyyq";return[(0,_vue.h)("table",{class:`vxe-input--date-${x}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",a.map(e=>(0,_vue.h)("tr",e.map(t=>(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":F(t),"is--selected":h?b.some(e=>_xeUtils.default.isDateSame(e,t.date,U)):_xeUtils.default.isDateSame(g,t.date,U),"is--hover":_xeUtils.default.isDateSame(y,t.date,U)},onClick:()=>I(t),onMouseenter:()=>R(t)},O(t,_conf.default.i18n("vxe.input.date.quarters.q"+t.quarter)))))))])];return}case"year":{const E=C["multiple"],{datePanelType:S,datePanelValue:D}=q,P=A.value;var l=re.value;const N=K.value,V="yyyy";return[(0,_vue.h)("table",{class:`vxe-input--date-${S}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",l.map(e=>(0,_vue.h)("tr",e.map(t=>(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":F(t),"is--selected":E?N.some(e=>_xeUtils.default.isDateSame(e,t.date,V)):_xeUtils.default.isDateSame(P,t.date,V),"is--hover":_xeUtils.default.isDateSame(D,t.date,V)},onClick:()=>I(t),onMouseenter:()=>R(t)},O(t,t.year))))))])];return}}{const w=C["multiple"],{datePanelType:k,datePanelValue:T}=q,M=A.value;var e=ie.value,u=_e.value;const W=K.value,Y="yyyyMMdd";return[(0,_vue.h)("table",{class:`vxe-input--date-${k}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",e.map(e=>(0,_vue.h)("th",e.label)))]),(0,_vue.h)("tbody",u.map(e=>(0,_vue.h)("tr",e.map(t=>(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":F(t),"is--selected":w?W.some(e=>_xeUtils.default.isDateSame(e,t.date,Y)):_xeUtils.default.isDateSame(M,t.date,Y),"is--hover":_xeUtils.default.isDateSame(T,t.date,Y)},onClick:()=>I(t),onMouseenter:()=>R(t)},O(t,t.label))))))])]}},gt=()=>{var e=C["multiple"],t=q["datePanelType"],a=ee.value,l=te.value,u=ue.value;return[(0,_vue.h)("div",{class:"vxe-input--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-input--date-picker-type-wrapper"},["year"===t?(0,_vue.h)("span",{class:"vxe-input--date-picker-label"},u):(0,_vue.h)("span",{class:"vxe-input--date-picker-btn",onClick:et},u)]),(0,_vue.h)("div",{class:"vxe-input--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",{"is--disabled":a}],onClick:tt},[(0,_vue.h)("i",{class:"vxe-icon-caret-left"})]),(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",onClick:at},[(0,_vue.h)("i",{class:"vxe-icon-dot"})]),(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-next-btn",{"is--disabled":l}],onClick:lt},[(0,_vue.h)("i",{class:"vxe-icon-caret-right"})]),e&&X.value?(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-confirm-btn"},[(0,_vue.h)("button",{class:"vxe-input--date-picker-confirm",type:"button",onClick:ot},_conf.default.i18n("vxe.button.confirm"))]):null])]),(0,_vue.h)("div",{class:"vxe-input--date-picker-body"},yt())]},bt=()=>{const t=q["datetimePanelValue"];var e=ae.value,a=me.value,l=he.value,u=xe.value;return[(0,_vue.h)("div",{class:"vxe-input--time-picker-header"},[(0,_vue.h)("span",{class:"vxe-input--time-picker-title"},e),(0,_vue.h)("button",{class:"vxe-input--time-picker-confirm",type:"button",onClick:ot},_conf.default.i18n("vxe.button.confirm"))]),(0,_vue.h)("div",{ref:z,class:"vxe-input--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-input--time-picker-hour-list"},a.map((a,e)=>(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getHours()===a.value},onClick:e=>{return e=e,t=a,q.datetimePanelValue.setHours(t.value),void dt(e);var t}},a.label))),(0,_vue.h)("ul",{class:"vxe-input--time-picker-minute-list"},l.map((a,e)=>(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getMinutes()===a.value},onClick:e=>{return e=e,t=a,q.datetimePanelValue.setMinutes(t.value),void dt(e);var t}},a.label))),(0,_vue.h)("ul",{class:"vxe-input--time-picker-second-list"},u.map((a,e)=>(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getSeconds()===a.value},onClick:e=>{return e=e,t=a,q.datetimePanelValue.setSeconds(t.value),void dt(e);var t}},a.label)))])]},Ut=()=>{var e=Pe.value,t=De.value;return(0,_vue.h)("span",{class:"vxe-input--number-suffix"},[(0,_vue.h)("span",{class:["vxe-input--number-prev is--prev",{"is--disabled":e}],onMousedown:Qe,onMouseup:U,onMouseleave:U},[(0,_vue.h)("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.INPUT_PREV_NUM]})]),(0,_vue.h)("span",{class:["vxe-input--number-next is--next",{"is--disabled":t}],onMousedown:Qe,onMouseup:U,onMouseleave:U},[(0,_vue.h)("i",{class:["vxe-input--number-next-icon",_conf.default.icon.INPUT_NEXT_NUM]})])])},Et=()=>(0,_vue.h)("span",{class:"vxe-input--date-picker-suffix",onClick:E},[(0,_vue.h)("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.INPUT_DATE]})]),St=()=>(0,_vue.h)("span",{class:"vxe-input--search-suffix",onClick:ze},[(0,_vue.h)("i",{class:["vxe-input--search-icon",_conf.default.icon.INPUT_SEARCH]})]),Dt=()=>{var e=q["showPwd"];return(0,_vue.h)("span",{class:"vxe-input--password-suffix",onClick:Oe},[(0,_vue.h)("i",{class:["vxe-input--password-icon",e?_conf.default.icon.INPUT_SHOW_PWD:_conf.default.icon.INPUT_PWD]})])};n={dispatchEvent(e,t,a){S(e,Object.assign({$input:u,$event:a},t))},focus(){var e=N.value;return q.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur(){return N.value.blur(),(q.isActivated=!1,_vue.nextTick)()},select(){return N.value.select(),(q.isActivated=!1,_vue.nextTick)()},showPanel:ct,hidePanel:g,updatePlacement:pt},Object.assign(u,n),(0,_vue.watch)(()=>C.modelValue,e=>{q.inputValue=e,qe()}),(0,_vue.watch)(()=>C.type,()=>{Object.assign(q,{inputValue:C.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),Ke()}),(0,_vue.watch)(p,()=>{k.value&&(l(q.datePanelValue),q.inputValue=C.multiple?a.value:q.datePanelLabel)}),(0,_vue.nextTick)(()=>{_event.GlobalEvent.on(u,"mousewheel",ht),_event.GlobalEvent.on(u,"mousedown",ft),_event.GlobalEvent.on(u,"keydown",mt),_event.GlobalEvent.on(u,"blur",xt)}),(0,_vue.onUnmounted)(()=>{U(),_event.GlobalEvent.off(u,"mousewheel"),_event.GlobalEvent.off(u,"mousedown"),_event.GlobalEvent.off(u,"keydown"),_event.GlobalEvent.off(u,"blur")}),Ke();return u.renderVN=()=>{var e,{className:t,controls:a,type:l,align:u,showWordCount:n,countMethod:i,name:s,disabled:r,readonly:v,autocomplete:d}=C,{inputValue:o,visiblePanel:p,isActivated:c}=q,_=Y.value,f=j.value,m=L.value,h=k.value,x=ye.value,y=Ue.value,g=ge.value,b=be.value,U=[],E=(S=C.prefixIcon,E=M.prefix,e=[],E?e.push((0,_vue.h)("span",{class:"vxe-input--prefix-icon"},E({}))):S&&e.push((0,_vue.h)("i",{class:["vxe-input--prefix-icon",S]})),e.length?(0,_vue.h)("span",{class:"vxe-input--prefix",onClick:Me},e):null),S=(()=>{var{disabled:e,suffixIcon:t}=C,a=q["inputValue"],l=M.suffix,u=$.value,n=[];return l?n.push((0,_vue.h)("span",{class:"vxe-input--suffix-icon"},l({}))):t&&n.push((0,_vue.h)("i",{class:["vxe-input--suffix-icon",t]})),u&&n.push((0,_vue.h)("i",{class:["vxe-input--clear-icon",_conf.default.icon.INPUT_CLEAR]})),n.length?(0,_vue.h)("span",{class:["vxe-input--suffix",{"is--clear":u&&!e&&!(""===a||_xeUtils.default.eqNull(a))}],onClick:Ce},n):null})();E&&U.push(E),U.push((0,_vue.h)("input",{ref:N,class:"vxe-input--inner",value:o,name:s,type:g,placeholder:b,maxlength:y,readonly:x,disabled:r,autocomplete:d,onKeydown:Be,onKeyup:Ge,onWheel:Ze,onClick:_t,onInput:we,onChange:ke,onFocus:Te,onBlur:Re})),S&&U.push(S),U.push((()=>{var e=C["controls"],t=w.value,a=k.value,l=T.value,u=B.value;let n;return l?n=Dt():t?e&&(n=Ut()):a?n=Et():u&&(n=St()),n?(0,_vue.h)("span",{class:"vxe-input--extra-suffix"},[n]):null})()),h&&U.push((()=>{var{type:e,transfer:t}=C,{inited:a,animatVisible:l,visiblePanel:u,panelPlacement:n,panelStyle:i}=q,s=Y.value,r=[];return k.value?(r.push("datetime"===e?(0,_vue.h)("div",{class:"vxe-input--panel-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-input--panel-left-wrapper"},gt()),(0,_vue.h)("div",{class:"vxe-input--panel-right-wrapper"},bt())]):"time"===e?(0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},bt()):(0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},gt())),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!t||!a},[(0,_vue.h)("div",{ref:V,class:["vxe-table--ignore-clear vxe-input--panel","type--"+e,{["size--"+s]:s,"is--transfer":t,"animat--leave":l,"animat--enter":u}],placement:n,style:i},r)])):null})());let D=!1;return n&&["text","search"].includes(l)&&(D=!0,U.push((0,_vue.h)("span",{class:["vxe-input--count",{"is--error":f}]},i?""+i({value:o}):m+(y?"/"+y:"")))),(0,_vue.h)("div",{ref:P,class:["vxe-input","type--"+l,t,{["size--"+_]:_,["is--"+u]:u,"is--controls":a,"is--prefix":!!E,"is--suffix":!!S,"is--readonly":v,"is--visivle":p,"is--count":D,"is--disabled":r,"is--active":c}]},U)},u},render(){return this.renderVN()}});