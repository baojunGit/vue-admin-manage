"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_select=_interopRequireDefault(require("../../select")),_event=require("../../tools/event"),_size=require("../../hooks/size"),_log=require("../../tools/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxePager",props:{size:{type:String,default:()=>_conf.default.pager.size||_conf.default.size},layouts:{type:Array,default:()=>_conf.default.pager.layouts||["PrevJump","PrevPage","Jump","PageCount","NextPage","NextJump","Sizes","Total"]},currentPage:{type:Number,default:1},loading:Boolean,pageSize:{type:Number,default:()=>_conf.default.pager.pageSize||10},total:{type:Number,default:0},pagerCount:{type:Number,default:()=>_conf.default.pager.pagerCount||7},pageSizes:{type:Array,default:()=>_conf.default.pager.pageSizes||[10,15,20,50,100]},align:{type:String,default:()=>_conf.default.pager.align},border:{type:Boolean,default:()=>_conf.default.pager.border},background:{type:Boolean,default:()=>_conf.default.pager.background},perfect:{type:Boolean,default:()=>_conf.default.pager.perfect},autoHidden:{type:Boolean,default:()=>_conf.default.pager.autoHidden},transfer:{type:Boolean,default:()=>_conf.default.pager.transfer},className:[String,Function],iconPrevPage:String,iconJumpPrev:String,iconJumpNext:String,iconNextPage:String,iconJumpMore:String,iconHomePage:String,iconEndPage:String},emits:["update:pageSize","update:currentPage","page-change"],setup(s,e){const{slots:l,emit:r}=e;var a=_xeUtils.default.uniqueId();const o=(0,_size.useSize)(s),i=(0,_vue.inject)("$xegrid",null),n=(0,_vue.reactive)({inpCurrPage:s.currentPage}),p=(0,_vue.ref)(),t={refElem:p},c={xID:a,props:s,context:e,getRefMaps:()=>t};let u={};const g=(e,a)=>Math.max(Math.ceil(e/a),1),v=(0,_vue.computed)(()=>g(s.total,s.pageSize)),d=(e,a)=>{r("update:currentPage",a),e&&a!==s.currentPage&&u.dispatchEvent("page-change",{type:"current",pageSize:s.pageSize,currentPage:a},e)},_=(e,a)=>{r("update:currentPage",e),a&&e!==s.currentPage&&u.dispatchEvent("page-change",{type:"current",pageSize:s.pageSize,currentPage:e},a)},f=e=>{var a=e.target,t=_xeUtils.default.toInteger(a.value),r=v.value,r=t<=0?1:r<=t?r:t,t=_xeUtils.default.toValueString(r);a.value=t,n.inpCurrPage=t,_(r,e)},x=(0,_vue.computed)(()=>{var e=s["pagerCount"],a=e<v.value?e-2:e,t=[];for(let e=0;e<a;e++)t.push(e);return t}),P=(0,_vue.computed)(()=>Math.floor((s.pagerCount-2)/2)),h=(0,_vue.computed)(()=>s.pageSizes.map(e=>_xeUtils.default.isNumber(e)?{value:e,label:""+_conf.default.i18n("vxe.pager.pagesize",[e])}:Object.assign({value:"",label:""},e))),b=e=>{var a=s["currentPage"];1<a&&_(1,e)},m=e=>{var a=s["currentPage"],t=v.value;a<t&&_(t,e)},E=e=>{var a=s["currentPage"],t=v.value;1<a&&_(Math.min(t,Math.max(a-1,1)),e)},y=e=>{var a=s["currentPage"],t=v.value;a<t&&_(Math.min(t,a+1),e)},k=e=>{var a=x.value;_(Math.max(s.currentPage-a.length,1),e)},N=e=>{var a=v.value,t=x.value;_(Math.min(s.currentPage+t.length,a),e)},S=e=>{var e=e["value"],e=_xeUtils.default.toNumber(e),a=g(s.total,e);let t=s.currentPage;t>a&&(t=a,r("update:currentPage",a)),r("update:pageSize",e),u.dispatchEvent("page-change",{type:"size",pageSize:e,currentPage:t})},z=e=>{e=e.target;n.inpCurrPage=e.value},J=e=>{(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ENTER)?f(e):(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP)?(e.preventDefault(),y(e)):(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN)&&(e.preventDefault(),E(e))},C=()=>(0,_vue.h)("button",{class:["vxe-pager--prev-btn",{"is--disabled":s.currentPage<=1}],type:"button",title:_conf.default.i18n("vxe.pager.homePageTitle"),onClick:b},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconHomePage||_conf.default.icon.PAGER_HOME]})]),M=()=>(0,_vue.h)("button",{class:["vxe-pager--prev-btn",{"is--disabled":s.currentPage<=1}],type:"button",title:_conf.default.i18n("vxe.pager.prevPageTitle"),onClick:E},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconPrevPage||_conf.default.icon.PAGER_PREV_PAGE]})]),R=e=>(0,_vue.h)(e||"button",{class:["vxe-pager--jump-prev",{"is--fixed":!e,"is--disabled":s.currentPage<=1}],type:"button",title:_conf.default.i18n("vxe.pager.prevJumpTitle"),onClick:k},[e?(0,_vue.h)("i",{class:["vxe-pager--jump-more-icon",s.iconJumpMore||_conf.default.icon.PAGER_JUMP_MORE]}):null,(0,_vue.h)("i",{class:["vxe-pager--jump-icon",s.iconJumpPrev||_conf.default.icon.PAGER_JUMP_PREV]})]),T=e=>{var a=v.value;return(0,_vue.h)(e||"button",{class:["vxe-pager--jump-next",{"is--fixed":!e,"is--disabled":s.currentPage>=a}],type:"button",title:_conf.default.i18n("vxe.pager.nextJumpTitle"),onClick:N},[e?(0,_vue.h)("i",{class:["vxe-pager--jump-more-icon",s.iconJumpMore||_conf.default.icon.PAGER_JUMP_MORE]}):null,(0,_vue.h)("i",{class:["vxe-pager--jump-icon",s.iconJumpNext||_conf.default.icon.PAGER_JUMP_NEXT]})])},A=()=>{var e=v.value;return(0,_vue.h)("button",{class:["vxe-pager--next-btn",{"is--disabled":s.currentPage>=e}],type:"button",title:_conf.default.i18n("vxe.pager.nextPageTitle"),onClick:y},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconNextPage||_conf.default.icon.PAGER_NEXT_PAGE]})])},U=()=>{var e=v.value;return(0,_vue.h)("button",{class:["vxe-pager--prev-btn",{"is--disabled":s.currentPage>=e}],type:"button",title:_conf.default.i18n("vxe.pager.endPageTitle"),onClick:m},[(0,_vue.h)("i",{class:["vxe-pager--btn-icon",s.iconEndPage||_conf.default.icon.PAGER_END]})])},j=e=>{const{currentPage:r,pagerCount:a}=s,n=[],u=v.value;var t=x.value,l=P.value,o=u>a,i=o&&r>l+1,p=o&&r<u-l;let c=1;return o&&(c=r>=u-l?Math.max(u-t.length+1,1):Math.max(r-l,1)),e&&i&&n.push((0,_vue.h)("button",{class:"vxe-pager--num-btn",type:"button",onClick:e=>d(e,1)},1),R("span")),t.forEach((e,a)=>{const t=c+a;t<=u&&n.push((0,_vue.h)("button",{key:t,class:["vxe-pager--num-btn",{"is--active":r===t}],type:"button",onClick:e=>d(e,t)},t))}),e&&p&&n.push(T("button"),(0,_vue.h)("button",{class:"vxe-pager--num-btn",type:"button",onClick:e=>d(e,u)},u)),(0,_vue.h)("span",{class:"vxe-pager--btn-wrapper"},n)},O=()=>j(!0),V=()=>{var e=h.value;return(0,_vue.h)(_select.default,{class:"vxe-pager--sizes",modelValue:s.pageSize,placement:"top",transfer:s.transfer,options:e,onChange:S})},q=e=>(0,_vue.h)("span",{class:"vxe-pager--jump"},[e?(0,_vue.h)("span",{class:"vxe-pager--goto-text"},_conf.default.i18n("vxe.pager.goto")):null,(0,_vue.h)("input",{class:"vxe-pager--goto",value:n.inpCurrPage,type:"text",autocomplete:"off",onInput:z,onKeydown:J,onBlur:f}),e?(0,_vue.h)("span",{class:"vxe-pager--classifier-text"},_conf.default.i18n("vxe.pager.pageClassifier")):null]),D=()=>q(!0),G=()=>{var e=v.value;return(0,_vue.h)("span",{class:"vxe-pager--count"},[(0,_vue.h)("span",{class:"vxe-pager--separator"}),(0,_vue.h)("span",e)])},w=()=>(0,_vue.h)("span",{class:"vxe-pager--total"},_conf.default.i18n("vxe.pager.total",[s.total]));u={dispatchEvent(e,a,t){r(e,Object.assign({$pager:c,$event:t},a))},homePage(){return b(),(0,_vue.nextTick)()},endPage(){return m(),(0,_vue.nextTick)()},prevPage(){return E(),(0,_vue.nextTick)()},nextPage(){return y(),(0,_vue.nextTick)()},prevJump(){return k(),(0,_vue.nextTick)()},nextJump(){return N(),(0,_vue.nextTick)()}},a={handlePrevPage:E,handleNextPage:y,handlePrevJump:k,handleNextJump:N},Object.assign(c,u,a),(0,_vue.watch)(()=>s.currentPage,e=>{n.inpCurrPage=e});return c.renderVN=()=>{var{align:e,layouts:a,className:t}=s;const r=[];var n=o.value,u=v.value;return l.left&&r.push((0,_vue.h)("span",{class:"vxe-pager--left-wrapper"},l.left({$grid:i}))),a.forEach(e=>{let a;switch(e){case"Home":a=C;break;case"PrevJump":a=R;break;case"PrevPage":a=M;break;case"Number":a=j;break;case"JumpNumber":a=O;break;case"NextPage":a=A;break;case"NextJump":a=T;break;case"End":a=U;break;case"Sizes":a=V;break;case"FullJump":a=D;break;case"Jump":a=q;break;case"PageCount":a=G;break;case"Total":a=w}a?r.push(a()):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notProp",["layouts -> "+e])}),l.right&&r.push((0,_vue.h)("span",{class:"vxe-pager--right-wrapper"},l.right({$grid:i}))),(0,_vue.h)("div",{ref:p,class:["vxe-pager",t?_xeUtils.default.isFunction(t)?t({$pager:c}):t:"",{["size--"+n]:n,["align--"+e]:e,"is--border":s.border,"is--background":s.background,"is--perfect":s.perfect,"is--hidden":s.autoHidden&&1===u,"is--loading":s.loading}]},[(0,_vue.h)("div",{class:"vxe-pager--wrapper"},r)])},c},render(){return this.renderVN()}});