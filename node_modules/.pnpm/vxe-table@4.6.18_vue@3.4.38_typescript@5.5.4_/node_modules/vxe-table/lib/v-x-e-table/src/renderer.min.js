"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderer=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("./conf")),_util=require("../../table/src/util"),_utils=require("../../tools/utils"),_log=require("../../tools/log"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const componentDefaultModelProp="modelValue",defaultCompProps={transfer:!0};function getModelEvent(e){switch(e.name){case"input":case"textarea":return"input"}return"update:modelValue"}function getChangeEvent(e){switch(e.name){case"input":case"textarea":case"VxeInput":case"VxeTextarea":case"$input":case"$textarea":return"input"}return"change"}function parseDate(e,t){return e&&t.valueFormat?_xeUtils.default.toStringDate(e,t.valueFormat):e}function getFormatDate(e,t,n){var{dateConfig:o={}}=t;return _xeUtils.default.toDateString(parseDate(e,t),o.labelFormat||n)}function getLabelFormatDate(e,t){return getFormatDate(e,t,_conf.default.i18n("vxe.input.date.labelFormat."+t.type))}function getOldComponentName(e){return"vxe-"+e.replace("$","")}function getDefaultComponent({name:e}){return(0,_vue.resolveComponent)(e)}function getOldComponent({name:e}){return(0,_vue.resolveComponent)(getOldComponentName(e))}function handleConfirmFilter(e,t,n){e=e.$panel;e.changeOption({},t,n)}function getNativeAttrs(e){let{name:t,attrs:n}=e;return n="input"===t?Object.assign({type:"text"},n):n}function getInputImmediateModel(e){var{name:e,immediate:t,props:n}=e;return t||("VxeInput"===e||"$input"===e?(t=(n||{})["type"],!(!t||"text"===t||"number"===t||"integer"===t||"float"===t)):"input"!==e&&"textarea"!==e&&"$textarea"!==e)}function getCellEditProps(e,t,n,o){return _xeUtils.default.assign({immediate:getInputImmediateModel(e)},defaultCompProps,o,e.props,{[componentDefaultModelProp]:n})}function getCellEditFilterProps(e,t,n,o){return _xeUtils.default.assign({},defaultCompProps,o,e.props,{[componentDefaultModelProp]:n})}function getComponentFormItemProps(e,t,n,o){return _xeUtils.default.assign({},defaultCompProps,o,e.props,{[componentDefaultModelProp]:n})}function isImmediateCell(e,t){return"cell"===t.$type||getInputImmediateModel(e)}function getCellLabelVNs(e,t,n){e=e.placeholder;return[(0,_vue.h)("span",{class:"vxe-cell--label"},e&&(0,_utils.isEmptyValue)(n)?[(0,_vue.h)("span",{class:"vxe-cell--placeholder"},(0,_utils.formatText)((0,_utils.getFuncText)(e),1))]:(0,_utils.formatText)(n,1))]}function getElementOns(e,n,t,o){const r=e["events"],l=getModelEvent(e),a=getChangeEvent(e),i=a===l,u={};return r&&_xeUtils.default.objectEach(r,(t,e)=>{u[(0,_vn.getOnName)(e)]=function(...e){t(n,...e)}}),t&&(u[(0,_vn.getOnName)(l)]=function(e){t(e),i&&o&&o(e),r&&r[l]&&r[l](n,e)}),!i&&o&&(u[(0,_vn.getOnName)(a)]=function(...e){o(...e),r&&r[a]&&r[a](n,...e)}),u}function getComponentOns(e,n,t,o){const r=e["events"],l=getModelEvent(e),a=getChangeEvent(e),i={};return _xeUtils.default.objectEach(r,(t,e)=>{i[(0,_vn.getOnName)(e)]=function(...e){"development"!==process.env.NODE_ENV||_xeUtils.default.isFunction(t)||(0,_log.errLog)("vxe.error.errFunc",[t]),t(n,...e)}}),t&&(i[(0,_vn.getOnName)(l)]=function(e){t(e),r&&r[l]&&r[l](n,e)}),o&&(i[(0,_vn.getOnName)(a)]=function(...e){o(...e),r&&r[a]&&r[a](n,...e)}),i}function getEditOns(e,t){const{$table:n,row:o,column:r}=t,l=e["name"],a=r["model"],i=isImmediateCell(e,t);return getComponentOns(e,t,e=>{i?(0,_util.setCellValue)(o,r,e):(a.update=!0,a.value=e)},e=>{!i&&["VxeInput","VxeTextarea","$input","$textarea"].includes(l)?(e=e.value,a.update=!0,a.value=e,n.updateStatus(t,e)):n.updateStatus(t)})}function getFilterOns(e,t,n){return getComponentOns(e,t,e=>{n.data=e},()=>{handleConfirmFilter(t,!_xeUtils.default.eqNull(n.data),n)})}function getItemOns(e,t){const{$form:n,data:o,property:r}=t;return getComponentOns(e,t,e=>{_xeUtils.default.set(o,r,e)},()=>{n.updateStatus(t)})}function getNativeEditOns(t,n){const{$table:o,row:r,column:l}=n,a=l["model"];return getElementOns(t,n,e=>{e=e.target.value;isImmediateCell(t,n)?(0,_util.setCellValue)(r,l,e):(a.update=!0,a.value=e)},e=>{e=e.target.value;o.updateStatus(n,e)})}function getNativeFilterOns(e,t,n){return getElementOns(e,t,e=>{n.data=e.target.value},()=>{handleConfirmFilter(t,!_xeUtils.default.eqNull(n.data),n)})}function getNativeItemOns(e,t){const{$form:n,data:o,property:r}=t;return getElementOns(e,t,e=>{e=e.target.value;_xeUtils.default.set(o,r,e)},()=>{n.updateStatus(t)})}function nativeEditRender(e,t){var{row:n,column:o}=t,r=e["name"],n=isImmediateCell(e,t)?(0,_util.getCellValue)(n,o):o.model.value;return[(0,_vue.h)(r,Object.assign(Object.assign(Object.assign({class:"vxe-default-"+r},getNativeAttrs(e)),{value:n}),getNativeEditOns(e,t)))]}function defaultCellRender(e,t){return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({},getCellEditProps(e,t,null)),getComponentOns(e,t)))]}function defaultEditRender(e,t){var{row:n,column:o}=t,n=(0,_util.getCellValue)(n,o);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({},getCellEditProps(e,t,n)),getEditOns(e,t)))]}function oldEditRender(e,t){var{row:n,column:o}=t,n=(0,_util.getCellValue)(n,o);return[(0,_vue.h)(getOldComponent(e),Object.assign(Object.assign({},getCellEditProps(e,t,n)),getEditOns(e,t)))]}function oldButtonEditRender(e,t){return[(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),Object.assign(Object.assign({},getCellEditProps(e,t,null)),getComponentOns(e,t)))]}function oldButtonsEditRender(e,t){return e.children.map(e=>oldButtonEditRender(e,t)[0])}function renderNativeOptgroups(n,o,r){var{optionGroups:e,optionGroupProps:t={}}=n;const l=t.options||"options",a=t.label||"label";return e.map((e,t)=>(0,_vue.h)("optgroup",{key:t,label:e[a]},r(e[l],n,o)))}function renderNativeOptions(e,t,n){var{optionProps:o={}}=t,{row:r,column:l}=n;const a=o.label||"label",i=o.value||"value",u=o.disabled||"disabled",s=isImmediateCell(t,n)?(0,_util.getCellValue)(r,l):l.model.value;return e.map((e,t)=>(0,_vue.h)("option",{key:t,value:e[i],disabled:e[u],selected:e[i]==s},e[a]))}function nativeFilterRender(n,o){var e=o["column"];const r=n["name"],l=getNativeAttrs(n);return e.filters.map((e,t)=>(0,_vue.h)(r,Object.assign(Object.assign(Object.assign({key:t,class:"vxe-default-"+r},l),{value:e.data}),getNativeFilterOns(n,o,e))))}function defaultFilterRender(o,r){var e=r["column"];return e.filters.map((e,t)=>{var n=e.data;return(0,_vue.h)(getDefaultComponent(o),Object.assign(Object.assign({key:t},getCellEditFilterProps(o,o,n)),getFilterOns(o,r,e)))})}function oldFilterRender(o,r){var e=r["column"];return e.filters.map((e,t)=>{var n=e.data;return(0,_vue.h)(getOldComponent(o),Object.assign(Object.assign({key:t},getCellEditFilterProps(o,o,n)),getFilterOns(o,r,e)))})}function handleFilterMethod({option:e,row:t,column:n}){e=e.data;return _xeUtils.default.get(t,n.property)==e}function nativeSelectEditRender(e,t){return[(0,_vue.h)("select",Object.assign(Object.assign({class:"vxe-default-select"},getNativeAttrs(e)),getNativeEditOns(e,t)),e.optionGroups?renderNativeOptgroups(e,t,renderNativeOptions):renderNativeOptions(e.options,e,t))]}function defaultSelectEditRender(e,t){var{row:n,column:o}=t,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i}=e,n=(0,_util.getCellValue)(n,o);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({},getCellEditProps(e,t,n,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i})),getEditOns(e,t)))]}function oldSelectEditRender(e,t){var{row:n,column:o}=t,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i}=e,n=(0,_util.getCellValue)(n,o);return[(0,_vue.h)(getOldComponent(e),Object.assign(Object.assign({},getCellEditProps(e,t,n,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i})),getEditOns(e,t)))]}function getSelectCellValue(e,{row:t,column:n}){const{props:o={},options:r,optionGroups:l,optionProps:a={},optionGroupProps:i={}}=e;e=_xeUtils.default.get(t,n.property);let u;const s=a.label||"label",d=a.value||"value";return(0,_utils.isEmptyValue)(e)?"":_xeUtils.default.map(o.multiple?e:[e],l?t=>{var n=i.options||"options";for(let e=0;e<l.length&&!(u=_xeUtils.default.find(l[e][n],e=>e[d]==t));e++);return u?u[s]:t}:t=>(u=_xeUtils.default.find(r,e=>e[d]==t))?u[s]:t).join(", ")}function nativeItemRender(e,t){var{data:n,property:o}=t,r=e["name"],l=getNativeAttrs(e),n=_xeUtils.default.get(n,o);return[(0,_vue.h)(r,Object.assign(Object.assign(Object.assign({class:"vxe-default-"+r},l),{value:!l||"input"!==r||"submit"!==l.type&&"reset"!==l.type?n:null}),getNativeItemOns(e,t)))]}function defaultItemRender(e,t){var{data:n,property:o}=t,n=_xeUtils.default.get(n,o);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({},getComponentFormItemProps(e,t,n)),getItemOns(e,t)))]}function oldItemRender(e,t){var{data:n,property:o}=t,n=_xeUtils.default.get(n,o);return[(0,_vue.h)(getOldComponent(e),Object.assign(Object.assign({},getComponentFormItemProps(e,t,n)),getItemOns(e,t)))]}function oldButtonItemRender(e,t){return[(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),Object.assign(Object.assign({},getComponentFormItemProps(e,t,null)),getComponentOns(e,t)))]}function oldButtonsItemRender(e,t){return e.children.map(e=>oldButtonItemRender(e,t)[0])}function renderNativeFormOptions(e,t,n){var{data:n,property:o}=n,{optionProps:t={}}=t;const r=t.label||"label",l=t.value||"value",a=t.disabled||"disabled",i=_xeUtils.default.get(n,o);return e.map((e,t)=>(0,_vue.h)("option",{key:t,value:e[l],disabled:e[a],selected:e[l]==i},e[r]))}function handleExportSelectMethod(e){var{row:t,column:n,options:o}=e;return o.original?(0,_util.getCellValue)(t,n):getSelectCellValue(n.editRender||n.cellRender,e)}function defaultFormItemRender(e,t){var{data:n,property:o}=t,n=_xeUtils.default.get(n,o);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({},getComponentFormItemProps(e,t,n)),getItemOns(e,t)))]}function formItemRadioAndCheckboxRender(e,t){var{options:n,optionProps:o}=e,{data:r,property:l}=t,r=_xeUtils.default.get(r,l);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({options:n,optionProps:o},getComponentFormItemProps(e,t,r)),getItemOns(e,t)))]}function oldFormItemRadioAndCheckboxRender(e,t){const{name:n,options:o,optionProps:r={}}=e;var{data:l,property:a}=t;const i=r.label||"label",u=r.value||"value",s=r.disabled||"disabled";l=_xeUtils.default.get(l,a);const d=getOldComponentName(n);return o?[(0,_vue.h)((0,_vue.resolveComponent)(d+"-group"),Object.assign(Object.assign({},getComponentFormItemProps(e,t,l)),getItemOns(e,t)),{default:()=>o.map((e,t)=>(0,_vue.h)((0,_vue.resolveComponent)(d),{key:t,label:e[u],content:e[i],disabled:e[s]}))})]:[(0,_vue.h)((0,_vue.resolveComponent)(d),Object.assign(Object.assign({},getComponentFormItemProps(e,t,l)),getItemOns(e,t)))]}const renderMap={input:{autofocus:"input",renderEdit:nativeEditRender,renderDefault:nativeEditRender,renderFilter:nativeFilterRender,defaultFilterMethod:handleFilterMethod,renderItemContent:nativeItemRender},textarea:{autofocus:"textarea",renderEdit:nativeEditRender,renderItemContent:nativeItemRender},select:{renderEdit:nativeSelectEditRender,renderDefault:nativeSelectEditRender,renderCell(e,t){return getCellLabelVNs(e,t,getSelectCellValue(e,t))},renderFilter(n,o){var e=o["column"];return e.filters.map((e,t)=>(0,_vue.h)("select",Object.assign(Object.assign({key:t,class:"vxe-default-select"},getNativeAttrs(n)),getNativeFilterOns(n,o,e)),n.optionGroups?renderNativeOptgroups(n,o,renderNativeOptions):renderNativeOptions(n.options,n,o)))},defaultFilterMethod:handleFilterMethod,renderItemContent(e,t){return[(0,_vue.h)("select",Object.assign(Object.assign({class:"vxe-default-select"},getNativeAttrs(e)),getNativeItemOns(e,t)),e.optionGroups?renderNativeOptgroups(e,t,renderNativeFormOptions):renderNativeFormOptions(e.options,e,t))]},exportMethod:handleExportSelectMethod},VxeInput:{autofocus:".vxe-input--inner",renderEdit:defaultEditRender,renderCell(e,t){var{props:n={}}=e,{row:o,column:r}=t,l=n.digits||_conf.default.input.digits;let a=_xeUtils.default.get(o,r.property);if(a)switch(n.type){case"date":case"week":case"month":case"year":a=getLabelFormatDate(a,n);break;case"float":a=_xeUtils.default.toFixed(_xeUtils.default.floor(a,l),l)}return getCellLabelVNs(e,t,a)},renderDefault:defaultEditRender,renderFilter:defaultFilterRender,defaultFilterMethod:handleFilterMethod,renderItemContent:defaultItemRender},VxeTextarea:{autofocus:".vxe-textarea--inner",renderItemContent:defaultItemRender},VxeButton:{renderDefault:defaultCellRender,renderItemContent:defaultFormItemRender},VxeButtonGroup:{renderDefault:defaultCellRender,renderItemContent(e,t){var n=e["options"],{data:o,property:r}=t,o=_xeUtils.default.get(o,r);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({options:n},getComponentFormItemProps(e,t,o)),getItemOns(e,t)))]}},VxeSelect:{autofocus:".vxe-input--inner",renderEdit:defaultSelectEditRender,renderDefault:defaultSelectEditRender,renderCell(e,t){return getCellLabelVNs(e,t,getSelectCellValue(e,t))},renderFilter(o,r){var e=r["column"];const{options:l,optionProps:a,optionGroups:i,optionGroupProps:u}=o;return e.filters.map((e,t)=>{var n=e.data;return(0,_vue.h)(getDefaultComponent(o),Object.assign(Object.assign({key:t},getCellEditFilterProps(o,r,n,{options:l,optionProps:a,optionGroups:i,optionGroupProps:u})),getFilterOns(o,r,e)))})},defaultFilterMethod:handleFilterMethod,renderItemContent(e,t){var{data:n,property:o}=t,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i}=e,n=_xeUtils.default.get(n,o);return[(0,_vue.h)(getDefaultComponent(e),Object.assign(Object.assign({},getComponentFormItemProps(e,t,n,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i})),getItemOns(e,t)))]},exportMethod:handleExportSelectMethod},VxeRadio:{autofocus:".vxe-radio--input",renderItemContent:defaultFormItemRender},VxeRadioGroup:{autofocus:".vxe-radio--input",renderItemContent:formItemRadioAndCheckboxRender},VxeCheckbox:{autofocus:".vxe-checkbox--input",renderItemContent:defaultFormItemRender},VxeCheckboxGroup:{autofocus:".vxe-checkbox--input",renderItemContent:formItemRadioAndCheckboxRender},VxeSwitch:{autofocus:".vxe-switch--button",renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderItemContent:defaultItemRender},$input:{autofocus:".vxe-input--inner",renderEdit:oldEditRender,renderCell(e,t){var{props:n={}}=e,{row:o,column:r}=t,l=n.digits||_conf.default.input.digits;let a=_xeUtils.default.get(o,r.property);if(a)switch(n.type){case"date":case"week":case"month":case"year":a=getLabelFormatDate(a,n);break;case"float":a=_xeUtils.default.toFixed(_xeUtils.default.floor(a,l),l)}return getCellLabelVNs(e,t,a)},renderDefault:oldEditRender,renderFilter:oldFilterRender,defaultFilterMethod:handleFilterMethod,renderItemContent:oldItemRender},$textarea:{autofocus:".vxe-textarea--inner",renderItemContent:oldItemRender},$button:{renderDefault:oldButtonEditRender,renderItemContent:oldButtonItemRender},$buttons:{renderDefault:oldButtonsEditRender,renderItemContent:oldButtonsItemRender},$select:{autofocus:".vxe-input--inner",renderEdit:oldSelectEditRender,renderDefault:oldSelectEditRender,renderCell(e,t){return getCellLabelVNs(e,t,getSelectCellValue(e,t))},renderFilter(o,r){var e=r["column"];const{options:l,optionProps:a,optionGroups:i,optionGroupProps:u}=o;return e.filters.map((e,t)=>{var n=e.data;return(0,_vue.h)(getOldComponent(o),Object.assign(Object.assign({key:t},getCellEditFilterProps(o,r,n,{options:l,optionProps:a,optionGroups:i,optionGroupProps:u})),getFilterOns(o,r,e)))})},defaultFilterMethod:handleFilterMethod,renderItemContent(e,t){var{data:n,property:o}=t,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i}=e,n=_xeUtils.default.get(n,o);return[(0,_vue.h)(getOldComponent(e),Object.assign(Object.assign({},getComponentFormItemProps(e,t,n,{options:r,optionProps:l,optionGroups:a,optionGroupProps:i})),getItemOns(e,t)))]},exportMethod:handleExportSelectMethod},$radio:{autofocus:".vxe-radio--input",renderItemContent:oldFormItemRadioAndCheckboxRender},$checkbox:{autofocus:".vxe-checkbox--input",renderItemContent:oldFormItemRadioAndCheckboxRender},$switch:{autofocus:".vxe-switch--button",renderEdit:oldEditRender,renderDefault:oldEditRender,renderItemContent:oldItemRender}},renderer=exports.renderer={mixin(e){return _xeUtils.default.each(e,(e,t)=>renderer.add(t,e)),renderer},get(e){return renderMap[e]||null},add(n,e){if(n&&e){const o=renderMap[n];o?("development"===process.env.NODE_ENV&&_xeUtils.default.each(e,(e,t)=>{_xeUtils.default.eqNull(o[t])||o[t]===e||(0,_log.warnLog)("vxe.error.coverProp",["Renderer."+n,t])}),Object.assign(o,e)):renderMap[n]=e}return renderer},delete(e){return delete renderMap[e],renderer}};