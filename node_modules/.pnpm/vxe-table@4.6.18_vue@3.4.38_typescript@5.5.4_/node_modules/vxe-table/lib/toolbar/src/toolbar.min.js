"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_button=_interopRequireDefault(require("../../button")),_vXETable=require("../../v-x-e-table"),_size=require("../../hooks/size"),_log=require("../../tools/log"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeToolbar",props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:()=>_conf.default.toolbar.buttons},tools:{type:Array,default:()=>_conf.default.toolbar.tools},perfect:{type:Boolean,default:()=>_conf.default.toolbar.perfect},size:{type:String,default:()=>_conf.default.toolbar.size||_conf.default.size},className:[String,Function]},emits:["button-click","tool-click"],setup(u,e){const{slots:c,emit:r}=e;var o=_xeUtils.default.uniqueId();const i=(0,_size.useSize)(u),s=(0,_vue.reactive)({isRefresh:!1,columns:[]}),d=(0,_vue.ref)(),t={refElem:d},v={xID:o,props:u,context:e,reactData:s,getRefMaps:()=>t};const _=(0,_vue.inject)("$xegrid",null);let f;const n=(0,_vue.ref)(0),m=(0,_vue.computed)(()=>Object.assign({},_conf.default.toolbar.refresh,u.refresh)),b=(0,_vue.computed)(()=>Object.assign({},_conf.default.toolbar.import,u.import)),p=(0,_vue.computed)(()=>Object.assign({},_conf.default.toolbar.export,u.export)),g=(0,_vue.computed)(()=>Object.assign({},_conf.default.toolbar.print,u.print)),O=(0,_vue.computed)(()=>Object.assign({},_conf.default.toolbar.zoom,u.zoom)),h=(0,_vue.computed)(()=>Object.assign({},_conf.default.toolbar.custom,u.custom)),l=(0,_vue.computed)(()=>{var e;if((n.value||f)&&f)return e=f.getComputeMaps()["computeCustomOpts"],e.value;return{}}),x=(0,_vue.computed)(()=>{return l.value.trigger}),a=()=>{if(f)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},T=({$event:e})=>{f&&(f.triggerCustomEvent?f.triggerCustomEvent(e):(0,_log.errLog)("vxe.error.reqModule",["VxeTableCustomModule"]))},E=({$event:e})=>{f?f.customOpenEvent(e):(0,_log.errLog)("vxe.error.reqModule",["VxeTableCustomModule"])},C=({$event:e})=>{const o=f.reactData["customStore"];o.activeBtn=!1,setTimeout(()=>{o.activeBtn||o.activeWrapper||f.customColseEvent(e)},350)},y=e=>{var o=s["isRefresh"],t=m.value;if(!o){o=t.queryMethod||t.query;if(o){s.isRefresh=!0;try{Promise.resolve(o({})).catch(e=>e).then(()=>{s.isRefresh=!1})}catch(e){s.isRefresh=!1}}else _&&(s.isRefresh=!0,_.triggerToolbarCommitEvent({code:t.code||"reload"},e).catch(e=>e).then(()=>{s.isRefresh=!1}))}},L=e=>{_&&_.triggerZoomEvent(e)},R=(e,o)=>{var t,r=o["code"];r&&(_?_.triggerToolbarBtnEvent(o,e):(t=_vXETable.VXETable.commands.get(r),o={code:r,button:o,$table:f,$grid:_,$event:e},t&&(t.commandMethod?t.commandMethod(o):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[r])),v.dispatchEvent("button-click",o,e)))},N=(e,o)=>{var t,r=o["code"];r&&(_?_.triggerToolbarTolEvent(o,e):(t=_vXETable.VXETable.commands.get(r),o={code:r,tool:o,$table:f,$grid:_,$event:e},t&&(t.commandMethod?t.commandMethod(o):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[r])),v.dispatchEvent("tool-click",o,e)))},k=()=>{a()&&f.openImport()},M=()=>{a()&&f.openExport()},V=()=>{a()&&f.openPrint()},B=(e,t)=>{e=e.dropdowns;return e?e.map((o,e)=>!1===o.visible?(0,_vue.createCommentVNode)():(0,_vue.h)(_button.default,{key:e,disabled:o.disabled,loading:o.loading,type:o.type,icon:o.icon,circle:o.circle,round:o.round,status:o.status,content:o.name,onClick:e=>(t?R:N)(e,o)})):[]};Object.assign(v,{dispatchEvent(e,o,t){r(e,Object.assign({$toolbar:v,$event:t},o))},syncUpdate(e){var o=e["collectColumn"];f=e.$table,s.columns=o,n.value++}}),(0,_vue.nextTick)(()=>{var e=u["refresh"],o=m.value,o=o.queryMethod||o.query,e=(!e||_||o||(0,_log.warnLog)("vxe.error.notFunc",["queryMethod"]),h.value);"development"===process.env.NODE_ENV&&(e.isFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.isFooter","table.custom-config.showFooter"]),e.showFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.showFooter","table.custom-config.showFooter"]),e.immediate&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.immediate","table.custom-config.immediate"]),e.trigger)&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.trigger","table.custom-config.trigger"])});return v.renderVN=()=>{var{perfect:e,loading:o,refresh:t,zoom:r,custom:n,className:l}=u,a=i.value;return(0,_vue.h)("div",{ref:d,class:["vxe-toolbar",l?_xeUtils.default.isFunction(l)?l({$toolbar:v}):l:"",{["size--"+a]:a,"is--perfect":e,"is--loading":o}]},[(0,_vue.h)("div",{class:"vxe-buttons--wrapper"},(()=>{var e=u["buttons"],o=c.buttons;if(o)return(0,_vn.getSlotVNs)(o({$grid:_,$table:f}));const a=[];return e&&e.forEach(o=>{var e,t,r,{dropdowns:n,buttonRender:l}=o;!1!==o.visible&&(e=l?_vXETable.VXETable.renderer.get(l.name):null,l&&e&&e.renderToolbarButton?(t=e.toolbarButtonClassName,r={$grid:_,$table:f,button:o},a.push((0,_vue.h)("span",{class:["vxe-button--item",t?_xeUtils.default.isFunction(t)?t(r):t:""]},(0,_vn.getSlotVNs)(e.renderToolbarButton(l,r))))):a.push((0,_vue.h)(_button.default,{disabled:o.disabled,loading:o.loading,type:o.type,icon:o.icon,circle:o.circle,round:o.round,status:o.status,content:o.name,destroyOnClose:o.destroyOnClose,placement:o.placement,transfer:o.transfer,onClick:e=>R(e,o)},n&&n.length?{dropdowns:()=>B(o,!0)}:{})))}),a})()),(0,_vue.h)("div",{class:"vxe-tools--wrapper"},(()=>{var e=u["tools"],o=c.tools;if(o)return(0,_vn.getSlotVNs)(o({$grid:_,$table:f}));const i=[];return e&&e.forEach((o,e)=>{var t,r,n,l,{dropdowns:a,toolRender:u}=o;!1!==o.visible&&(t=u?u.name:null,r=u?_vXETable.VXETable.renderer.get(t):null,u&&r&&r.renderToolbarTool?(n=r.toolbarToolClassName,l={$grid:_,$table:f,tool:o},i.push((0,_vue.h)("span",{key:t,class:["vxe-tool--item",n?_xeUtils.default.isFunction(n)?n(l):n:""]},(0,_vn.getSlotVNs)(r.renderToolbarTool(u,l))))):i.push((0,_vue.h)(_button.default,{key:e,disabled:o.disabled,loading:o.loading,type:o.type,icon:o.icon,circle:o.circle,round:o.round,status:o.status,content:o.name,destroyOnClose:o.destroyOnClose,placement:o.placement,transfer:o.transfer,onClick:e=>N(e,o)},a&&a.length?{dropdowns:()=>B(o,!1)}:{})))}),i})()),(0,_vue.h)("div",{class:"vxe-tools--operate"},[u.import?(l=b.value,(0,_vue.h)(_button.default,{key:"import",circle:!0,icon:l.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT,title:_conf.default.i18n("vxe.toolbar.import"),onClick:k})):(0,_vue.createCommentVNode)(),u.export?(a=p.value,(0,_vue.h)(_button.default,{key:"export",circle:!0,icon:a.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT,title:_conf.default.i18n("vxe.toolbar.export"),onClick:M})):(0,_vue.createCommentVNode)(),u.print?(e=g.value,(0,_vue.h)(_button.default,{key:"print",circle:!0,icon:e.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT,title:_conf.default.i18n("vxe.toolbar.print"),onClick:V})):(0,_vue.createCommentVNode)(),t?(o=m.value,(0,_vue.h)(_button.default,{key:"refresh",circle:!0,icon:s.isRefresh?o.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:o.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH,title:_conf.default.i18n("vxe.toolbar.refresh"),onClick:y})):(0,_vue.createCommentVNode)(),r&&_&&(l=O.value,_)?(0,_vue.h)(_button.default,{key:"zoom",circle:!0,icon:_.isMaximized()?l.iconOut||_conf.default.icon.TOOLBAR_TOOLS_MINIMIZE:l.iconIn||_conf.default.icon.TOOLBAR_TOOLS_FULLSCREEN,title:_conf.default.i18n("vxe.toolbar.zoom"+(_.isMaximized()?"Out":"In")),onClick:L}):(0,_vue.createCommentVNode)(),n?(a=h.value,e=x.value,t={},"manual"!==e&&("hover"===e?(t.onMouseenter=E,t.onMouseleave=C):t.onClick=T),(0,_vue.h)(_button.default,Object.assign({key:"custom",circle:!0,icon:a.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM,title:_conf.default.i18n("vxe.toolbar.custom"),className:"vxe-toolbar-custom-target"},t))):(0,_vue.createCommentVNode)()])])},v},render(){return this.renderVN()}});