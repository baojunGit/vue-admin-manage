"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_log=require("../../tools/log"),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_table=_interopRequireDefault(require("../../table")),_pager=_interopRequireDefault(require("../../pager")),_toolbar=_interopRequireDefault(require("../../toolbar")),_form=_interopRequireDefault(require("../../form")),_props=_interopRequireDefault(require("../../table/src/props")),_emits=_interopRequireDefault(require("../../table/src/emits")),_size=require("../../hooks/size"),_event=require("../../tools/event"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const tableComponentPropKeys=Object.keys(_props.default),tableComponentMethodKeys=["clearAll","syncData","updateData","loadData","reloadData","reloadRow","loadColumn","reloadColumn","getRowNode","getColumnNode","getRowIndex","getVTRowIndex","getVMRowIndex","getColumnIndex","getVTColumnIndex","getVMColumnIndex","createData","createRow","revertData","clearData","isInsertByRow","isUpdateByRow","getColumns","getColumnById","getColumnByField","getTableColumn","getData","getCheckboxRecords","getParentRow","getRowSeq","getRowById","getRowid","getTableData","setColumnFixed","clearColumnFixed","setColumnWidth","getColumnWidth","hideColumn","showColumn","resetColumn","refreshColumn","refreshScroll","recalculate","closeTooltip","isAllCheckboxChecked","isAllCheckboxIndeterminate","getCheckboxIndeterminateRecords","setCheckboxRow","isCheckedByCheckboxRow","isIndeterminateByCheckboxRow","toggleCheckboxRow","setAllCheckboxRow","getRadioReserveRecord","clearRadioReserve","getCheckboxReserveRecords","clearCheckboxReserve","toggleAllCheckboxRow","clearCheckboxRow","setCurrentRow","isCheckedByRadioRow","setRadioRow","clearCurrentRow","clearRadioRow","getCurrentRecord","getRadioRecord","getCurrentColumn","setCurrentColumn","clearCurrentColumn","setPendingRow","togglePendingRow","getPendingRecords","clearPendingRow","sort","clearSort","isSort","getSortColumns","closeFilter","isFilter","isActiveFilterByColumn","isRowExpandLoaded","clearRowExpandLoaded","reloadRowExpand","reloadRowExpand","toggleRowExpand","setAllRowExpand","setRowExpand","isExpandByRow","isRowExpandByRow","clearRowExpand","clearRowExpandReserve","getRowExpandRecords","getTreeExpandRecords","isTreeExpandLoaded","clearTreeExpandLoaded","reloadTreeExpand","reloadTreeChilds","toggleTreeExpand","setAllTreeExpand","setTreeExpand","isTreeExpandByRow","clearTreeExpand","clearTreeExpandReserve","getScroll","scrollTo","scrollToRow","scrollToColumn","clearScroll","updateFooter","updateStatus","setMergeCells","removeInsertRow","removeMergeCells","getMergeCells","clearMergeCells","setMergeFooterItems","removeMergeFooterItems","getMergeFooterItems","clearMergeFooterItems","openTooltip","focus","blur","connect"],gridComponentEmits=[..._emits.default,"page-change","form-submit","form-submit-invalid","form-reset","form-collapse","form-toggle-collapse","proxy-query","proxy-delete","proxy-save","toolbar-button-click","toolbar-tool-click","zoom"];var _default=exports.default=(0,_vue.defineComponent)({name:"VxeGrid",props:Object.assign(Object.assign({},_props.default),{layouts:Array,columns:Array,pagerConfig:Object,proxyConfig:Object,toolbarConfig:Object,formConfig:Object,zoomConfig:Object,size:{type:String,default:()=>_conf.default.grid.size||_conf.default.size}}),emits:gridComponentEmits,setup(F,e){const{slots:i,emit:r}=e;var t=_xeUtils.default.uniqueId(),y=(0,_vue.getCurrentInstance)();const T=(0,_size.useSize)(F),z=(0,_vue.reactive)({tableLoading:!1,proxyInited:!1,isZMax:!1,tableData:[],filterData:[],formData:{},sortData:[],tZindex:0,tablePage:{total:0,pageSize:_conf.default.pager.pageSize||10,currentPage:1}}),u=(0,_vue.ref)(),$=(0,_vue.ref)(),d=(0,_vue.ref)(),n=(0,_vue.ref)(),c=(0,_vue.ref)(),g=(0,_vue.ref)(),v=(0,_vue.ref)(),f=(0,_vue.ref)(),m=(0,_vue.ref)(),p=(0,_vue.ref)();var o=e=>{const t={};return e.forEach(o=>{t[o]=(...e)=>{var t=$.value;if(t&&t[o])return t[o](...e)}}),t};const Z=o(tableComponentMethodKeys),B=(tableComponentMethodKeys.forEach(o=>{Z[o]=(...e)=>{var t=$.value;if(t&&t[o])return t&&t[o](...e)}}),(0,_vue.computed)(()=>Object.assign({},_conf.default.grid.proxyConfig,F.proxyConfig))),A=(0,_vue.computed)(()=>{return!1!==B.value.message}),H=(0,_vue.computed)(()=>Object.assign({},_conf.default.grid.pagerConfig,F.pagerConfig)),b=(0,_vue.computed)(()=>Object.assign({},_conf.default.grid.formConfig,F.formConfig)),K=(0,_vue.computed)(()=>Object.assign({},_conf.default.grid.toolbarConfig,F.toolbarConfig)),a=(0,_vue.computed)(()=>Object.assign({},_conf.default.grid.zoomConfig,F.zoomConfig)),w=(0,_vue.computed)(()=>z.isZMax?{zIndex:z.tZindex}:null),O=(0,_vue.computed)(()=>{const t={},o=F;return tableComponentPropKeys.forEach(e=>{t[e]=o[e]}),t}),k={refElem:u,refTable:$,refForm:d,refToolbar:n,refPager:c},D={computeProxyOpts:B,computePagerOpts:H,computeFormOpts:b,computeToolbarOpts:K,computeZoomOpts:a},G={xID:t,props:F,context:e,instance:y,reactData:z,getRefMaps:()=>k,getComputeMaps:()=>D};let Q={};const P=(0,_vue.computed)(()=>{var{seqConfig:e,pagerConfig:t,loading:o,editConfig:r,proxyConfig:a}=F,{isZMax:l,tableLoading:n,tablePage:s,tableData:i}=z,u=O.value,d=B.value,c=H.value,g=Object.assign({},u);return l&&(u.maxHeight?g.maxHeight="auto":g.height="auto"),a&&(0,_utils.isEnableConf)(d)&&(g.loading=o||n,g.data=i,t)&&d.seq&&(0,_utils.isEnableConf)(c)&&(g.seqConfig=Object.assign({},e,{startIndex:(s.currentPage-1)*s.pageSize})),r&&(g.editConfig=Object.assign({},r)),g}),l=()=>{var e=K.value;F.toolbarConfig&&(0,_utils.isEnableConf)(e)&&(0,_vue.nextTick)(()=>{var e=$.value,t=n.value;e&&t&&e.connect(t)})},s=()=>{var e=z["tablePage"],t=F["pagerConfig"],o=H.value,{currentPage:r,pageSize:a}=o;t&&(0,_utils.isEnableConf)(o)&&(r&&(e.currentPage=r),a)&&(e.pageSize=a)},W=(e,t)=>{var o=B.value,o=(o.response||o.props||{}).message;let r;return(r=e&&o?_xeUtils.default.isFunction(o)?o({data:e,$grid:G}):_xeUtils.default.get(e,o):r)||_conf.default.i18n(t)},Y=(e,t,o)=>{var r=A.value,a=Z.getCheckboxRecords();if(r){if(a.length)return _vXETable.VXETable.modal.confirm({id:"cfm_"+e,content:_conf.default.i18n(t),escClosable:!0}).then(e=>{if("confirm"===e)return o()});"development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({id:"msg_"+e,content:_conf.default.i18n("vxe.grid.selectOneRecord"),status:"warning"})}else a.length&&o();return Promise.resolve()},M=t=>{var e=F["proxyConfig"],o=z["tablePage"],{currentPage:r,pageSize:a}=t,l=B.value;o.currentPage=r,o.pageSize=a,Q.dispatchEvent("page-change",t),e&&(0,_utils.isEnableConf)(l)&&Q.commitProxy("query").then(e=>{Q.dispatchEvent("proxy-query",e,t.$event)})},q=t=>{var e=$.value,o=F["proxyConfig"],e=e.getComputeMaps()["computeSortOpts"],r=B.value;e.value.remote&&(z.sortData=t.sortList,o)&&(0,_utils.isEnableConf)(r)&&(z.tablePage.currentPage=1,Q.commitProxy("query").then(e=>{Q.dispatchEvent("proxy-query",e,t.$event)})),Q.dispatchEvent("sort-change",t)},V=t=>{var e=$.value,o=F["proxyConfig"],e=e.getComputeMaps()["computeFilterOpts"],r=B.value;e.value.remote&&(z.filterData=t.filterList,o)&&(0,_utils.isEnableConf)(r)&&(z.tablePage.currentPage=1,Q.commitProxy("query").then(e=>{Q.dispatchEvent("proxy-query",e,t.$event)})),Q.dispatchEvent("filter-change",t)},j=t=>{var e=F["proxyConfig"],o=B.value;e&&(0,_utils.isEnableConf)(o)&&Q.commitProxy("reload").then(e=>{Q.dispatchEvent("proxy-query",Object.assign(Object.assign({},e),{isReload:!0}),t.$event)}),Q.dispatchEvent("form-submit",t)},S=t=>{var e=F["proxyConfig"],o=B.value;e&&(0,_utils.isEnableConf)(o)&&Q.commitProxy("reload").then(e=>{Q.dispatchEvent("proxy-query",Object.assign(Object.assign({},e),{isReload:!0}),t.$event)}),Q.dispatchEvent("form-reset",t)},N=e=>{Q.dispatchEvent("form-submit-invalid",e)},X=e=>{(0,_vue.nextTick)(()=>Z.recalculate(!0)),Q.dispatchEvent("form-toggle-collapse",e),Q.dispatchEvent("form-collapse",e)},_=e=>{var t=z["isZMax"];return(e?!t:t)&&(z.isZMax=!t,z.tZindex<(0,_utils.getLastZIndex)())&&(z.tZindex=(0,_utils.nextZIndex)()),(0,_vue.nextTick)().then(()=>Z.recalculate(!0)).then(()=>z.isZMax)},x=(e,t)=>{e=e[t];if(e){if(!_xeUtils.default.isString(e))return e;if(i[e])return i[e];"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notSlot",[e])}return null},I=()=>{var{formConfig:e,proxyConfig:t}=F,o=z["formData"],r=B.value,a=b.value,l=[];if(e&&(0,_utils.isEnableConf)(a)||i.form){let e=[];if(i.form)e=i.form({$grid:G});else if(a.items){const n={};if(!a.inited){a.inited=!0;const s=r.beforeItem;r&&s&&a.items.forEach(e=>{s({$grid:G,item:e})})}a.items.forEach(e=>{_xeUtils.default.each(e.slots,e=>{_xeUtils.default.isFunction(e)||i[e]&&(n[e]=i[e])})}),e.push((0,_vue.h)(_form.default,Object.assign(Object.assign({ref:d},Object.assign({},a,{data:t&&(0,_utils.isEnableConf)(r)&&r.form?o:a.data})),{onSubmit:j,onReset:S,onSubmitInvalid:N,onCollapse:X}),n))}l.push((0,_vue.h)("div",{ref:g,key:"form",class:"vxe-grid--form-wrapper"},e))}return l},L=()=>{var t,o,r=F["toolbarConfig"],a=K.value,l=[];if(r&&(0,_utils.isEnableConf)(a)||i.toolbar){let e=[];i.toolbar?e=i.toolbar({$grid:G}):(r={},(o=a.slots)&&(t=x(o,"buttons"),o=x(o,"tools"),t&&(r.buttons=t),o)&&(r.tools=o),e.push((0,_vue.h)(_toolbar.default,Object.assign({ref:n},a),r))),l.push((0,_vue.h)("div",{ref:v,key:"toolbar",class:"vxe-grid--toolbar-wrapper"},e))}return l},U=()=>i.top?[(0,_vue.h)("div",{ref:f,key:"top",class:"vxe-grid--top-wrapper"},i.top({$grid:G}))]:[],J=["Form","Toolbar","Top","Table","Bottom","Pager"],h={},ee=(_emits.default.forEach(t=>{var e=_xeUtils.default.camelCase("on-"+t);h[e]=(...e)=>r(t,...e)}),()=>{var e=F["proxyConfig"],t=P.value,o=B.value,r=Object.assign({},h);const a=i.empty,l=i.loading;e&&(0,_utils.isEnableConf)(o)&&(o.sort&&(r.onSortChange=q),o.filter)&&(r.onFilterChange=V);e={};return a&&(e.empty=()=>a({})),l&&(e.loading=()=>l({})),[(0,_vue.h)(_table.default,Object.assign(Object.assign({ref:$,key:"table"},t),r),e)]}),te=()=>i.bottom?[(0,_vue.h)("div",{ref:m,key:"bottom",class:"vxe-grid--bottom-wrapper"},i.bottom({$grid:G}))]:[],oe=()=>{var t,o,{proxyConfig:r,pagerConfig:a}=F,l=B.value,n=H.value,s=[];if(a&&(0,_utils.isEnableConf)(n)||i.pager){let e=[];i.pager?e=i.pager({$grid:G}):(a={},(o=n.slots)&&(t=x(o,"left"),o=x(o,"right"),t&&(a.left=t),o)&&(a.right=o),e.push((0,_vue.h)(_pager.default,Object.assign(Object.assign(Object.assign({ref:c},n),r&&(0,_utils.isEnableConf)(l)?z.tablePage:{}),{onPageChange:M}),a))),s.push((0,_vue.h)("div",{ref:p,key:"pager",class:"vxe-grid--pager-wrapper"},e))}return s},E=()=>{var{proxyConfig:e,formConfig:t}=F,o=z["proxyInited"],r=B.value,a=b.value;if(e&&(0,_utils.isEnableConf)(r)){if(t&&(0,_utils.isEnableConf)(a)&&r.form&&a.items){const l={};a.items.forEach(t=>{var{field:o,itemRender:r}=t;if(o){let e=null;r&&(r=r["defaultValue"],_xeUtils.default.isFunction(r)?e=r({item:t}):_xeUtils.default.isUndefined(r)||(e=r)),l[o]=e}}),z.formData=l}o||!(z.proxyInited=!0)!==r.autoLoad&&(0,_vue.nextTick)().then(()=>Q.commitProxy("_init")).then(e=>{Q.dispatchEvent("proxy-query",Object.assign(Object.assign({},e),{isInited:!0}),new Event("init"))})}},C=(Q={dispatchEvent(e,t,o){r(e,Object.assign({$grid:G,$event:o},t))},commitProxy(t,...r){const{toolbarConfig:N,pagerConfig:a,editRules:X,validConfig:o}=F,{tablePage:l,formData:n}=z,s=A.value;var e=B.value;const i=H.value;var u=K.value;const{beforeQuery:I,afterQuery:d,beforeDelete:L,afterDelete:c,beforeSave:U,afterSave:g,ajax:v={}}=e,f=e.response||e.props||{},m=$.value;let p=null,b=null;b=_xeUtils.default.isString(t)?(e=u["buttons"],u=N&&(0,_utils.isEnableConf)(u)&&e?_xeUtils.default.findTree(e,e=>e.code===t,{children:"dropdowns"}):null,p=u?u.item:null,t):(p=t).code;var _=p?p.params:null;switch(b){case"insert":return m.insert({});case"insert_edit":return m.insert({}).then(({row:e})=>m.setEditRow(e));case"insert_actived":return m.insert({}).then(({row:e})=>m.setEditRow(e));case"mark_cancel":C=b,E=A.value,x=$.value,(h=x.getCheckboxRecords()).length?(x.togglePendingRow(h),Z.clearCheckboxRow()):E&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({id:C,content:_conf.default.i18n("vxe.grid.selectOneRecord"),status:"warning"}));break;case"remove":return Y(b,"vxe.grid.removeSelectRecord",()=>m.removeCheckboxRow());case"import":m.importData(_);break;case"open_import":m.openImport(_);break;case"export":m.exportData(_);break;case"open_export":m.openExport(_);break;case"reset_custom":return m.resetColumn(!0);case"_init":case"reload":case"query":var x=v.query;if(x){var h="_init"===b,E="reload"===b;let t=[],o=[],e={};if(a&&((h||E)&&(l.currentPage=1),(0,_utils.isEnableConf)(i))&&(e=Object.assign({},l)),h){var C=m.getComputeMaps()["computeSortOpts"];let e=C.value.defaultSort;e&&(_xeUtils.default.isArray(e)||(e=[e]),t=e.map(e=>({field:e.field,property:e.field,order:e.order}))),o=m.getCheckedFilters()}else E?m.clearAll():(t=m.getSortColumns(),o=m.getCheckedFilters());var R={code:b,button:p,isInited:h,isReload:E,$grid:G,page:e,sort:t.length?t[0]:{},sorts:t,filters:o,form:n,options:x};z.sortData=t,z.filterData=o,z.tableLoading=!0;const y=[R].concat(r);return Promise.resolve((I||x)(...y)).then(e=>{var t,o;return z.tableLoading=!1,e?a&&(0,_utils.isEnableConf)(i)?(o=f.total,o=(_xeUtils.default.isFunction(o)?o({data:e,$grid:G}):_xeUtils.default.get(e,o||"page.total"))||0,l.total=_xeUtils.default.toNumber(o),t=f.result,z.tableData=(_xeUtils.default.isFunction(t)?t({data:e,$grid:G}):_xeUtils.default.get(e,t||"result"))||[],t=Math.max(Math.ceil(o/l.pageSize),1),l.currentPage>t&&(l.currentPage=t)):(o=f.list,z.tableData=(o?_xeUtils.default.isFunction(o)?o({data:e,$grid:G}):_xeUtils.default.get(e,o):e)||[]):z.tableData=[],d&&d(...y),{status:!0}}).catch(()=>({status:z.tableLoading=!1}))}"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notFunc",["proxy-config.ajax.query"]);break;case"delete":{const T=v.delete;if(T){const w=Z.getCheckboxRecords(),O=w.filter(e=>!m.isInsertByRow(e));R={removeRecords:O};const k=[{$grid:G,code:b,button:p,body:R,form:n,options:T}].concat(r);if(w.length)return Y(b,"vxe.grid.deleteSelectRecord",()=>O.length?(z.tableLoading=!0,Promise.resolve((L||T)(...k)).then(e=>(z.tableLoading=!1,m.setPendingRow(O,!1),s&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({content:W(e,"vxe.grid.delSuccess"),status:"success"})),c?c(...k):Q.commitProxy("query"),{status:!0})).catch(e=>(z.tableLoading=!1,s&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal.message||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({id:b,content:W(e,"vxe.grid.operError"),status:"error"})),{status:!1}))):m.remove(w));s&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({id:b,content:_conf.default.i18n("vxe.grid.selectOneRecord"),status:"warning"}))}else"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notFunc",["proxy-config.ajax.delete"]);break}case"save":{const D=v.save;if(D){const P=m.getRecordset(),{insertRecords:M,removeRecords:q,updateRecords:V,pendingRecords:j}=P;const S=[{$grid:G,code:b,button:p,body:P,form:n,options:D}].concat(r);M.length&&(P.pendingRecords=j.filter(e=>-1===m.findRowIndexOf(M,e))),j.length&&(P.insertRecords=M.filter(e=>-1===m.findRowIndexOf(j,e)));let e=Promise.resolve();return(e=X?m[o&&"full"===o.msgMode?"fullValidate":"validate"](P.insertRecords.concat(V)):e).then(e=>{if(!e)return P.insertRecords.length||q.length||V.length||P.pendingRecords.length?(z.tableLoading=!0,Promise.resolve((U||D)(...S)).then(e=>(z.tableLoading=!1,m.clearPendingRow(),s&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({content:W(e,"vxe.grid.saveSuccess"),status:"success"})),g?g(...S):Q.commitProxy("query"),{status:!0})).catch(e=>(z.tableLoading=!1,s&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({id:b,content:W(e,"vxe.grid.operError"),status:"error"})),{status:!1}))):void(s&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({id:b,content:_conf.default.i18n("vxe.grid.dataUnchanged"),status:"info"})))})}"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notFunc",["proxy-config.ajax.save"]);break}default:R=_vXETable.VXETable.commands.get(b);R&&(R.commandMethod?R.commandMethod({code:b,button:p,$grid:G,$table:m},...r):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[b]))}return(0,_vue.nextTick)()},zoom(){return z.isZMax?Q.revert():Q.maximize()},isMaximized(){return z.isZMax},maximize(){return _(!0)},revert(){return _()},getFormItems(e){var t=b.value,o=F["formConfig"],r=t["items"];const a=[];return _xeUtils.default.eachTree(o&&(0,_utils.isEnableConf)(t)&&r?r:[],e=>{a.push(e)},{children:"children"}),_xeUtils.default.isUndefined(e)?a:a[e]},getProxyInfo(){var e,t=$.value;return F.proxyConfig?(e=z["sortData"],{data:z.tableData,filter:z.filterData,form:z.formData,sort:e.length?e[0]:{},sorts:e,pager:z.tablePage,pendingRecords:t?t.getPendingRecords():[]}):null}},"development"===process.env.NODE_ENV&&(Q.loadColumn=e=>{var t=$.value;return _xeUtils.default.eachTree(e,e=>{e.slots&&_xeUtils.default.each(e.slots,e=>{_xeUtils.default.isFunction(e)||i[e]||(0,_log.errLog)("vxe.error.notSlot",[e])})}),t?t.loadColumn(e):(0,_vue.nextTick)()},Q.reloadColumn=e=>(Z.clearAll(),Q.loadColumn(e))),{extendTableMethods:o,callSlot(e,t){return e&&(_xeUtils.default.isString(e)&&(e=i[e]||null),_xeUtils.default.isFunction(e))?(0,_vn.getSlotVNs)(e(t)):[]},getExcludeHeight(){var e=F["height"],t=z["isZMax"],o=u.value,r=g.value,a=v.value,l=f.value,n=m.value,s=p.value;return(t||"auto"!==e?0:(0,_dom.getPaddingTopBottomSize)(o.parentNode))+(0,_dom.getPaddingTopBottomSize)(o)+(0,_dom.getOffsetHeight)(r)+(0,_dom.getOffsetHeight)(a)+(0,_dom.getOffsetHeight)(l)+(0,_dom.getOffsetHeight)(n)+(0,_dom.getOffsetHeight)(s)},getParentHeight(){var e=u.value;return e?(z.isZMax?(0,_dom.getDomNode)().visibleHeight:_xeUtils.default.toNumber(getComputedStyle(e.parentNode).height))-C.getExcludeHeight():0},triggerToolbarCommitEvent(e,t){const o=e["code"];return Q.commitProxy(e,t).then(e=>{o&&e&&e.status&&["query","reload","delete","save"].includes(o)&&Q.dispatchEvent("delete"===o||"save"===o?"proxy-"+o:"proxy-query",Object.assign(Object.assign({},e),{isReload:"reload"===o}),t)})},triggerToolbarBtnEvent(e,t){C.triggerToolbarCommitEvent(e,t),Q.dispatchEvent("toolbar-button-click",{code:e.code,button:e},t)},triggerToolbarTolEvent(e,t){C.triggerToolbarCommitEvent(e,t),Q.dispatchEvent("toolbar-tool-click",{code:e.code,tool:e,$event:t})},triggerZoomEvent(e){Q.zoom(),Q.dispatchEvent("zoom",{type:z.isZMax?"max":"revert"},e)}}),R=(Object.assign(G,Z,Q,C),(0,_vue.ref)(0)),re=((0,_vue.watch)(()=>F.columns?F.columns.length:-1,()=>{R.value++}),(0,_vue.watch)(()=>F.columns,()=>{R.value++}),(0,_vue.watch)(R,()=>{(0,_vue.nextTick)(()=>G.loadColumn(F.columns||[]))}),(0,_vue.watch)(()=>F.toolbarConfig,()=>{l()}),(0,_vue.watch)(()=>F.pagerConfig,()=>{s()}),(0,_vue.watch)(()=>F.proxyConfig,()=>{E()}),e=>{var t=a.value;(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ESCAPE)&&z.isZMax&&!1!==t.escRestore&&C.triggerZoomEvent(e)});_vXETable.VXETable.hooks.forEach(e=>{var e=e["setupGrid"];e&&(e=e(G))&&_xeUtils.default.isObject(e)&&Object.assign(G,e)}),s(),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var{data:e,columns:t,proxyConfig:o}=F,r=B.value,a=b.value;(0,_utils.isEnableConf)(o)&&(e||r.form&&a.data)&&(0,_log.errLog)("vxe.error.errConflicts",["grid.data","grid.proxy-config"]),t&&t.length&&G.loadColumn(t),l()}),_event.GlobalEvent.on(G,"keydown",re)}),(0,_vue.onUnmounted)(()=>{_event.GlobalEvent.off(G,"keydown")}),(0,_vue.nextTick)(()=>{E()});return G.renderVN=()=>{var e=T.value,t=w.value;return(0,_vue.h)("div",{ref:u,class:["vxe-grid",{["size--"+e]:e,"is--animat":!!F.animat,"is--round":F.round,"is--maximize":z.isZMax,"is--loading":F.loading||z.tableLoading}],style:t},(()=>{var e=F["layouts"];const t=[];return(e&&e.length?e:_conf.default.grid.layouts||J).forEach(e=>{switch(e){case"Form":t.push(I());break;case"Toolbar":t.push(L());break;case"Top":t.push(U());break;case"Table":t.push(ee());break;case"Bottom":t.push(te());break;case"Pager":t.push(oe());break;default:"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notProp",["layouts -> "+e])}}),t})())},(0,_vue.provide)("$xegrid",G),G},render(){return this.renderVN()}});