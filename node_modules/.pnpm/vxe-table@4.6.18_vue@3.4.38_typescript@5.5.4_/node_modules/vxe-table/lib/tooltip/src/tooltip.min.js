"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeTooltip",props:{modelValue:Boolean,size:{type:String,default:()=>_conf.default.tooltip.size||_conf.default.size},trigger:{type:String,default:()=>_conf.default.tooltip.trigger||"hover"},theme:{type:String,default:()=>_conf.default.tooltip.theme||"dark"},content:{type:[String,Number],default:null},useHTML:Boolean,zIndex:[String,Number],popupClassName:[String,Function],isArrow:{type:Boolean,default:!0},enterable:Boolean,enterDelay:{type:Number,default:()=>_conf.default.tooltip.enterDelay},leaveDelay:{type:Number,default:()=>_conf.default.tooltip.leaveDelay}},emits:["update:modelValue"],setup(p,e){const{slots:v,emit:l}=e;var t=_xeUtils.default.uniqueId();const c=(0,_size.useSize)(p),d=(0,_vue.reactive)({target:null,isUpdate:!1,visible:!1,tipContent:"",tipActive:!1,tipTarget:null,tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:{}}}),f=(0,_vue.ref)(),i={refElem:f},_={xID:t,props:p,context:e,reactData:d,getRefMaps:()=>i};let r={};const o=()=>{var{tipTarget:i,tipStore:l}=d;if(i){var{scrollTop:o,scrollLeft:r,visibleWidth:n}=(0,_dom.getDomNode)(),{top:a,left:u}=(0,_dom.getAbsolutePos)(i),s=f.value,p=s.offsetHeight,s=s.offsetWidth;let e=u,t=a-p-6;(e=Math.max(6,u+Math.floor((i.offsetWidth-s)/2)))+s+6>r+n&&(e=r+n-s-6),a-p<o+6&&(l.placement="bottom",t=a+i.offsetHeight+6),l.style.top=t+"px",l.style.left=e+"px",l.arrowStyle.left=u-e+i.offsetWidth/2+"px"}},n=e=>{e!==d.visible&&(d.visible=e,d.isUpdate=!0,l("update:modelValue",e))},a=()=>{d.visible?r.close():r.open()},u=()=>{r.open()},s=()=>{var{trigger:e,enterable:t,leaveDelay:i}=p;d.tipActive=!1,t&&"hover"===e?setTimeout(()=>{d.tipActive||r.close()},i):r.close()},m=()=>{d.tipActive=!0},g=()=>{var{trigger:e,enterable:t,leaveDelay:i}=p;d.tipActive=!1,t&&"hover"===e&&setTimeout(()=>{d.tipActive||r.close()},i)},x=()=>{var e=d["tipStore"],t=f.value;return t&&!t.parentNode&&document.body.appendChild(t),n(!0),d.tipZindex<(0,_utils.getLastZIndex)()&&(d.tipZindex=(0,_utils.nextZIndex)()),e.placement="top",e.style={width:"auto",left:0,top:0,zIndex:p.zIndex||d.tipZindex},e.arrowStyle={left:"50%"},r.updatePlacement()},h=_xeUtils.default.debounce(()=>{d.tipActive&&x()},p.enterDelay,{leading:!1,trailing:!0});r={dispatchEvent(e,t,i){l(e,Object.assign({$tooltip:_,$event:i},t))},open(e,t){return r.toVisible(e||d.target,t)},close(){return d.tipTarget=null,d.tipActive=!1,Object.assign(d.tipStore,{style:{},placement:"",arrowStyle:null}),n(!1),(0,_vue.nextTick)()},toVisible(e,t){if(e){var{trigger:i,enterDelay:l}=p;if(d.tipActive=!0,d.tipTarget=e,t&&(d.tipContent=t),!l||"hover"!==i)return x();h()}return(0,_vue.nextTick)()},updatePlacement(){return(0,_vue.nextTick)().then(()=>{var e=d["tipTarget"],t=f.value;if(e&&t)return o(),(0,_vue.nextTick)().then(o)})},isActived(){return d.tipActive},setActived(e){d.tipActive=!!e}},Object.assign(_,r),(0,_vue.watch)(()=>p.content,()=>{d.tipContent=p.content}),(0,_vue.watch)(()=>p.modelValue,()=>{d.isUpdate||(p.modelValue?r.open():r.close()),d.isUpdate=!1}),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var{trigger:e,content:t,modelValue:i}=p;const l=f.value;if(l){const o=l.parentNode;o&&(d.tipContent=t,d.tipZindex=(0,_utils.nextZIndex)(),_xeUtils.default.arrayEach(l.children,(e,t)=>{1<t&&(o.insertBefore(e,l),d.target||(d.target=e))}),o.removeChild(l),t=d["target"],t&&("hover"===e?(t.onmouseenter=u,t.onmouseleave=s):"click"===e&&(t.onclick=a)),i)&&r.open()}})}),(0,_vue.onBeforeUnmount)(()=>{var e=p["trigger"],t=d["target"],i=f.value;t&&("hover"===e?(t.onmouseenter=null,t.onmouseleave=null):"click"===e&&(t.onclick=null)),i&&(e=i.parentNode)&&e.removeChild(i)});return _.renderVN=()=>{var{popupClassName:e,theme:t,isArrow:i,enterable:l}=p,{tipActive:o,visible:r,tipStore:n}=d,a=v.default,u=c.value;let s;return l&&(s={onMouseenter:m,onMouseleave:g}),(0,_vue.h)("div",Object.assign({ref:f,class:["vxe-table--tooltip-wrapper","theme--"+t,e?_xeUtils.default.isFunction(e)?e({$tooltip:_}):e:"",{["size--"+u]:u,["placement--"+n.placement]:n.placement,"is--enterable":l,"is--visible":r,"is--arrow":i,"is--active":o}],style:n.style},s),[(t=p.useHTML,e=d.tipContent,(u=v.content)?(0,_vue.h)("div",{key:1,class:"vxe-table--tooltip-content"},(0,_vn.getSlotVNs)(u({}))):t?(0,_vue.h)("div",{key:2,class:"vxe-table--tooltip-content",innerHTML:e}):(0,_vue.h)("div",{key:3,class:"vxe-table--tooltip-content"},(0,_utils.formatText)(e))),(0,_vue.h)("div",{class:"vxe-table--tooltip-arrow",style:n.arrowStyle}),...a?(0,_vn.getSlotVNs)(a({})):[]])},_},render(){return this.renderVN()}});